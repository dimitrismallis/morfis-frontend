import{c5 as E,c6 as p,c7 as Ye,c8 as k,c9 as bt,ca as m,cb as Ae,cc as Re,cd as te,ce as _,cf as Ft,cg as _e,ch as ge,ci as S,cj as We,ck as Ut,cl as jt,cm as Bt}from"./index-DCJSx5rv.js";const Lt=0,kt=0,Ht=0,vt=2,Pt=0,Gt=163,Vt=166,Kt=0,Xt=2,$t=1,zt=64,qt=0;function Yt(){return{vkFormat:qt,typeSize:1,pixelWidth:0,pixelHeight:0,pixelDepth:0,layerCount:0,faceCount:1,levelCount:0,supercompressionScheme:Lt,levels:[],dataFormatDescriptor:[{vendorId:Ht,descriptorType:kt,versionNumber:vt,colorModel:Pt,colorPrimaries:$t,transferFunction:Xt,flags:Kt,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],keyValue:{},globalData:null}}class fe{constructor(e,s,r,t){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+s,r),this._littleEndian=t,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),s=this._dataView.getUint32(this._offset+4,this._littleEndian),r=e+2**32*s;return this._offset+=8,r}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const s=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,s}_skip(e){return this._offset+=e,this}_scan(e,s=0){const r=this._offset;let t=0;for(;this._dataView.getUint8(this._offset)!==s&&t<e;)t++,this._offset++;return t<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,t)}}const A=[171,75,84,88,32,50,48,187,13,10,26,10];function Be(c){return new TextDecoder().decode(c)}function Ee(c){const e=new Uint8Array(c.buffer,c.byteOffset,A.length);if(e[0]!==A[0]||e[1]!==A[1]||e[2]!==A[2]||e[3]!==A[3]||e[4]!==A[4]||e[5]!==A[5]||e[6]!==A[6]||e[7]!==A[7]||e[8]!==A[8]||e[9]!==A[9]||e[10]!==A[10]||e[11]!==A[11])throw new Error("Missing KTX 2.0 identifier.");const s=Yt(),r=17*Uint32Array.BYTES_PER_ELEMENT,t=new fe(c,A.length,r,!0);s.vkFormat=t._nextUint32(),s.typeSize=t._nextUint32(),s.pixelWidth=t._nextUint32(),s.pixelHeight=t._nextUint32(),s.pixelDepth=t._nextUint32(),s.layerCount=t._nextUint32(),s.faceCount=t._nextUint32(),s.levelCount=t._nextUint32(),s.supercompressionScheme=t._nextUint32();const o=t._nextUint32(),n=t._nextUint32(),i=t._nextUint32(),a=t._nextUint32(),u=t._nextUint64(),h=t._nextUint64(),f=Math.max(s.levelCount,1)*3*8,d=new fe(c,A.length+r,f,!0);for(let M=0,O=Math.max(s.levelCount,1);M<O;M++)s.levels.push({levelData:new Uint8Array(c.buffer,c.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const l=new fe(c,o,n,!0);l._skip(4);const T=l._nextUint16(),g=l._nextUint16(),x=l._nextUint16(),C=l._nextUint16(),H=l._nextUint8(),w=l._nextUint8(),oe=l._nextUint8(),se=l._nextUint8(),re=[l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8()],ce=[l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8()],b={vendorId:T,descriptorType:g,versionNumber:x,colorModel:H,colorPrimaries:w,transferFunction:oe,flags:se,texelBlockDimension:re,bytesPlane:ce,samples:[]},_t=(C/4-6)/4;for(let M=0;M<_t;M++){const O={bitOffset:l._nextUint16(),bitLength:l._nextUint8(),channelType:l._nextUint8(),samplePosition:[l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8()],sampleLower:Number.NEGATIVE_INFINITY,sampleUpper:Number.POSITIVE_INFINITY};O.channelType&zt?(O.sampleLower=l._nextInt32(),O.sampleUpper=l._nextInt32()):(O.sampleLower=l._nextUint32(),O.sampleUpper=l._nextUint32()),b.samples[M]=O}s.dataFormatDescriptor.length=0,s.dataFormatDescriptor.push(b);const ue=new fe(c,i,a,!0);for(;ue._offset<a;){const M=ue._nextUint32(),O=ue._scan(M),xe=Be(O);if(s.keyValue[xe]=ue._nextUint8Array(M-O.byteLength-1),xe.match(/^ktx/i)){const je=Be(s.keyValue[xe]);s.keyValue[xe]=je.substring(0,je.lastIndexOf("\0"))}const wt=M%4?4-M%4:0;ue._skip(wt)}if(h<=0)return s;const F=new fe(c,u,h,!0),yt=F._nextUint16(),Nt=F._nextUint16(),Me=F._nextUint32(),Oe=F._nextUint32(),Ce=F._nextUint32(),Dt=F._nextUint32(),we=[];for(let M=0,O=Math.max(s.levelCount,1);M<O;M++)we.push({imageFlags:F._nextUint32(),rgbSliceByteOffset:F._nextUint32(),rgbSliceByteLength:F._nextUint32(),alphaSliceByteOffset:F._nextUint32(),alphaSliceByteLength:F._nextUint32()});const be=u+F._offset,Fe=be+Me,Ue=Fe+Oe,St=Ue+Ce,At=new Uint8Array(c.buffer,c.byteOffset+be,Me),Mt=new Uint8Array(c.buffer,c.byteOffset+Fe,Oe),Ot=new Uint8Array(c.buffer,c.byteOffset+Ue,Ce),Ct=new Uint8Array(c.buffer,c.byteOffset+St,Dt);return s.globalData={endpointCount:yt,selectorCount:Nt,imageDescs:we,endpointsData:At,selectorsData:Mt,tablesData:Ot,extendedData:Ct},s}const v="EXT_mesh_gpu_instancing",N="EXT_meshopt_compression",le="EXT_texture_webp",he="EXT_texture_avif",I="KHR_draco_mesh_compression",j="KHR_lights_punctual",P="KHR_materials_anisotropy",G="KHR_materials_clearcoat",V="KHR_materials_diffuse_transmission",K="KHR_materials_dispersion",X="KHR_materials_emissive_strength",$="KHR_materials_ior",z="KHR_materials_iridescence",q="KHR_materials_pbrSpecularGlossiness",Y="KHR_materials_sheen",W="KHR_materials_specular",Q="KHR_materials_transmission",ne="KHR_materials_unlit",J="KHR_materials_volume",D="KHR_materials_variants",Qe="KHR_mesh_quantization",pe="KHR_texture_basisu",Z="KHR_texture_transform",B="KHR_xmp_json_ld",ye="INSTANCE_ATTRIBUTE";class Je extends _{init(){this.extensionName=v,this.propertyType="InstancedMesh",this.parentTypes=[p.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new Ft})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,s){return this.setRefMap("attributes",e,s,{usage:ye})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}Je.EXTENSION_NAME=v;class Wt extends E{constructor(...e){super(...e),this.extensionName=v,this.provideTypes=[p.NODE],this.prewriteTypes=[p.ACCESSOR]}createInstancedMesh(){return new Je(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((t,o)=>{if(!t.extensions||!t.extensions[v])return;const n=t.extensions[v],i=this.createInstancedMesh();for(const a in n.attributes)i.setAttribute(a,e.accessors[n.attributes[a]]);e.nodes[o].setExtension(v,i)}),this}prewrite(e){e.accessorUsageGroupedByParent.add(ye);for(const s of this.properties)for(const r of s.listAttributes())e.addAccessorToUsageGroup(r,ye);return this}write(e){const s=e.jsonDoc;return this.document.getRoot().listNodes().forEach(r=>{const t=r.getExtension(v);if(t){const o=e.nodeIndexMap.get(r),n=s.json.nodes[o],i={attributes:{}};t.listSemantics().forEach(a=>{const u=t.getAttribute(a);i.attributes[a]=e.accessorIndexMap.get(u)}),n.extensions=n.extensions||{},n.extensions[v]=i}}),this}}Wt.EXTENSION_NAME=v;function ee(){return ee=Object.assign?Object.assign.bind():function(c){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var r in s)({}).hasOwnProperty.call(s,r)&&(c[r]=s[r])}return c},ee.apply(null,arguments)}var de;(function(c){c.QUANTIZE="quantize",c.FILTER="filter"})(de||(de={}));var ie;(function(c){c.ATTRIBUTES="ATTRIBUTES",c.TRIANGLES="TRIANGLES",c.INDICES="INDICES"})(ie||(ie={}));var R;(function(c){c.NONE="NONE",c.OCTAHEDRAL="OCTAHEDRAL",c.QUATERNION="QUATERNION",c.EXPONENTIAL="EXPONENTIAL"})(R||(R={}));function Qt(c){return!c.extensions||!c.extensions[N]?!1:!!c.extensions[N].fallback}const{BYTE:Jt,SHORT:Le,FLOAT:Zt}=m.ComponentType,{encodeNormalizedInt:ke,decodeNormalizedInt:Ne}=ge;function es(c,e,s,r){const{filter:t,bits:o}=r,n={array:c.getArray(),byteStride:c.getElementSize()*c.getComponentSize(),componentType:c.getComponentType(),normalized:c.getNormalized()};if(s!==ie.ATTRIBUTES)return n;if(t!==R.NONE){let i=c.getNormalized()?ts(c):new Float32Array(n.array);switch(t){case R.EXPONENTIAL:n.byteStride=c.getElementSize()*4,n.componentType=Zt,n.normalized=!1,n.array=e.encodeFilterExp(i,c.getCount(),n.byteStride,o);break;case R.OCTAHEDRAL:n.byteStride=o>8?8:4,n.componentType=o>8?Le:Jt,n.normalized=!0,i=c.getElementSize()===3?ns(i):i,n.array=e.encodeFilterOct(i,c.getCount(),n.byteStride,o);break;case R.QUATERNION:n.byteStride=8,n.componentType=Le,n.normalized=!0,n.array=e.encodeFilterQuat(i,c.getCount(),n.byteStride,o);break;default:throw new Error("Invalid filter.")}n.min=c.getMin([]),n.max=c.getMax([]),c.getNormalized()&&(n.min=n.min.map(a=>Ne(a,c.getComponentType())),n.max=n.max.map(a=>Ne(a,c.getComponentType()))),n.normalized&&(n.min=n.min.map(a=>ke(a,n.componentType)),n.max=n.max.map(a=>ke(a,n.componentType)))}else n.byteStride%4&&(n.array=ss(n.array,c.getElementSize()),n.byteStride=n.array.byteLength/c.getCount());return n}function ts(c){const e=c.getComponentType(),s=c.getArray(),r=new Float32Array(s.length);for(let t=0;t<s.length;t++)r[t]=Ne(s[t],e);return r}function ss(c,e){const r=k.padNumber(c.BYTES_PER_ELEMENT*e)/c.BYTES_PER_ELEMENT,t=c.length/e,o=new c.constructor(t*r);for(let n=0;n*e<c.length;n++)for(let i=0;i<e;i++)o[n*r+i]=c[n*e+i];return o}function ns(c){const e=new Float32Array(c.length*4/3);for(let s=0,r=c.length/3;s<r;s++)e[s*4]=c[s*3],e[s*4+1]=c[s*3+1],e[s*4+2]=c[s*3+2];return e}function rs(c,e){return e===_e.BufferViewUsage.ELEMENT_ARRAY_BUFFER?c.listParents().some(r=>r instanceof Re&&r.getMode()===Re.Mode.TRIANGLES)?ie.TRIANGLES:ie.INDICES:ie.ATTRIBUTES}function os(c,e){const s=e.getGraph().listParentEdges(c).filter(r=>!(r.getParent()instanceof Bt));for(const r of s){const t=r.getName(),o=r.getAttributes().key||"",n=r.getParent().propertyType===p.PRIMITIVE_TARGET;if(t==="indices")return{filter:R.NONE};if(t==="attributes"){if(o==="POSITION")return{filter:R.NONE};if(o==="TEXCOORD_0")return{filter:R.NONE};if(o.startsWith("JOINTS_"))return{filter:R.NONE};if(o.startsWith("WEIGHTS_"))return{filter:R.NONE};if(o==="NORMAL"||o==="TANGENT")return n?{filter:R.NONE}:{filter:R.OCTAHEDRAL,bits:8}}if(t==="output"){const i=Ze(c);return i==="rotation"?{filter:R.QUATERNION,bits:16}:i==="translation"?{filter:R.EXPONENTIAL,bits:12}:i==="scale"?{filter:R.EXPONENTIAL,bits:12}:{filter:R.NONE}}if(t==="input")return{filter:R.NONE};if(t==="inverseBindMatrices")return{filter:R.NONE}}return{filter:R.NONE}}function Ze(c){for(const e of c.listParents())if(e instanceof Ut){for(const s of e.listParents())if(s instanceof jt)return s.getTargetPath()}return null}const He={method:de.QUANTIZE};class et extends E{constructor(...e){super(...e),this.extensionName=N,this.prereadTypes=[p.BUFFER,p.PRIMITIVE],this.prewriteTypes=[p.BUFFER,p.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=He,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,s){return e==="meshopt.decoder"&&(this._decoder=s),e==="meshopt.encoder"&&(this._encoder=s),this}setEncoderOptions(e){return this._encoderOptions=ee({},He,e),this}preread(e,s){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${N}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${N}]: Missing WASM support.`)}return s===p.BUFFER?this._prereadBuffers(e):s===p.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const s=e.jsonDoc;(s.json.bufferViews||[]).forEach((t,o)=>{if(!t.extensions||!t.extensions[N])return;const n=t.extensions[N],i=n.byteOffset||0,a=n.byteLength||0,u=n.count,h=n.byteStride,f=new Uint8Array(u*h),d=s.json.buffers[n.buffer],l=d.uri?s.resources[d.uri]:s.resources[Ye],T=k.toView(l,i,a);this._decoder.decodeGltfBuffer(f,u,h,T,n.mode,n.filter),e.bufferViews[o]=f})}_prereadPrimitives(e){const s=e.jsonDoc;(s.json.bufferViews||[]).forEach(t=>{if(!t.extensions||!t.extensions[N])return;const o=t.extensions[N],n=e.buffers[o.buffer],i=e.buffers[t.buffer],a=s.json.buffers[t.buffer];Qt(a)&&this._decoderFallbackBufferMap.set(i,n)})}read(e){if(!this.isRequired())return this;for(const[s,r]of this._decoderFallbackBufferMap){for(const t of s.listParents())t instanceof m&&t.swap(s,r);s.dispose()}return this}prewrite(e,s){return s===p.ACCESSOR?this._prewriteAccessors(e):s===p.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const s=e.jsonDoc.json,r=this._encoder,t=this._encoderOptions,o=this.document.getGraph(),n=this.document.createBuffer(),i=this.document.getRoot().listBuffers().indexOf(n);let a=1;const u=new Map,h=f=>{for(const d of o.listParents(f)){if(d.propertyType===p.ROOT)continue;let l=u.get(f);return l===void 0&&u.set(f,l=a++),l}return-1};this._encoderFallbackBuffer=n,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const f of this.document.getRoot().listAccessors()){if(Ze(f)==="weights"||f.getSparse())continue;const d=e.getAccessorUsage(f),l=e.accessorUsageGroupedByParent.has(d)?h(f):null,T=rs(f,d),g=t.method===de.FILTER?os(f,this.document):{filter:R.NONE},x=es(f,r,T,g),{array:C,byteStride:H}=x,w=f.getBuffer();if(!w)throw new Error(`${N}: Missing buffer for accessor.`);const oe=this.document.getRoot().listBuffers().indexOf(w),se=[d,l,T,g.filter,H,oe].join(":");let re=this._encoderBufferViews[se],ce=this._encoderBufferViewData[se],me=this._encoderBufferViewAccessors[se];(!re||!ce)&&(me=this._encoderBufferViewAccessors[se]=[],ce=this._encoderBufferViewData[se]=[],re=this._encoderBufferViews[se]={buffer:i,target:_e.USAGE_TO_TARGET[d],byteOffset:0,byteLength:0,byteStride:d===_e.BufferViewUsage.ARRAY_BUFFER?H:void 0,extensions:{[N]:{buffer:oe,byteOffset:0,byteLength:0,mode:T,filter:g.filter!==R.NONE?g.filter:void 0,byteStride:H,count:0}}});const b=e.createAccessorDef(f);b.componentType=x.componentType,b.normalized=x.normalized,b.byteOffset=re.byteLength,b.min&&x.min&&(b.min=x.min),b.max&&x.max&&(b.max=x.max),e.accessorIndexMap.set(f,s.accessors.length),s.accessors.push(b),me.push(b),ce.push(new Uint8Array(C.buffer,C.byteOffset,C.byteLength)),re.byteLength+=C.byteLength,re.extensions.EXT_meshopt_compression.count+=f.getCount()}}_prewriteBuffers(e){const s=this._encoder;for(const r in this._encoderBufferViews){const t=this._encoderBufferViews[r],o=this._encoderBufferViewData[r],n=this.document.getRoot().listBuffers()[t.extensions[N].buffer],i=e.otherBufferViews.get(n)||[],{count:a,byteStride:u,mode:h}=t.extensions[N],f=k.concat(o),d=s.encodeGltfBuffer(f,a,u,h),l=k.pad(d);t.extensions[N].byteLength=d.byteLength,o.length=0,o.push(l),i.push(l),e.otherBufferViews.set(n,i)}}write(e){let s=0;for(const n in this._encoderBufferViews){const i=this._encoderBufferViews[n],a=this._encoderBufferViewData[n][0],u=e.otherBufferViewsIndexMap.get(a),h=this._encoderBufferViewAccessors[n];for(const T of h)T.bufferView=u;const f=e.jsonDoc.json.bufferViews[u],d=f.byteOffset||0;Object.assign(f,i),f.byteOffset=s;const l=f.extensions[N];l.byteOffset=d,s+=k.padNumber(i.byteLength)}const r=this._encoderFallbackBuffer,t=e.bufferIndexMap.get(r),o=e.jsonDoc.json.buffers[t];return o.byteLength=s,o.extensions={[N]:{fallback:!0}},r.dispose(),this}}et.EXTENSION_NAME=N;et.EncoderMethod=de;class is{match(e){return e.length>=12&&k.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const s=new DataView(e.buffer,e.byteOffset,e.byteLength);let r=ve(s,0);if(!r)return null;let t=r.end;for(;r=ve(s,t);)if(r.type==="meta")t=r.start+4;else if(r.type==="iprp"||r.type==="ipco")t=r.start;else{if(r.type==="ispe")return[s.getUint32(r.start+4),s.getUint32(r.start+8)];if(r.type==="mdat")break;t=r.end}return null}getChannels(e){return 4}}class as extends E{constructor(...e){super(...e),this.extensionName=he,this.prereadTypes=[p.TEXTURE]}static register(){Ae.registerFormat("image/avif",new is)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(r=>{r.extensions&&r.extensions[he]&&(r.source=r.extensions[he].source)}),this}read(e){return this}write(e){const s=e.jsonDoc;return this.document.getRoot().listTextures().forEach(r=>{if(r.getMimeType()==="image/avif"){const t=e.imageIndexMap.get(r);(s.json.textures||[]).forEach(n=>{n.source===t&&(n.extensions=n.extensions||{},n.extensions[he]={source:n.source},delete n.source)})}}),this}}as.EXTENSION_NAME=he;function ve(c,e){if(c.byteLength<4+e)return null;const s=c.getUint32(e);return c.byteLength<s+e||s<8?null:{type:k.decodeText(new Uint8Array(c.buffer,c.byteOffset+e+4,4)),start:e+8,end:e+s}}class cs{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const s=k.decodeText(e.slice(0,4)),r=k.decodeText(e.slice(8,12));if(s!=="RIFF"||r!=="WEBP")return null;const t=new DataView(e.buffer,e.byteOffset);let o=12;for(;o<t.byteLength;){const n=k.decodeText(new Uint8Array([t.getUint8(o),t.getUint8(o+1),t.getUint8(o+2),t.getUint8(o+3)])),i=t.getUint32(o+4,!0);if(n==="VP8 "){const a=t.getInt16(o+14,!0)&16383,u=t.getInt16(o+16,!0)&16383;return[a,u]}else if(n==="VP8L"){const a=t.getUint8(o+9),u=t.getUint8(o+10),h=t.getUint8(o+11),f=t.getUint8(o+12),d=1+((u&63)<<8|a),l=1+((f&15)<<10|h<<2|(u&192)>>6);return[d,l]}o+=8+i+i%2}return null}getChannels(e){return 4}}class us extends E{constructor(...e){super(...e),this.extensionName=le,this.prereadTypes=[p.TEXTURE]}static register(){Ae.registerFormat("image/webp",new cs)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(r=>{r.extensions&&r.extensions[le]&&(r.source=r.extensions[le].source)}),this}read(e){return this}write(e){const s=e.jsonDoc;return this.document.getRoot().listTextures().forEach(r=>{if(r.getMimeType()==="image/webp"){const t=e.imageIndexMap.get(r);(s.json.textures||[]).forEach(n=>{n.source===t&&(n.extensions=n.extensions||{},n.extensions[le]={source:n.source},delete n.source)})}}),this}}us.EXTENSION_NAME=le;let y,tt,st;function fs(c,e){const s=new y.DecoderBuffer;try{if(s.Init(e,e.length),c.GetEncodedGeometryType(s)!==y.TRIANGULAR_MESH)throw new Error(`[${I}] Unknown geometry type.`);const t=new y.Mesh;if(!c.DecodeBufferToMesh(s,t).ok()||t.ptr===0)throw new Error(`[${I}] Decoding failure.`);return t}finally{y.destroy(s)}}function ls(c,e){const r=e.num_faces()*3;let t,o;if(e.num_points()<=65534){const n=r*Uint16Array.BYTES_PER_ELEMENT;t=y._malloc(n),c.GetTrianglesUInt16Array(e,n,t),o=new Uint16Array(y.HEAPU16.buffer,t,r).slice()}else{const n=r*Uint32Array.BYTES_PER_ELEMENT;t=y._malloc(n),c.GetTrianglesUInt32Array(e,n,t),o=new Uint32Array(y.HEAPU32.buffer,t,r).slice()}return y._free(t),o}function hs(c,e,s,r){const t=st[r.componentType],o=tt[r.componentType],n=s.num_components(),a=e.num_points()*n,u=a*o.BYTES_PER_ELEMENT,h=y._malloc(u);c.GetAttributeDataArrayForAllPoints(e,s,t,u,h);const f=new o(y.HEAPF32.buffer,h,a).slice();return y._free(h),f}function ps(c){y=c,tt={[m.ComponentType.FLOAT]:Float32Array,[m.ComponentType.UNSIGNED_INT]:Uint32Array,[m.ComponentType.UNSIGNED_SHORT]:Uint16Array,[m.ComponentType.UNSIGNED_BYTE]:Uint8Array,[m.ComponentType.SHORT]:Int16Array,[m.ComponentType.BYTE]:Int8Array},st={[m.ComponentType.FLOAT]:y.DT_FLOAT32,[m.ComponentType.UNSIGNED_INT]:y.DT_UINT32,[m.ComponentType.UNSIGNED_SHORT]:y.DT_UINT16,[m.ComponentType.UNSIGNED_BYTE]:y.DT_UINT8,[m.ComponentType.SHORT]:y.DT_INT16,[m.ComponentType.BYTE]:y.DT_INT8}}let U;var Te;(function(c){c[c.EDGEBREAKER=1]="EDGEBREAKER",c[c.SEQUENTIAL=0]="SEQUENTIAL"})(Te||(Te={}));var L;(function(c){c.POSITION="POSITION",c.NORMAL="NORMAL",c.COLOR="COLOR",c.TEX_COORD="TEX_COORD",c.GENERIC="GENERIC"})(L||(L={}));const nt={[L.POSITION]:14,[L.NORMAL]:10,[L.COLOR]:8,[L.TEX_COORD]:12,[L.GENERIC]:12},Pe={decodeSpeed:5,encodeSpeed:5,method:Te.EDGEBREAKER,quantizationBits:nt,quantizationVolume:"mesh"};function ds(c){U=c}function Ts(c,e=Pe){const s=ee({},Pe,e);s.quantizationBits=ee({},nt,e.quantizationBits);const r=new U.MeshBuilder,t=new U.Mesh,o=new U.ExpertEncoder(t),n={},i=new U.DracoInt8Array,a=c.listTargets().length>0;let u=!1;for(const g of c.listSemantics()){const x=c.getAttribute(g);if(x.getSparse()){u=!0;continue}const C=gs(g),H=xs(r,x.getComponentType(),t,U[C],x.getCount(),x.getElementSize(),x.getArray());if(H===-1)throw new Error(`Error compressing "${g}" attribute.`);if(n[g]=H,s.quantizationVolume==="mesh"||g!=="POSITION")o.SetAttributeQuantization(H,s.quantizationBits[C]);else if(typeof s.quantizationVolume=="object"){const{quantizationVolume:w}=s,oe=Math.max(w.max[0]-w.min[0],w.max[1]-w.min[1],w.max[2]-w.min[2]);o.SetAttributeExplicitQuantization(H,s.quantizationBits[C],x.getElementSize(),w.min,oe)}else throw new Error("Invalid quantization volume state.")}const h=c.getIndices();if(!h)throw new De("Primitive must have indices.");r.AddFacesToMesh(t,h.getCount()/3,h.getArray()),o.SetSpeedOptions(s.encodeSpeed,s.decodeSpeed),o.SetTrackEncodedProperties(!0),s.method===Te.SEQUENTIAL||a||u?o.SetEncodingMethod(U.MESH_SEQUENTIAL_ENCODING):o.SetEncodingMethod(U.MESH_EDGEBREAKER_ENCODING);const f=o.EncodeToDracoBuffer(!(a||u),i);if(f<=0)throw new De("Error applying Draco compression.");const d=new Uint8Array(f);for(let g=0;g<f;++g)d[g]=i.GetValue(g);const l=o.GetNumberOfEncodedPoints(),T=o.GetNumberOfEncodedFaces()*3;return U.destroy(i),U.destroy(t),U.destroy(r),U.destroy(o),{numVertices:l,numIndices:T,data:d,attributeIDs:n}}function gs(c){return c==="POSITION"?L.POSITION:c==="NORMAL"?L.NORMAL:c.startsWith("COLOR_")?L.COLOR:c.startsWith("TEXCOORD_")?L.TEX_COORD:L.GENERIC}function xs(c,e,s,r,t,o,n){switch(e){case m.ComponentType.UNSIGNED_BYTE:return c.AddUInt8Attribute(s,r,t,o,n);case m.ComponentType.BYTE:return c.AddInt8Attribute(s,r,t,o,n);case m.ComponentType.UNSIGNED_SHORT:return c.AddUInt16Attribute(s,r,t,o,n);case m.ComponentType.SHORT:return c.AddInt16Attribute(s,r,t,o,n);case m.ComponentType.UNSIGNED_INT:return c.AddUInt32Attribute(s,r,t,o,n);case m.ComponentType.FLOAT:return c.AddFloatAttribute(s,r,t,o,n);default:throw new Error(`Unexpected component type, "${e}".`)}}class De extends Error{}class rt extends E{constructor(...e){super(...e),this.extensionName=I,this.prereadTypes=[p.PRIMITIVE],this.prewriteTypes=[p.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,s){return e==="draco3d.decoder"&&(this._decoderModule=s,ps(this._decoderModule)),e==="draco3d.encoder"&&(this._encoderModule=s,ds(this._encoderModule)),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${I}] Please install extension dependency, "draco3d.decoder".`);const s=this.document.getLogger(),r=e.jsonDoc,t=new Map;try{const o=r.json.meshes||[];for(const n of o)for(const i of n.primitives){if(!i.extensions||!i.extensions[I])continue;const a=i.extensions[I];let[u,h]=t.get(a.bufferView)||[];if(!h||!u){const f=r.json.bufferViews[a.bufferView],d=r.json.buffers[f.buffer],l=d.uri?r.resources[d.uri]:r.resources[Ye],T=f.byteOffset||0,g=f.byteLength,x=k.toView(l,T,g);u=new this._decoderModule.Decoder,h=fs(u,x),t.set(a.bufferView,[u,h]),s.debug(`[${I}] Decompressed ${x.byteLength} bytes.`)}for(const f in a.attributes){const d=e.jsonDoc.json.accessors[i.attributes[f]],l=u.GetAttributeByUniqueId(h,a.attributes[f]),T=hs(u,h,l,d);e.accessors[i.attributes[f]].setArray(T)}i.indices!==void 0&&e.accessors[i.indices].setArray(ls(u,h))}}finally{for(const[o,n]of Array.from(t.values()))this._decoderModule.destroy(o),this._decoderModule.destroy(n)}return this}read(e){return this}prewrite(e,s){if(!this._encoderModule)throw new Error(`[${I}] Please install extension dependency, "draco3d.encoder".`);const r=this.document.getLogger();r.debug(`[${I}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const t=ms(this.document),o=new Map;let n="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?r.warn(`[${I}]: quantizationVolume=scene requires exactly 1 scene.`):n=bt(this.document.getRoot().listScenes().pop()));for(const i of Array.from(t.keys())){const a=t.get(i);if(!a)throw new Error("Unexpected primitive.");if(o.has(a)){o.set(a,o.get(a));continue}const u=i.getIndices(),h=e.jsonDoc.json.accessors;let f;try{f=Ts(i,ee({},this._encoderOptions,{quantizationVolume:n}))}catch(T){if(T instanceof De){r.warn(`[${I}]: ${T.message} Skipping primitive compression.`);continue}throw T}o.set(a,f);const d=e.createAccessorDef(u);d.count=f.numIndices,e.accessorIndexMap.set(u,h.length),h.push(d),f.numVertices>65534&&m.getComponentSize(d.componentType)<=2?d.componentType=m.ComponentType.UNSIGNED_INT:f.numVertices>254&&m.getComponentSize(d.componentType)<=1&&(d.componentType=m.ComponentType.UNSIGNED_SHORT);for(const T of i.listSemantics()){const g=i.getAttribute(T);if(f.attributeIDs[T]===void 0)continue;const x=e.createAccessorDef(g);x.count=f.numVertices,e.accessorIndexMap.set(g,h.length),h.push(x)}const l=i.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(l)||e.otherBufferViews.set(l,[]),e.otherBufferViews.get(l).push(f.data)}return r.debug(`[${I}] Compressed ${t.size} primitives.`),e.extensionData[I]={primitiveHashMap:t,primitiveEncodingMap:o},this}write(e){const s=e.extensionData[I];for(const r of this.document.getRoot().listMeshes()){const t=e.jsonDoc.json.meshes[e.meshIndexMap.get(r)];for(let o=0;o<r.listPrimitives().length;o++){const n=r.listPrimitives()[o],i=t.primitives[o],a=s.primitiveHashMap.get(n);if(!a)continue;const u=s.primitiveEncodingMap.get(a);u&&(i.extensions=i.extensions||{},i.extensions[I]={bufferView:e.otherBufferViewsIndexMap.get(u.data),attributes:u.attributeIDs})}}if(!s.primitiveHashMap.size){const r=e.jsonDoc.json;r.extensionsUsed=(r.extensionsUsed||[]).filter(t=>t!==I),r.extensionsRequired=(r.extensionsRequired||[]).filter(t=>t!==I)}return this}}rt.EXTENSION_NAME=I;rt.EncoderMethod=Te;function ms(c){const e=c.getLogger(),s=new Set,r=new Set;let t=0,o=0;for(const f of c.getRoot().listMeshes())for(const d of f.listPrimitives())d.getIndices()?d.getMode()!==Re.Mode.TRIANGLES?(r.add(d),o++):s.add(d):(r.add(d),t++);t>0&&e.warn(`[${I}] Skipping Draco compression of ${t} non-indexed primitives.`),o>0&&e.warn(`[${I}] Skipping Draco compression of ${o} non-TRIANGLES primitives.`);const n=c.getRoot().listAccessors(),i=new Map;for(let f=0;f<n.length;f++)i.set(n[f],f);const a=new Map,u=new Set,h=new Map;for(const f of Array.from(s)){let d=Ge(f,i);if(u.has(d)){h.set(f,d);continue}if(a.has(f.getIndices())){const l=f.getIndices(),T=l.clone();i.set(T,c.getRoot().listAccessors().length-1),f.swap(l,T)}for(const l of f.listAttributes())if(a.has(l)){const T=l.clone();i.set(T,c.getRoot().listAccessors().length-1),f.swap(l,T)}d=Ge(f,i),u.add(d),h.set(f,d),a.set(f.getIndices(),d);for(const l of f.listAttributes())a.set(l,d)}for(const f of Array.from(a.keys())){const d=new Set(f.listParents().map(l=>l.propertyType));if(d.size!==2||!d.has(p.PRIMITIVE)||!d.has(p.ROOT))throw new Error(`[${I}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const f of Array.from(s)){const d=h.get(f),l=f.getIndices();if(a.get(l)!==d||f.listAttributes().some(T=>a.get(T)!==d))throw new Error(`[${I}] Draco primitives must share all, or no, accessors.`)}for(const f of Array.from(r)){const d=f.getIndices();if(a.has(d)||f.listAttributes().some(l=>a.has(l)))throw new Error(`[${I}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return h}function Ge(c,e){const s=[],r=c.getIndices();s.push(e.get(r));for(const t of c.listAttributes())s.push(e.get(t));return s.sort().join("|")}class ae extends _{init(){this.extensionName=j,this.propertyType="Light",this.parentTypes=[p.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:ae.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}ae.EXTENSION_NAME=j;ae.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};class Es extends E{constructor(...e){super(...e),this.extensionName=j}createLight(e=""){return new ae(this.document.getGraph(),e)}read(e){const s=e.jsonDoc;if(!s.json.extensions||!s.json.extensions[j])return this;const o=(s.json.extensions[j].lights||[]).map(n=>{var i,a;const u=this.createLight().setName(n.name||"").setType(n.type);return n.color!==void 0&&u.setColor(n.color),n.intensity!==void 0&&u.setIntensity(n.intensity),n.range!==void 0&&u.setRange(n.range),((i=n.spot)==null?void 0:i.innerConeAngle)!==void 0&&u.setInnerConeAngle(n.spot.innerConeAngle),((a=n.spot)==null?void 0:a.outerConeAngle)!==void 0&&u.setOuterConeAngle(n.spot.outerConeAngle),u});return s.json.nodes.forEach((n,i)=>{if(!n.extensions||!n.extensions[j])return;const a=n.extensions[j];e.nodes[i].setExtension(j,o[a.light])}),this}write(e){const s=e.jsonDoc;if(this.properties.size===0)return this;const r=[],t=new Map;for(const o of this.properties){const n=o,i={type:n.getType()};ge.eq(n.getColor(),[1,1,1])||(i.color=n.getColor()),n.getIntensity()!==1&&(i.intensity=n.getIntensity()),n.getRange()!=null&&(i.range=n.getRange()),n.getName()&&(i.name=n.getName()),n.getType()===ae.Type.SPOT&&(i.spot={innerConeAngle:n.getInnerConeAngle(),outerConeAngle:n.getOuterConeAngle()}),r.push(i),t.set(n,r.length-1)}return this.document.getRoot().listNodes().forEach(o=>{const n=o.getExtension(j);if(n){const i=e.nodeIndexMap.get(o),a=s.json.nodes[i];a.extensions=a.extensions||{},a.extensions[j]={light:t.get(n)}}}),s.json.extensions=s.json.extensions||{},s.json.extensions[j]={lights:r},this}}Es.EXTENSION_NAME=j;const{R:Is,G:Rs,B:_s}=te;class ot extends _{init(){this.extensionName=P,this.propertyType="Anisotropy",this.parentTypes=[p.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new S(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:Is|Rs|_s})}}ot.EXTENSION_NAME=P;class ys extends E{constructor(...e){super(...e),this.extensionName=P,this.prereadTypes=[p.MESH],this.prewriteTypes=[p.MESH]}createAnisotropy(){return new ot(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const s=e.jsonDoc,r=s.json.materials||[],t=s.json.textures||[];return r.forEach((o,n)=>{if(o.extensions&&o.extensions[P]){const i=this.createAnisotropy();e.materials[n].setExtension(P,i);const a=o.extensions[P];if(a.anisotropyStrength!==void 0&&i.setAnisotropyStrength(a.anisotropyStrength),a.anisotropyRotation!==void 0&&i.setAnisotropyRotation(a.anisotropyRotation),a.anisotropyTexture!==void 0){const u=a.anisotropyTexture,h=e.textures[t[u.index].source];i.setAnisotropyTexture(h),e.setTextureInfo(i.getAnisotropyTextureInfo(),u)}}}),this}prewrite(e){const s=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const t=r.getExtension(P);if(t){const o=e.materialIndexMap.get(r),n=s.json.materials[o];n.extensions=n.extensions||{};const i=n.extensions[P]={};if(t.getAnisotropyStrength()>0&&(i.anisotropyStrength=t.getAnisotropyStrength()),t.getAnisotropyRotation()!==0&&(i.anisotropyRotation=t.getAnisotropyRotation()),t.getAnisotropyTexture()){const a=t.getAnisotropyTexture(),u=t.getAnisotropyTextureInfo();i.anisotropyTexture=e.createTextureInfoDef(a,u)}}}),this}}ys.EXTENSION_NAME=P;const{R:Ve,G:Ke,B:Ns}=te;class it extends _{init(){this.extensionName=G,this.propertyType="Clearcoat",this.parentTypes=[p.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new S(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new S(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new S(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:Ve})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:Ke})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:Ve|Ke|Ns})}}it.EXTENSION_NAME=G;class Ds extends E{constructor(...e){super(...e),this.extensionName=G,this.prereadTypes=[p.MESH],this.prewriteTypes=[p.MESH]}createClearcoat(){return new it(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const s=e.jsonDoc,r=s.json.materials||[],t=s.json.textures||[];return r.forEach((o,n)=>{if(o.extensions&&o.extensions[G]){const i=this.createClearcoat();e.materials[n].setExtension(G,i);const a=o.extensions[G];if(a.clearcoatFactor!==void 0&&i.setClearcoatFactor(a.clearcoatFactor),a.clearcoatRoughnessFactor!==void 0&&i.setClearcoatRoughnessFactor(a.clearcoatRoughnessFactor),a.clearcoatTexture!==void 0){const u=a.clearcoatTexture,h=e.textures[t[u.index].source];i.setClearcoatTexture(h),e.setTextureInfo(i.getClearcoatTextureInfo(),u)}if(a.clearcoatRoughnessTexture!==void 0){const u=a.clearcoatRoughnessTexture,h=e.textures[t[u.index].source];i.setClearcoatRoughnessTexture(h),e.setTextureInfo(i.getClearcoatRoughnessTextureInfo(),u)}if(a.clearcoatNormalTexture!==void 0){const u=a.clearcoatNormalTexture,h=e.textures[t[u.index].source];i.setClearcoatNormalTexture(h),e.setTextureInfo(i.getClearcoatNormalTextureInfo(),u),u.scale!==void 0&&i.setClearcoatNormalScale(u.scale)}}}),this}prewrite(e){const s=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const t=r.getExtension(G);if(t){const o=e.materialIndexMap.get(r),n=s.json.materials[o];n.extensions=n.extensions||{};const i=n.extensions[G]={clearcoatFactor:t.getClearcoatFactor(),clearcoatRoughnessFactor:t.getClearcoatRoughnessFactor()};if(t.getClearcoatTexture()){const a=t.getClearcoatTexture(),u=t.getClearcoatTextureInfo();i.clearcoatTexture=e.createTextureInfoDef(a,u)}if(t.getClearcoatRoughnessTexture()){const a=t.getClearcoatRoughnessTexture(),u=t.getClearcoatRoughnessTextureInfo();i.clearcoatRoughnessTexture=e.createTextureInfoDef(a,u)}if(t.getClearcoatNormalTexture()){const a=t.getClearcoatNormalTexture(),u=t.getClearcoatNormalTextureInfo();i.clearcoatNormalTexture=e.createTextureInfoDef(a,u),t.getClearcoatNormalScale()!==1&&(i.clearcoatNormalTexture.scale=t.getClearcoatNormalScale())}}}),this}}Ds.EXTENSION_NAME=G;const{R:Ss,G:As,B:Ms,A:Os}=te;class at extends _{init(){this.extensionName=V,this.propertyType="DiffuseTransmission",this.parentTypes=[p.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseTransmissionFactor:0,diffuseTransmissionTexture:null,diffuseTransmissionTextureInfo:new S(this.graph,"diffuseTransmissionTextureInfo"),diffuseTransmissionColorFactor:[1,1,1],diffuseTransmissionColorTexture:null,diffuseTransmissionColorTextureInfo:new S(this.graph,"diffuseTransmissionColorTextureInfo")})}getDiffuseTransmissionFactor(){return this.get("diffuseTransmissionFactor")}setDiffuseTransmissionFactor(e){return this.set("diffuseTransmissionFactor",e)}getDiffuseTransmissionTexture(){return this.getRef("diffuseTransmissionTexture")}getDiffuseTransmissionTextureInfo(){return this.getRef("diffuseTransmissionTexture")?this.getRef("diffuseTransmissionTextureInfo"):null}setDiffuseTransmissionTexture(e){return this.setRef("diffuseTransmissionTexture",e,{channels:Os})}getDiffuseTransmissionColorFactor(){return this.get("diffuseTransmissionColorFactor")}setDiffuseTransmissionColorFactor(e){return this.set("diffuseTransmissionColorFactor",e)}getDiffuseTransmissionColorTexture(){return this.getRef("diffuseTransmissionColorTexture")}getDiffuseTransmissionColorTextureInfo(){return this.getRef("diffuseTransmissionColorTexture")?this.getRef("diffuseTransmissionColorTextureInfo"):null}setDiffuseTransmissionColorTexture(e){return this.setRef("diffuseTransmissionColorTexture",e,{channels:Ss|As|Ms})}}at.EXTENSION_NAME=V;class Cs extends E{constructor(...e){super(...e),this.extensionName=V}createDiffuseTransmission(){return new at(this.document.getGraph())}read(e){const s=e.jsonDoc,r=s.json.materials||[],t=s.json.textures||[];return r.forEach((o,n)=>{if(o.extensions&&o.extensions[V]){const i=this.createDiffuseTransmission();e.materials[n].setExtension(V,i);const a=o.extensions[V];if(a.diffuseTransmissionFactor!==void 0&&i.setDiffuseTransmissionFactor(a.diffuseTransmissionFactor),a.diffuseTransmissionColorFactor!==void 0&&i.setDiffuseTransmissionColorFactor(a.diffuseTransmissionColorFactor),a.diffuseTransmissionTexture!==void 0){const u=a.diffuseTransmissionTexture,h=e.textures[t[u.index].source];i.setDiffuseTransmissionTexture(h),e.setTextureInfo(i.getDiffuseTransmissionTextureInfo(),u)}if(a.diffuseTransmissionColorTexture!==void 0){const u=a.diffuseTransmissionColorTexture,h=e.textures[t[u.index].source];i.setDiffuseTransmissionColorTexture(h),e.setTextureInfo(i.getDiffuseTransmissionColorTextureInfo(),u)}}}),this}write(e){const s=e.jsonDoc;for(const r of this.document.getRoot().listMaterials()){const t=r.getExtension(V);if(!t)continue;const o=e.materialIndexMap.get(r),n=s.json.materials[o];n.extensions=n.extensions||{};const i=n.extensions[V]={diffuseTransmissionFactor:t.getDiffuseTransmissionFactor(),diffuseTransmissionColorFactor:t.getDiffuseTransmissionColorFactor()};if(t.getDiffuseTransmissionTexture()){const a=t.getDiffuseTransmissionTexture(),u=t.getDiffuseTransmissionTextureInfo();i.diffuseTransmissionTexture=e.createTextureInfoDef(a,u)}if(t.getDiffuseTransmissionColorTexture()){const a=t.getDiffuseTransmissionColorTexture(),u=t.getDiffuseTransmissionColorTextureInfo();i.diffuseTransmissionColorTexture=e.createTextureInfoDef(a,u)}}return this}}Cs.EXTENSION_NAME=V;class ct extends _{init(){this.extensionName=K,this.propertyType="Dispersion",this.parentTypes=[p.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{dispersion:0})}getDispersion(){return this.get("dispersion")}setDispersion(e){return this.set("dispersion",e)}}ct.EXTENSION_NAME=K;class ws extends E{constructor(...e){super(...e),this.extensionName=K,this.prereadTypes=[p.MESH],this.prewriteTypes=[p.MESH]}createDispersion(){return new ct(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((t,o)=>{if(t.extensions&&t.extensions[K]){const n=this.createDispersion();e.materials[o].setExtension(K,n);const i=t.extensions[K];i.dispersion!==void 0&&n.setDispersion(i.dispersion)}}),this}prewrite(e){const s=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const t=r.getExtension(K);if(t){const o=e.materialIndexMap.get(r),n=s.json.materials[o];n.extensions=n.extensions||{},n.extensions[K]={dispersion:t.getDispersion()}}}),this}}ws.EXTENSION_NAME=K;class ut extends _{init(){this.extensionName=X,this.propertyType="EmissiveStrength",this.parentTypes=[p.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}ut.EXTENSION_NAME=X;class bs extends E{constructor(...e){super(...e),this.extensionName=X,this.prereadTypes=[p.MESH],this.prewriteTypes=[p.MESH]}createEmissiveStrength(){return new ut(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((t,o)=>{if(t.extensions&&t.extensions[X]){const n=this.createEmissiveStrength();e.materials[o].setExtension(X,n);const i=t.extensions[X];i.emissiveStrength!==void 0&&n.setEmissiveStrength(i.emissiveStrength)}}),this}prewrite(e){const s=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const t=r.getExtension(X);if(t){const o=e.materialIndexMap.get(r),n=s.json.materials[o];n.extensions=n.extensions||{},n.extensions[X]={emissiveStrength:t.getEmissiveStrength()}}}),this}}bs.EXTENSION_NAME=X;class ft extends _{init(){this.extensionName=$,this.propertyType="IOR",this.parentTypes=[p.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}ft.EXTENSION_NAME=$;class Fs extends E{constructor(...e){super(...e),this.extensionName=$,this.prereadTypes=[p.MESH],this.prewriteTypes=[p.MESH]}createIOR(){return new ft(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((t,o)=>{if(t.extensions&&t.extensions[$]){const n=this.createIOR();e.materials[o].setExtension($,n);const i=t.extensions[$];i.ior!==void 0&&n.setIOR(i.ior)}}),this}prewrite(e){const s=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const t=r.getExtension($);if(t){const o=e.materialIndexMap.get(r),n=s.json.materials[o];n.extensions=n.extensions||{},n.extensions[$]={ior:t.getIOR()}}}),this}}Fs.EXTENSION_NAME=$;const{R:Us,G:js}=te;class lt extends _{init(){this.extensionName=z,this.propertyType="Iridescence",this.parentTypes=[p.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new S(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new S(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:Us})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:js})}}lt.EXTENSION_NAME=z;class Bs extends E{constructor(...e){super(...e),this.extensionName=z,this.prereadTypes=[p.MESH],this.prewriteTypes=[p.MESH]}createIridescence(){return new lt(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const s=e.jsonDoc,r=s.json.materials||[],t=s.json.textures||[];return r.forEach((o,n)=>{if(o.extensions&&o.extensions[z]){const i=this.createIridescence();e.materials[n].setExtension(z,i);const a=o.extensions[z];if(a.iridescenceFactor!==void 0&&i.setIridescenceFactor(a.iridescenceFactor),a.iridescenceIor!==void 0&&i.setIridescenceIOR(a.iridescenceIor),a.iridescenceThicknessMinimum!==void 0&&i.setIridescenceThicknessMinimum(a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&i.setIridescenceThicknessMaximum(a.iridescenceThicknessMaximum),a.iridescenceTexture!==void 0){const u=a.iridescenceTexture,h=e.textures[t[u.index].source];i.setIridescenceTexture(h),e.setTextureInfo(i.getIridescenceTextureInfo(),u)}if(a.iridescenceThicknessTexture!==void 0){const u=a.iridescenceThicknessTexture,h=e.textures[t[u.index].source];i.setIridescenceThicknessTexture(h),e.setTextureInfo(i.getIridescenceThicknessTextureInfo(),u)}}}),this}prewrite(e){const s=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const t=r.getExtension(z);if(t){const o=e.materialIndexMap.get(r),n=s.json.materials[o];n.extensions=n.extensions||{};const i=n.extensions[z]={};if(t.getIridescenceFactor()>0&&(i.iridescenceFactor=t.getIridescenceFactor()),t.getIridescenceIOR()!==1.3&&(i.iridescenceIor=t.getIridescenceIOR()),t.getIridescenceThicknessMinimum()!==100&&(i.iridescenceThicknessMinimum=t.getIridescenceThicknessMinimum()),t.getIridescenceThicknessMaximum()!==400&&(i.iridescenceThicknessMaximum=t.getIridescenceThicknessMaximum()),t.getIridescenceTexture()){const a=t.getIridescenceTexture(),u=t.getIridescenceTextureInfo();i.iridescenceTexture=e.createTextureInfoDef(a,u)}if(t.getIridescenceThicknessTexture()){const a=t.getIridescenceThicknessTexture(),u=t.getIridescenceThicknessTextureInfo();i.iridescenceThicknessTexture=e.createTextureInfoDef(a,u)}}}),this}}Bs.EXTENSION_NAME=z;const{R:Xe,G:$e,B:ze,A:qe}=te;class ht extends _{init(){this.extensionName=q,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[p.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new S(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new S(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:Xe|$e|ze|qe,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:Xe|$e|ze|qe})}}ht.EXTENSION_NAME=q;class Ls extends E{constructor(...e){super(...e),this.extensionName=q,this.prereadTypes=[p.MESH],this.prewriteTypes=[p.MESH]}createPBRSpecularGlossiness(){return new ht(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const s=e.jsonDoc,r=s.json.materials||[],t=s.json.textures||[];return r.forEach((o,n)=>{if(o.extensions&&o.extensions[q]){const i=this.createPBRSpecularGlossiness();e.materials[n].setExtension(q,i);const a=o.extensions[q];if(a.diffuseFactor!==void 0&&i.setDiffuseFactor(a.diffuseFactor),a.specularFactor!==void 0&&i.setSpecularFactor(a.specularFactor),a.glossinessFactor!==void 0&&i.setGlossinessFactor(a.glossinessFactor),a.diffuseTexture!==void 0){const u=a.diffuseTexture,h=e.textures[t[u.index].source];i.setDiffuseTexture(h),e.setTextureInfo(i.getDiffuseTextureInfo(),u)}if(a.specularGlossinessTexture!==void 0){const u=a.specularGlossinessTexture,h=e.textures[t[u.index].source];i.setSpecularGlossinessTexture(h),e.setTextureInfo(i.getSpecularGlossinessTextureInfo(),u)}}}),this}prewrite(e){const s=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const t=r.getExtension(q);if(t){const o=e.materialIndexMap.get(r),n=s.json.materials[o];n.extensions=n.extensions||{};const i=n.extensions[q]={diffuseFactor:t.getDiffuseFactor(),specularFactor:t.getSpecularFactor(),glossinessFactor:t.getGlossinessFactor()};if(t.getDiffuseTexture()){const a=t.getDiffuseTexture(),u=t.getDiffuseTextureInfo();i.diffuseTexture=e.createTextureInfoDef(a,u)}if(t.getSpecularGlossinessTexture()){const a=t.getSpecularGlossinessTexture(),u=t.getSpecularGlossinessTextureInfo();i.specularGlossinessTexture=e.createTextureInfoDef(a,u)}}}),this}}Ls.EXTENSION_NAME=q;const{R:ks,G:Hs,B:vs,A:Ps}=te;class pt extends _{init(){this.extensionName=Y,this.propertyType="Sheen",this.parentTypes=[p.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new S(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new S(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:ks|Hs|vs,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:Ps})}}pt.EXTENSION_NAME=Y;class Gs extends E{constructor(...e){super(...e),this.extensionName=Y,this.prereadTypes=[p.MESH],this.prewriteTypes=[p.MESH]}createSheen(){return new pt(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const s=e.jsonDoc,r=s.json.materials||[],t=s.json.textures||[];return r.forEach((o,n)=>{if(o.extensions&&o.extensions[Y]){const i=this.createSheen();e.materials[n].setExtension(Y,i);const a=o.extensions[Y];if(a.sheenColorFactor!==void 0&&i.setSheenColorFactor(a.sheenColorFactor),a.sheenRoughnessFactor!==void 0&&i.setSheenRoughnessFactor(a.sheenRoughnessFactor),a.sheenColorTexture!==void 0){const u=a.sheenColorTexture,h=e.textures[t[u.index].source];i.setSheenColorTexture(h),e.setTextureInfo(i.getSheenColorTextureInfo(),u)}if(a.sheenRoughnessTexture!==void 0){const u=a.sheenRoughnessTexture,h=e.textures[t[u.index].source];i.setSheenRoughnessTexture(h),e.setTextureInfo(i.getSheenRoughnessTextureInfo(),u)}}}),this}prewrite(e){const s=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const t=r.getExtension(Y);if(t){const o=e.materialIndexMap.get(r),n=s.json.materials[o];n.extensions=n.extensions||{};const i=n.extensions[Y]={sheenColorFactor:t.getSheenColorFactor(),sheenRoughnessFactor:t.getSheenRoughnessFactor()};if(t.getSheenColorTexture()){const a=t.getSheenColorTexture(),u=t.getSheenColorTextureInfo();i.sheenColorTexture=e.createTextureInfoDef(a,u)}if(t.getSheenRoughnessTexture()){const a=t.getSheenRoughnessTexture(),u=t.getSheenRoughnessTextureInfo();i.sheenRoughnessTexture=e.createTextureInfoDef(a,u)}}}),this}}Gs.EXTENSION_NAME=Y;const{R:Vs,G:Ks,B:Xs,A:$s}=te;class dt extends _{init(){this.extensionName=W,this.propertyType="Specular",this.parentTypes=[p.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new S(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new S(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:$s})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:Vs|Ks|Xs,isColor:!0})}}dt.EXTENSION_NAME=W;class zs extends E{constructor(...e){super(...e),this.extensionName=W,this.prereadTypes=[p.MESH],this.prewriteTypes=[p.MESH]}createSpecular(){return new dt(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const s=e.jsonDoc,r=s.json.materials||[],t=s.json.textures||[];return r.forEach((o,n)=>{if(o.extensions&&o.extensions[W]){const i=this.createSpecular();e.materials[n].setExtension(W,i);const a=o.extensions[W];if(a.specularFactor!==void 0&&i.setSpecularFactor(a.specularFactor),a.specularColorFactor!==void 0&&i.setSpecularColorFactor(a.specularColorFactor),a.specularTexture!==void 0){const u=a.specularTexture,h=e.textures[t[u.index].source];i.setSpecularTexture(h),e.setTextureInfo(i.getSpecularTextureInfo(),u)}if(a.specularColorTexture!==void 0){const u=a.specularColorTexture,h=e.textures[t[u.index].source];i.setSpecularColorTexture(h),e.setTextureInfo(i.getSpecularColorTextureInfo(),u)}}}),this}prewrite(e){const s=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const t=r.getExtension(W);if(t){const o=e.materialIndexMap.get(r),n=s.json.materials[o];n.extensions=n.extensions||{};const i=n.extensions[W]={};if(t.getSpecularFactor()!==1&&(i.specularFactor=t.getSpecularFactor()),ge.eq(t.getSpecularColorFactor(),[1,1,1])||(i.specularColorFactor=t.getSpecularColorFactor()),t.getSpecularTexture()){const a=t.getSpecularTexture(),u=t.getSpecularTextureInfo();i.specularTexture=e.createTextureInfoDef(a,u)}if(t.getSpecularColorTexture()){const a=t.getSpecularColorTexture(),u=t.getSpecularColorTextureInfo();i.specularColorTexture=e.createTextureInfoDef(a,u)}}}),this}}zs.EXTENSION_NAME=W;const{R:qs}=te;class Tt extends _{init(){this.extensionName=Q,this.propertyType="Transmission",this.parentTypes=[p.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new S(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:qs})}}Tt.EXTENSION_NAME=Q;class Ys extends E{constructor(...e){super(...e),this.extensionName=Q,this.prereadTypes=[p.MESH],this.prewriteTypes=[p.MESH]}createTransmission(){return new Tt(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const s=e.jsonDoc,r=s.json.materials||[],t=s.json.textures||[];return r.forEach((o,n)=>{if(o.extensions&&o.extensions[Q]){const i=this.createTransmission();e.materials[n].setExtension(Q,i);const a=o.extensions[Q];if(a.transmissionFactor!==void 0&&i.setTransmissionFactor(a.transmissionFactor),a.transmissionTexture!==void 0){const u=a.transmissionTexture,h=e.textures[t[u.index].source];i.setTransmissionTexture(h),e.setTextureInfo(i.getTransmissionTextureInfo(),u)}}}),this}prewrite(e){const s=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const t=r.getExtension(Q);if(t){const o=e.materialIndexMap.get(r),n=s.json.materials[o];n.extensions=n.extensions||{};const i=n.extensions[Q]={transmissionFactor:t.getTransmissionFactor()};if(t.getTransmissionTexture()){const a=t.getTransmissionTexture(),u=t.getTransmissionTextureInfo();i.transmissionTexture=e.createTextureInfoDef(a,u)}}}),this}}Ys.EXTENSION_NAME=Q;class gt extends _{init(){this.extensionName=ne,this.propertyType="Unlit",this.parentTypes=[p.MATERIAL]}}gt.EXTENSION_NAME=ne;class Ws extends E{constructor(...e){super(...e),this.extensionName=ne,this.prereadTypes=[p.MESH],this.prewriteTypes=[p.MESH]}createUnlit(){return new gt(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((r,t)=>{r.extensions&&r.extensions[ne]&&e.materials[t].setExtension(ne,this.createUnlit())}),this}prewrite(e){const s=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{if(r.getExtension(ne)){const t=e.materialIndexMap.get(r),o=s.json.materials[t];o.extensions=o.extensions||{},o.extensions[ne]={}}}),this}}Ws.EXTENSION_NAME=ne;class xt extends _{init(){this.extensionName=D,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:new We})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}xt.EXTENSION_NAME=D;class mt extends _{init(){this.extensionName=D,this.propertyType="MappingList",this.parentTypes=[p.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:new We})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}mt.EXTENSION_NAME=D;class Se extends _{init(){this.extensionName=D,this.propertyType="Variant",this.parentTypes=["MappingList"]}}Se.EXTENSION_NAME=D;class Qs extends E{constructor(...e){super(...e),this.extensionName=D}createMappingList(){return new mt(this.document.getGraph())}createVariant(e=""){return new Se(this.document.getGraph(),e)}createMapping(){return new xt(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof Se)}read(e){const s=e.jsonDoc;if(!s.json.extensions||!s.json.extensions[D])return this;const o=(s.json.extensions[D].variants||[]).map(i=>this.createVariant().setName(i.name||""));return(s.json.meshes||[]).forEach((i,a)=>{const u=e.meshes[a];(i.primitives||[]).forEach((f,d)=>{if(!f.extensions||!f.extensions[D])return;const l=this.createMappingList(),T=f.extensions[D];for(const g of T.mappings){const x=this.createMapping();g.material!==void 0&&x.setMaterial(e.materials[g.material]);for(const C of g.variants||[])x.addVariant(o[C]);l.addMapping(x)}u.listPrimitives()[d].setExtension(D,l)})}),this}write(e){const s=e.jsonDoc,r=this.listVariants();if(!r.length)return this;const t=[],o=new Map;for(const n of r)o.set(n,t.length),t.push(e.createPropertyDef(n));for(const n of this.document.getRoot().listMeshes()){const i=e.meshIndexMap.get(n);n.listPrimitives().forEach((a,u)=>{const h=a.getExtension(D);if(!h)return;const f=e.jsonDoc.json.meshes[i].primitives[u],d=h.listMappings().map(l=>{const T=e.createPropertyDef(l),g=l.getMaterial();return g&&(T.material=e.materialIndexMap.get(g)),T.variants=l.listVariants().map(x=>o.get(x)),T});f.extensions=f.extensions||{},f.extensions[D]={mappings:d}})}return s.json.extensions=s.json.extensions||{},s.json.extensions[D]={variants:t},this}}Qs.EXTENSION_NAME=D;const{G:Js}=te;class Et extends _{init(){this.extensionName=J,this.propertyType="Volume",this.parentTypes=[p.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new S(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:Js})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}}Et.EXTENSION_NAME=J;class Zs extends E{constructor(...e){super(...e),this.extensionName=J,this.prereadTypes=[p.MESH],this.prewriteTypes=[p.MESH]}createVolume(){return new Et(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const s=e.jsonDoc,r=s.json.materials||[],t=s.json.textures||[];return r.forEach((o,n)=>{if(o.extensions&&o.extensions[J]){const i=this.createVolume();e.materials[n].setExtension(J,i);const a=o.extensions[J];if(a.thicknessFactor!==void 0&&i.setThicknessFactor(a.thicknessFactor),a.attenuationDistance!==void 0&&i.setAttenuationDistance(a.attenuationDistance),a.attenuationColor!==void 0&&i.setAttenuationColor(a.attenuationColor),a.thicknessTexture!==void 0){const u=a.thicknessTexture,h=e.textures[t[u.index].source];i.setThicknessTexture(h),e.setTextureInfo(i.getThicknessTextureInfo(),u)}}}),this}prewrite(e){const s=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const t=r.getExtension(J);if(t){const o=e.materialIndexMap.get(r),n=s.json.materials[o];n.extensions=n.extensions||{};const i=n.extensions[J]={};if(t.getThicknessFactor()>0&&(i.thicknessFactor=t.getThicknessFactor()),Number.isFinite(t.getAttenuationDistance())&&(i.attenuationDistance=t.getAttenuationDistance()),ge.eq(t.getAttenuationColor(),[1,1,1])||(i.attenuationColor=t.getAttenuationColor()),t.getThicknessTexture()){const a=t.getThicknessTexture(),u=t.getThicknessTextureInfo();i.thicknessTexture=e.createTextureInfoDef(a,u)}}}),this}}Zs.EXTENSION_NAME=J;class en extends E{constructor(...e){super(...e),this.extensionName=Qe}read(e){return this}write(e){return this}}en.EXTENSION_NAME=Qe;class tn{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const s=Ee(e);return[s.pixelWidth,s.pixelHeight]}getChannels(e){const r=Ee(e).dataFormatDescriptor[0];if(r.colorModel===Gt)return r.samples.length===2&&(r.samples[1].channelType&15)===15?4:3;if(r.colorModel===Vt)return(r.samples[0].channelType&15)===3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${r.colorModel}".`)}getVRAMByteLength(e){const s=Ee(e),r=this.getChannels(e)>3;let t=0;for(let o=0;o<s.levels.length;o++){const n=s.levels[o];if(n.uncompressedByteLength)t+=n.uncompressedByteLength;else{const i=Math.max(1,Math.floor(s.pixelWidth/Math.pow(2,o))),a=Math.max(1,Math.floor(s.pixelHeight/Math.pow(2,o))),u=r?16:8;t+=i/4*(a/4)*u}}return t}}class sn extends E{constructor(...e){super(...e),this.extensionName=pe,this.prereadTypes=[p.TEXTURE]}static register(){Ae.registerFormat("image/ktx2",new tn)}preread(e){return e.jsonDoc.json.textures.forEach(s=>{if(s.extensions&&s.extensions[pe]){const r=s.extensions[pe];s.source=r.source}}),this}read(e){return this}write(e){const s=e.jsonDoc;return this.document.getRoot().listTextures().forEach(r=>{if(r.getMimeType()==="image/ktx2"){const t=e.imageIndexMap.get(r);s.json.textures.forEach(o=>{o.source===t&&(o.extensions=o.extensions||{},o.extensions[pe]={source:o.source},delete o.source)})}}),this}}sn.EXTENSION_NAME=pe;class It extends _{init(){this.extensionName=Z,this.propertyType="Transform",this.parentTypes=[p.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}It.EXTENSION_NAME=Z;class nn extends E{constructor(...e){super(...e),this.extensionName=Z}createTransform(){return new It(this.document.getGraph())}read(e){for(const[s,r]of Array.from(e.textureInfos.entries())){if(!r.extensions||!r.extensions[Z])continue;const t=this.createTransform(),o=r.extensions[Z];o.offset!==void 0&&t.setOffset(o.offset),o.rotation!==void 0&&t.setRotation(o.rotation),o.scale!==void 0&&t.setScale(o.scale),o.texCoord!==void 0&&t.setTexCoord(o.texCoord),s.setExtension(Z,t)}return this}write(e){const s=Array.from(e.textureInfoDefMap.entries());for(const[r,t]of s){const o=r.getExtension(Z);if(!o)continue;t.extensions=t.extensions||{};const n={},i=ge.eq;i(o.getOffset(),[0,0])||(n.offset=o.getOffset()),o.getRotation()!==0&&(n.rotation=o.getRotation()),i(o.getScale(),[1,1])||(n.scale=o.getScale()),o.getTexCoord()!=null&&(n.texCoord=o.getTexCoord()),t.extensions[Z]=n}return this}}nn.EXTENSION_NAME=Z;const rn=[p.ROOT,p.SCENE,p.NODE,p.MESH,p.MATERIAL,p.TEXTURE,p.ANIMATION];class Rt extends _{init(){this.extensionName=B,this.propertyType="Packet",this.parentTypes=rn}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",ee({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const s=this.get("properties");return e in s?s[e]:null}setProperty(e,s){this._assertContext(e);const r=ee({},this.get("properties"));return s?r[e]=s:delete r[e],this.set("properties",r)}toJSONLD(){const e=Ie(this.get("context")),s=Ie(this.get("properties"));return ee({"@context":e},s)}fromJSONLD(e){e=Ie(e);const s=e["@context"];return s&&this.set("context",s),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`${B}: Missing context for term, "${e}".`)}}Rt.EXTENSION_NAME=B;function Ie(c){return JSON.parse(JSON.stringify(c))}class on extends E{constructor(...e){super(...e),this.extensionName=B}createPacket(){return new Rt(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var s;const r=(s=e.jsonDoc.json.extensions)==null?void 0:s[B];if(!r||!r.packets)return this;const t=e.jsonDoc.json,o=this.document.getRoot(),n=r.packets.map(u=>this.createPacket().fromJSONLD(u)),i=[[t.asset],t.scenes,t.nodes,t.meshes,t.materials,t.images,t.animations],a=[[o],o.listScenes(),o.listNodes(),o.listMeshes(),o.listMaterials(),o.listTextures(),o.listAnimations()];for(let u=0;u<i.length;u++){const h=i[u]||[];for(let f=0;f<h.length;f++){const d=h[f];if(d.extensions&&d.extensions[B]){const l=d.extensions[B];a[u][f].setExtension(B,n[l.packet])}}}return this}write(e){const{json:s}=e.jsonDoc,r=[];for(const t of this.properties){r.push(t.toJSONLD());for(const o of t.listParents()){let n;switch(o.propertyType){case p.ROOT:n=s.asset;break;case p.SCENE:n=s.scenes[e.sceneIndexMap.get(o)];break;case p.NODE:n=s.nodes[e.nodeIndexMap.get(o)];break;case p.MESH:n=s.meshes[e.meshIndexMap.get(o)];break;case p.MATERIAL:n=s.materials[e.materialIndexMap.get(o)];break;case p.TEXTURE:n=s.images[e.imageIndexMap.get(o)];break;case p.ANIMATION:n=s.animations[e.animationIndexMap.get(o)];break;default:n=null,this.document.getLogger().warn(`[${B}]: Unsupported parent property, "${o.propertyType}"`);break}n&&(n.extensions=n.extensions||{},n.extensions[B]={packet:r.length-1})}}return r.length>0&&(s.extensions=s.extensions||{},s.extensions[B]={packets:r}),this}}on.EXTENSION_NAME=B;export{ot as Anisotropy,it as Clearcoat,at as DiffuseTransmission,ct as Dispersion,Wt as EXTMeshGPUInstancing,et as EXTMeshoptCompression,as as EXTTextureAVIF,us as EXTTextureWebP,ut as EmissiveStrength,ye as INSTANCE_ATTRIBUTE,ft as IOR,Je as InstancedMesh,lt as Iridescence,rt as KHRDracoMeshCompression,Es as KHRLightsPunctual,ys as KHRMaterialsAnisotropy,Ds as KHRMaterialsClearcoat,Cs as KHRMaterialsDiffuseTransmission,ws as KHRMaterialsDispersion,bs as KHRMaterialsEmissiveStrength,Fs as KHRMaterialsIOR,Bs as KHRMaterialsIridescence,Ls as KHRMaterialsPBRSpecularGlossiness,Gs as KHRMaterialsSheen,zs as KHRMaterialsSpecular,Ys as KHRMaterialsTransmission,Ws as KHRMaterialsUnlit,Qs as KHRMaterialsVariants,Zs as KHRMaterialsVolume,en as KHRMeshQuantization,sn as KHRTextureBasisu,nn as KHRTextureTransform,on as KHRXMP,ae as Light,xt as Mapping,mt as MappingList,ht as PBRSpecularGlossiness,Rt as Packet,pt as Sheen,dt as Specular,It as Transform,Tt as Transmission,gt as Unlit,Se as Variant,Et as Volume};
//# sourceMappingURL=index.modern-ZGo4lgJZ.js.map
