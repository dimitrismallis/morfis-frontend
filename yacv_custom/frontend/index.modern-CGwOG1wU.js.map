{"version":3,"file":"index.modern-CGwOG1wU.js","sources":["../node_modules/ktx-parse/dist/ktx-parse.modern.js","../node_modules/@gltf-transform/extensions/dist/index.modern.js"],"sourcesContent":["///////////////////////////////////////////////////\n// KTX2 Header.\n///////////////////////////////////////////////////\nconst KHR_SUPERCOMPRESSION_NONE = 0;\nconst KHR_SUPERCOMPRESSION_BASISLZ = 1;\nconst KHR_SUPERCOMPRESSION_ZSTD = 2;\nconst KHR_SUPERCOMPRESSION_ZLIB = 3;\n///////////////////////////////////////////////////\n// Data Format Descriptor (DFD).\n///////////////////////////////////////////////////\nconst KHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT = 0;\nconst KHR_DF_VENDORID_KHRONOS = 0;\nconst KHR_DF_VERSION = 2;\nconst KHR_DF_MODEL_UNSPECIFIED = 0;\nconst KHR_DF_MODEL_RGBSDA = 1;\n// ...\nconst KHR_DF_MODEL_ETC1 = 160;\nconst KHR_DF_MODEL_ETC2 = 161;\nconst KHR_DF_MODEL_ASTC = 162;\nconst KHR_DF_MODEL_ETC1S = 163;\nconst KHR_DF_MODEL_UASTC = 166;\nconst KHR_DF_FLAG_ALPHA_STRAIGHT = 0;\nconst KHR_DF_FLAG_ALPHA_PREMULTIPLIED = 1;\nconst KHR_DF_TRANSFER_UNSPECIFIED = 0;\nconst KHR_DF_TRANSFER_LINEAR = 1;\nconst KHR_DF_TRANSFER_SRGB = 2;\nconst KHR_DF_TRANSFER_ITU = 3;\nconst KHR_DF_TRANSFER_NTSC = 4;\nconst KHR_DF_TRANSFER_SLOG = 5;\nconst KHR_DF_TRANSFER_SLOG2 = 6;\nconst KHR_DF_TRANSFER_BT1886 = 7;\nconst KHR_DF_TRANSFER_HLG_OETF = 8;\nconst KHR_DF_TRANSFER_HLG_EOTF = 9;\nconst KHR_DF_TRANSFER_PQ_EOTF = 10;\nconst KHR_DF_TRANSFER_PQ_OETF = 11;\nconst KHR_DF_TRANSFER_DCIP3 = 12;\nconst KHR_DF_TRANSFER_PAL_OETF = 13;\nconst KHR_DF_TRANSFER_PAL625_EOTF = 14;\nconst KHR_DF_TRANSFER_ST240 = 15;\nconst KHR_DF_TRANSFER_ACESCC = 16;\nconst KHR_DF_TRANSFER_ACESCCT = 17;\nconst KHR_DF_TRANSFER_ADOBERGB = 18;\nconst KHR_DF_PRIMARIES_UNSPECIFIED = 0;\nconst KHR_DF_PRIMARIES_BT709 = 1;\nconst KHR_DF_PRIMARIES_BT601_EBU = 2;\nconst KHR_DF_PRIMARIES_BT601_SMPTE = 3;\nconst KHR_DF_PRIMARIES_BT2020 = 4;\nconst KHR_DF_PRIMARIES_CIEXYZ = 5;\nconst KHR_DF_PRIMARIES_ACES = 6;\nconst KHR_DF_PRIMARIES_ACESCC = 7;\nconst KHR_DF_PRIMARIES_NTSC1953 = 8;\nconst KHR_DF_PRIMARIES_PAL525 = 9;\nconst KHR_DF_PRIMARIES_DISPLAYP3 = 10;\nconst KHR_DF_PRIMARIES_ADOBERGB = 11;\nconst KHR_DF_CHANNEL_RGBSDA_RED = 0;\nconst KHR_DF_CHANNEL_RGBSDA_GREEN = 1;\nconst KHR_DF_CHANNEL_RGBSDA_BLUE = 2;\nconst KHR_DF_CHANNEL_RGBSDA_STENCIL = 13;\nconst KHR_DF_CHANNEL_RGBSDA_DEPTH = 14;\nconst KHR_DF_CHANNEL_RGBSDA_ALPHA = 15;\nconst KHR_DF_SAMPLE_DATATYPE_FLOAT = 0x80;\nconst KHR_DF_SAMPLE_DATATYPE_SIGNED = 0x40;\nconst KHR_DF_SAMPLE_DATATYPE_EXPONENT = 0x20;\nconst KHR_DF_SAMPLE_DATATYPE_LINEAR = 0x10;\n///////////////////////////////////////////////////\n// VK FORMAT.\n///////////////////////////////////////////////////\nconst VK_FORMAT_UNDEFINED = 0;\nconst VK_FORMAT_R4G4_UNORM_PACK8 = 1;\nconst VK_FORMAT_R4G4B4A4_UNORM_PACK16 = 2;\nconst VK_FORMAT_B4G4R4A4_UNORM_PACK16 = 3;\nconst VK_FORMAT_R5G6B5_UNORM_PACK16 = 4;\nconst VK_FORMAT_B5G6R5_UNORM_PACK16 = 5;\nconst VK_FORMAT_R5G5B5A1_UNORM_PACK16 = 6;\nconst VK_FORMAT_B5G5R5A1_UNORM_PACK16 = 7;\nconst VK_FORMAT_A1R5G5B5_UNORM_PACK16 = 8;\nconst VK_FORMAT_R8_UNORM = 9;\nconst VK_FORMAT_R8_SNORM = 10;\nconst VK_FORMAT_R8_UINT = 13;\nconst VK_FORMAT_R8_SINT = 14;\nconst VK_FORMAT_R8_SRGB = 15;\nconst VK_FORMAT_R8G8_UNORM = 16;\nconst VK_FORMAT_R8G8_SNORM = 17;\nconst VK_FORMAT_R8G8_UINT = 20;\nconst VK_FORMAT_R8G8_SINT = 21;\nconst VK_FORMAT_R8G8_SRGB = 22;\nconst VK_FORMAT_R8G8B8_UNORM = 23;\nconst VK_FORMAT_R8G8B8_SNORM = 24;\nconst VK_FORMAT_R8G8B8_UINT = 27;\nconst VK_FORMAT_R8G8B8_SINT = 28;\nconst VK_FORMAT_R8G8B8_SRGB = 29;\nconst VK_FORMAT_B8G8R8_UNORM = 30;\nconst VK_FORMAT_B8G8R8_SNORM = 31;\nconst VK_FORMAT_B8G8R8_UINT = 34;\nconst VK_FORMAT_B8G8R8_SINT = 35;\nconst VK_FORMAT_B8G8R8_SRGB = 36;\nconst VK_FORMAT_R8G8B8A8_UNORM = 37;\nconst VK_FORMAT_R8G8B8A8_SNORM = 38;\nconst VK_FORMAT_R8G8B8A8_UINT = 41;\nconst VK_FORMAT_R8G8B8A8_SINT = 42;\nconst VK_FORMAT_R8G8B8A8_SRGB = 43;\nconst VK_FORMAT_B8G8R8A8_UNORM = 44;\nconst VK_FORMAT_B8G8R8A8_SNORM = 45;\nconst VK_FORMAT_B8G8R8A8_UINT = 48;\nconst VK_FORMAT_B8G8R8A8_SINT = 49;\nconst VK_FORMAT_B8G8R8A8_SRGB = 50;\nconst VK_FORMAT_A2R10G10B10_UNORM_PACK32 = 58;\nconst VK_FORMAT_A2R10G10B10_SNORM_PACK32 = 59;\nconst VK_FORMAT_A2R10G10B10_UINT_PACK32 = 62;\nconst VK_FORMAT_A2R10G10B10_SINT_PACK32 = 63;\nconst VK_FORMAT_A2B10G10R10_UNORM_PACK32 = 64;\nconst VK_FORMAT_A2B10G10R10_SNORM_PACK32 = 65;\nconst VK_FORMAT_A2B10G10R10_UINT_PACK32 = 68;\nconst VK_FORMAT_A2B10G10R10_SINT_PACK32 = 69;\nconst VK_FORMAT_R16_UNORM = 70;\nconst VK_FORMAT_R16_SNORM = 71;\nconst VK_FORMAT_R16_UINT = 74;\nconst VK_FORMAT_R16_SINT = 75;\nconst VK_FORMAT_R16_SFLOAT = 76;\nconst VK_FORMAT_R16G16_UNORM = 77;\nconst VK_FORMAT_R16G16_SNORM = 78;\nconst VK_FORMAT_R16G16_UINT = 81;\nconst VK_FORMAT_R16G16_SINT = 82;\nconst VK_FORMAT_R16G16_SFLOAT = 83;\nconst VK_FORMAT_R16G16B16_UNORM = 84;\nconst VK_FORMAT_R16G16B16_SNORM = 85;\nconst VK_FORMAT_R16G16B16_UINT = 88;\nconst VK_FORMAT_R16G16B16_SINT = 89;\nconst VK_FORMAT_R16G16B16_SFLOAT = 90;\nconst VK_FORMAT_R16G16B16A16_UNORM = 91;\nconst VK_FORMAT_R16G16B16A16_SNORM = 92;\nconst VK_FORMAT_R16G16B16A16_UINT = 95;\nconst VK_FORMAT_R16G16B16A16_SINT = 96;\nconst VK_FORMAT_R16G16B16A16_SFLOAT = 97;\nconst VK_FORMAT_R32_UINT = 98;\nconst VK_FORMAT_R32_SINT = 99;\nconst VK_FORMAT_R32_SFLOAT = 100;\nconst VK_FORMAT_R32G32_UINT = 101;\nconst VK_FORMAT_R32G32_SINT = 102;\nconst VK_FORMAT_R32G32_SFLOAT = 103;\nconst VK_FORMAT_R32G32B32_UINT = 104;\nconst VK_FORMAT_R32G32B32_SINT = 105;\nconst VK_FORMAT_R32G32B32_SFLOAT = 106;\nconst VK_FORMAT_R32G32B32A32_UINT = 107;\nconst VK_FORMAT_R32G32B32A32_SINT = 108;\nconst VK_FORMAT_R32G32B32A32_SFLOAT = 109;\nconst VK_FORMAT_R64_UINT = 110;\nconst VK_FORMAT_R64_SINT = 111;\nconst VK_FORMAT_R64_SFLOAT = 112;\nconst VK_FORMAT_R64G64_UINT = 113;\nconst VK_FORMAT_R64G64_SINT = 114;\nconst VK_FORMAT_R64G64_SFLOAT = 115;\nconst VK_FORMAT_R64G64B64_UINT = 116;\nconst VK_FORMAT_R64G64B64_SINT = 117;\nconst VK_FORMAT_R64G64B64_SFLOAT = 118;\nconst VK_FORMAT_R64G64B64A64_UINT = 119;\nconst VK_FORMAT_R64G64B64A64_SINT = 120;\nconst VK_FORMAT_R64G64B64A64_SFLOAT = 121;\nconst VK_FORMAT_B10G11R11_UFLOAT_PACK32 = 122;\nconst VK_FORMAT_E5B9G9R9_UFLOAT_PACK32 = 123;\nconst VK_FORMAT_D16_UNORM = 124;\nconst VK_FORMAT_X8_D24_UNORM_PACK32 = 125;\nconst VK_FORMAT_D32_SFLOAT = 126;\nconst VK_FORMAT_S8_UINT = 127;\nconst VK_FORMAT_D16_UNORM_S8_UINT = 128;\nconst VK_FORMAT_D24_UNORM_S8_UINT = 129;\nconst VK_FORMAT_D32_SFLOAT_S8_UINT = 130;\nconst VK_FORMAT_BC1_RGB_UNORM_BLOCK = 131;\nconst VK_FORMAT_BC1_RGB_SRGB_BLOCK = 132;\nconst VK_FORMAT_BC1_RGBA_UNORM_BLOCK = 133;\nconst VK_FORMAT_BC1_RGBA_SRGB_BLOCK = 134;\nconst VK_FORMAT_BC2_UNORM_BLOCK = 135;\nconst VK_FORMAT_BC2_SRGB_BLOCK = 136;\nconst VK_FORMAT_BC3_UNORM_BLOCK = 137;\nconst VK_FORMAT_BC3_SRGB_BLOCK = 138;\nconst VK_FORMAT_BC4_UNORM_BLOCK = 139;\nconst VK_FORMAT_BC4_SNORM_BLOCK = 140;\nconst VK_FORMAT_BC5_UNORM_BLOCK = 141;\nconst VK_FORMAT_BC5_SNORM_BLOCK = 142;\nconst VK_FORMAT_BC6H_UFLOAT_BLOCK = 143;\nconst VK_FORMAT_BC6H_SFLOAT_BLOCK = 144;\nconst VK_FORMAT_BC7_UNORM_BLOCK = 145;\nconst VK_FORMAT_BC7_SRGB_BLOCK = 146;\nconst VK_FORMAT_ETC2_R8G8B8_UNORM_BLOCK = 147;\nconst VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK = 148;\nconst VK_FORMAT_ETC2_R8G8B8A1_UNORM_BLOCK = 149;\nconst VK_FORMAT_ETC2_R8G8B8A1_SRGB_BLOCK = 150;\nconst VK_FORMAT_ETC2_R8G8B8A8_UNORM_BLOCK = 151;\nconst VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK = 152;\nconst VK_FORMAT_EAC_R11_UNORM_BLOCK = 153;\nconst VK_FORMAT_EAC_R11_SNORM_BLOCK = 154;\nconst VK_FORMAT_EAC_R11G11_UNORM_BLOCK = 155;\nconst VK_FORMAT_EAC_R11G11_SNORM_BLOCK = 156;\nconst VK_FORMAT_ASTC_4x4_UNORM_BLOCK = 157;\nconst VK_FORMAT_ASTC_4x4_SRGB_BLOCK = 158;\nconst VK_FORMAT_ASTC_5x4_UNORM_BLOCK = 159;\nconst VK_FORMAT_ASTC_5x4_SRGB_BLOCK = 160;\nconst VK_FORMAT_ASTC_5x5_UNORM_BLOCK = 161;\nconst VK_FORMAT_ASTC_5x5_SRGB_BLOCK = 162;\nconst VK_FORMAT_ASTC_6x5_UNORM_BLOCK = 163;\nconst VK_FORMAT_ASTC_6x5_SRGB_BLOCK = 164;\nconst VK_FORMAT_ASTC_6x6_UNORM_BLOCK = 165;\nconst VK_FORMAT_ASTC_6x6_SRGB_BLOCK = 166;\nconst VK_FORMAT_ASTC_8x5_UNORM_BLOCK = 167;\nconst VK_FORMAT_ASTC_8x5_SRGB_BLOCK = 168;\nconst VK_FORMAT_ASTC_8x6_UNORM_BLOCK = 169;\nconst VK_FORMAT_ASTC_8x6_SRGB_BLOCK = 170;\nconst VK_FORMAT_ASTC_8x8_UNORM_BLOCK = 171;\nconst VK_FORMAT_ASTC_8x8_SRGB_BLOCK = 172;\nconst VK_FORMAT_ASTC_10x5_UNORM_BLOCK = 173;\nconst VK_FORMAT_ASTC_10x5_SRGB_BLOCK = 174;\nconst VK_FORMAT_ASTC_10x6_UNORM_BLOCK = 175;\nconst VK_FORMAT_ASTC_10x6_SRGB_BLOCK = 176;\nconst VK_FORMAT_ASTC_10x8_UNORM_BLOCK = 177;\nconst VK_FORMAT_ASTC_10x8_SRGB_BLOCK = 178;\nconst VK_FORMAT_ASTC_10x10_UNORM_BLOCK = 179;\nconst VK_FORMAT_ASTC_10x10_SRGB_BLOCK = 180;\nconst VK_FORMAT_ASTC_12x10_UNORM_BLOCK = 181;\nconst VK_FORMAT_ASTC_12x10_SRGB_BLOCK = 182;\nconst VK_FORMAT_ASTC_12x12_UNORM_BLOCK = 183;\nconst VK_FORMAT_ASTC_12x12_SRGB_BLOCK = 184;\nconst VK_FORMAT_R10X6_UNORM_PACK16 = 1000156007;\nconst VK_FORMAT_R10X6G10X6_UNORM_2PACK16 = 1000156008;\nconst VK_FORMAT_R10X6G10X6B10X6A10X6_UNORM_4PACK16 = 1000156009;\nconst VK_FORMAT_G10X6B10X6G10X6R10X6_422_UNORM_4PACK16 = 1000156010;\nconst VK_FORMAT_B10X6G10X6R10X6G10X6_422_UNORM_4PACK16 = 1000156011;\nconst VK_FORMAT_R12X4_UNORM_PACK16 = 1000156017;\nconst VK_FORMAT_R12X4G12X4_UNORM_2PACK16 = 1000156018;\nconst VK_FORMAT_R12X4G12X4B12X4A12X4_UNORM_4PACK16 = 1000156019;\nconst VK_FORMAT_G12X4B12X4G12X4R12X4_422_UNORM_4PACK16 = 1000156020;\nconst VK_FORMAT_B12X4G12X4R12X4G12X4_422_UNORM_4PACK16 = 1000156021;\nconst VK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG = 1000054000;\nconst VK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG = 1000054001;\nconst VK_FORMAT_PVRTC2_2BPP_UNORM_BLOCK_IMG = 1000054002;\nconst VK_FORMAT_PVRTC2_4BPP_UNORM_BLOCK_IMG = 1000054003;\nconst VK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG = 1000054004;\nconst VK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG = 1000054005;\nconst VK_FORMAT_PVRTC2_2BPP_SRGB_BLOCK_IMG = 1000054006;\nconst VK_FORMAT_PVRTC2_4BPP_SRGB_BLOCK_IMG = 1000054007;\nconst VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT = 1000066000;\nconst VK_FORMAT_ASTC_5x4_SFLOAT_BLOCK_EXT = 1000066001;\nconst VK_FORMAT_ASTC_5x5_SFLOAT_BLOCK_EXT = 1000066002;\nconst VK_FORMAT_ASTC_6x5_SFLOAT_BLOCK_EXT = 1000066003;\nconst VK_FORMAT_ASTC_6x6_SFLOAT_BLOCK_EXT = 1000066004;\nconst VK_FORMAT_ASTC_8x5_SFLOAT_BLOCK_EXT = 1000066005;\nconst VK_FORMAT_ASTC_8x6_SFLOAT_BLOCK_EXT = 1000066006;\nconst VK_FORMAT_ASTC_8x8_SFLOAT_BLOCK_EXT = 1000066007;\nconst VK_FORMAT_ASTC_10x5_SFLOAT_BLOCK_EXT = 1000066008;\nconst VK_FORMAT_ASTC_10x6_SFLOAT_BLOCK_EXT = 1000066009;\nconst VK_FORMAT_ASTC_10x8_SFLOAT_BLOCK_EXT = 1000066010;\nconst VK_FORMAT_ASTC_10x10_SFLOAT_BLOCK_EXT = 1000066011;\nconst VK_FORMAT_ASTC_12x10_SFLOAT_BLOCK_EXT = 1000066012;\nconst VK_FORMAT_ASTC_12x12_SFLOAT_BLOCK_EXT = 1000066013;\nconst VK_FORMAT_A4R4G4B4_UNORM_PACK16_EXT = 1000340000;\nconst VK_FORMAT_A4B4G4R4_UNORM_PACK16_EXT = 1000340001;\n\n/**\n * Creates a 'default' {@link KTX2Container} object, initialized with common\n * configuration wfor BT709 primaries and sRGB transfer, without pixel data.\n * There's nothing particularly special about the 'default' container; creating\n * the KTX2Container object explicitly is also fine.\n */\nfunction createDefaultContainer() {\n  return {\n    vkFormat: VK_FORMAT_UNDEFINED,\n    typeSize: 1,\n    pixelWidth: 0,\n    pixelHeight: 0,\n    pixelDepth: 0,\n    layerCount: 0,\n    faceCount: 1,\n    levelCount: 0,\n    supercompressionScheme: KHR_SUPERCOMPRESSION_NONE,\n    levels: [],\n    dataFormatDescriptor: [{\n      vendorId: KHR_DF_VENDORID_KHRONOS,\n      descriptorType: KHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT,\n      versionNumber: KHR_DF_VERSION,\n      colorModel: KHR_DF_MODEL_UNSPECIFIED,\n      colorPrimaries: KHR_DF_PRIMARIES_BT709,\n      transferFunction: KHR_DF_TRANSFER_SRGB,\n      flags: KHR_DF_FLAG_ALPHA_STRAIGHT,\n      texelBlockDimension: [0, 0, 0, 0],\n      bytesPlane: [0, 0, 0, 0, 0, 0, 0, 0],\n      samples: []\n    }],\n    keyValue: {},\n    globalData: null\n  };\n}\n\nclass BufferReader {\n  constructor(data, byteOffset, byteLength, littleEndian) {\n    this._dataView = void 0;\n    this._littleEndian = void 0;\n    this._offset = void 0;\n    this._dataView = new DataView(data.buffer, data.byteOffset + byteOffset, byteLength);\n    this._littleEndian = littleEndian;\n    this._offset = 0;\n  }\n  _nextUint8() {\n    const value = this._dataView.getUint8(this._offset);\n    this._offset += 1;\n    return value;\n  }\n  _nextUint16() {\n    const value = this._dataView.getUint16(this._offset, this._littleEndian);\n    this._offset += 2;\n    return value;\n  }\n  _nextUint32() {\n    const value = this._dataView.getUint32(this._offset, this._littleEndian);\n    this._offset += 4;\n    return value;\n  }\n  _nextUint64() {\n    const left = this._dataView.getUint32(this._offset, this._littleEndian);\n    const right = this._dataView.getUint32(this._offset + 4, this._littleEndian);\n    // TODO(cleanup): Just test this...\n    // const value = this._littleEndian ? left + (2 ** 32 * right) : (2 ** 32 * left) + right;\n    const value = left + 2 ** 32 * right;\n    this._offset += 8;\n    return value;\n  }\n  _nextInt32() {\n    const value = this._dataView.getInt32(this._offset, this._littleEndian);\n    this._offset += 4;\n    return value;\n  }\n  _nextUint8Array(len) {\n    const value = new Uint8Array(this._dataView.buffer, this._dataView.byteOffset + this._offset, len);\n    this._offset += len;\n    return value;\n  }\n  _skip(bytes) {\n    this._offset += bytes;\n    return this;\n  }\n  _scan(maxByteLength, term = 0x00) {\n    const byteOffset = this._offset;\n    let byteLength = 0;\n    while (this._dataView.getUint8(this._offset) !== term && byteLength < maxByteLength) {\n      byteLength++;\n      this._offset++;\n    }\n    if (byteLength < maxByteLength) this._offset++;\n    return new Uint8Array(this._dataView.buffer, this._dataView.byteOffset + byteOffset, byteLength);\n  }\n}\n\n///////////////////////////////////////////////////\n// Common.\n///////////////////////////////////////////////////\nconst KTX_WRITER = `KTX-Parse v${\"1.1.0\"}`;\nconst NUL = new Uint8Array([0x00]);\n///////////////////////////////////////////////////\n// KTX2 Header.\n///////////////////////////////////////////////////\nconst KTX2_ID = [\n// '´', 'K', 'T', 'X', '2', '0', 'ª', '\\r', '\\n', '\\x1A', '\\n'\n0xab, 0x4b, 0x54, 0x58, 0x20, 0x32, 0x30, 0xbb, 0x0d, 0x0a, 0x1a, 0x0a];\nconst HEADER_BYTE_LENGTH = 68; // 13 * 4 + 2 * 8\n\n/** Encodes text to an ArrayBuffer. */\nfunction encodeText(text) {\n  return new TextEncoder().encode(text);\n}\n/** Decodes an ArrayBuffer to text. */\nfunction decodeText(buffer) {\n  return new TextDecoder().decode(buffer);\n}\n/** Concatenates N ArrayBuffers. */\nfunction concat(buffers) {\n  let totalByteLength = 0;\n  for (const buffer of buffers) {\n    totalByteLength += buffer.byteLength;\n  }\n  const result = new Uint8Array(totalByteLength);\n  let byteOffset = 0;\n  for (const buffer of buffers) {\n    result.set(new Uint8Array(buffer), byteOffset);\n    byteOffset += buffer.byteLength;\n  }\n  return result;\n}\n/** Returns the least common multiple (LCM) for two positive integers. */\nfunction leastCommonMultiple(a, b) {\n  const max = Math.max(a, b);\n  const min = Math.min(a, b);\n  let lcm = max;\n  while (lcm % min !== 0) {\n    lcm += max;\n  }\n  return lcm;\n}\n/**\n * Returns amount of padding, in bytes, required to pad a value V to N-byte\n * boundaries. Both V and N must be positive integers.\n */\nfunction getPadding(v, n = 4) {\n  return Math.ceil(v / n) * n - v;\n}\n/** Returns byte length per texel block. */\nfunction getBlockByteLength(container) {\n  return container.levels[0].levelData.byteLength / getBlockCount(container, 0);\n}\n/**\n * Returns total number of blocks for given level. For VK_FORMAT_UNDEFINED, DFD is required.\n *\n * References:\n * - https://github.khronos.org/KTX-Specification/ktxspec.v2.html#levelImages\n */\nfunction getBlockCount(container, levelIndex) {\n  let blockCount = 1;\n  const pixelDimensions = [container.pixelWidth, container.pixelHeight, container.pixelDepth];\n  const blockDimensions = getBlockDimensions(container);\n  for (let i = 0; i < 3; i++) {\n    if (pixelDimensions[i] > 0) {\n      const dimBlockCount = Math.ceil(Math.floor(pixelDimensions[i] * 2 ** -levelIndex) / blockDimensions[i]);\n      blockCount *= Math.max(1, dimBlockCount);\n    }\n  }\n  if (container.layerCount > 0) {\n    blockCount *= container.layerCount;\n  }\n  if (container.faceCount > 0) {\n    blockCount *= container.faceCount;\n  }\n  return blockCount;\n}\n/**\n * Given a KTX2 container, returns block dimensions as [width, height, depth]. Requires valid DFD.\n */\nfunction getBlockDimensions(container) {\n  const [x, y, z] = container.dataFormatDescriptor[0].texelBlockDimension;\n  return [x + 1, y + 1, z + 1];\n}\n\n/**\n * Parses a KTX 2.0 file, returning an unpacked {@link KTX2Container} instance with all associated\n * data. The container's mip levels and other binary data are pointers into the original file, not\n * copies, so the original file should not be overwritten after reading.\n *\n * @param data Bytes of KTX 2.0 file, as Uint8Array or Buffer.\n */\nfunction read(data) {\n  ///////////////////////////////////////////////////\n  // KTX 2.0 Identifier.\n  ///////////////////////////////////////////////////\n  const id = new Uint8Array(data.buffer, data.byteOffset, KTX2_ID.length);\n  if (id[0] !== KTX2_ID[0] ||\n  // '´'\n  id[1] !== KTX2_ID[1] ||\n  // 'K'\n  id[2] !== KTX2_ID[2] ||\n  // 'T'\n  id[3] !== KTX2_ID[3] ||\n  // 'X'\n  id[4] !== KTX2_ID[4] ||\n  // ' '\n  id[5] !== KTX2_ID[5] ||\n  // '2'\n  id[6] !== KTX2_ID[6] ||\n  // '0'\n  id[7] !== KTX2_ID[7] ||\n  // 'ª'\n  id[8] !== KTX2_ID[8] ||\n  // '\\r'\n  id[9] !== KTX2_ID[9] ||\n  // '\\n'\n  id[10] !== KTX2_ID[10] ||\n  // '\\x1A'\n  id[11] !== KTX2_ID[11] // '\\n'\n  ) {\n    throw new Error('Missing KTX 2.0 identifier.');\n  }\n  const container = createDefaultContainer();\n  ///////////////////////////////////////////////////\n  // Header.\n  ///////////////////////////////////////////////////\n  const headerByteLength = 17 * Uint32Array.BYTES_PER_ELEMENT;\n  const headerReader = new BufferReader(data, KTX2_ID.length, headerByteLength, true);\n  container.vkFormat = headerReader._nextUint32();\n  container.typeSize = headerReader._nextUint32();\n  container.pixelWidth = headerReader._nextUint32();\n  container.pixelHeight = headerReader._nextUint32();\n  container.pixelDepth = headerReader._nextUint32();\n  container.layerCount = headerReader._nextUint32();\n  container.faceCount = headerReader._nextUint32();\n  container.levelCount = headerReader._nextUint32();\n  container.supercompressionScheme = headerReader._nextUint32();\n  const dfdByteOffset = headerReader._nextUint32();\n  const dfdByteLength = headerReader._nextUint32();\n  const kvdByteOffset = headerReader._nextUint32();\n  const kvdByteLength = headerReader._nextUint32();\n  const sgdByteOffset = headerReader._nextUint64();\n  const sgdByteLength = headerReader._nextUint64();\n  ///////////////////////////////////////////////////\n  // Level Index.\n  ///////////////////////////////////////////////////\n  const levelByteLength = Math.max(container.levelCount, 1) * 3 * 8;\n  const levelReader = new BufferReader(data, KTX2_ID.length + headerByteLength, levelByteLength, true);\n  for (let i = 0, il = Math.max(container.levelCount, 1); i < il; i++) {\n    container.levels.push({\n      levelData: new Uint8Array(data.buffer, data.byteOffset + levelReader._nextUint64(), levelReader._nextUint64()),\n      uncompressedByteLength: levelReader._nextUint64()\n    });\n  }\n  ///////////////////////////////////////////////////\n  // Data Format Descriptor (DFD).\n  ///////////////////////////////////////////////////\n  const dfdReader = new BufferReader(data, dfdByteOffset, dfdByteLength, true);\n  dfdReader._skip(4); // totalSize\n  const vendorId = dfdReader._nextUint16();\n  const descriptorType = dfdReader._nextUint16();\n  const versionNumber = dfdReader._nextUint16();\n  const descriptorBlockSize = dfdReader._nextUint16();\n  const colorModel = dfdReader._nextUint8();\n  const colorPrimaries = dfdReader._nextUint8();\n  const transferFunction = dfdReader._nextUint8();\n  const flags = dfdReader._nextUint8();\n  const texelBlockDimension = [dfdReader._nextUint8(), dfdReader._nextUint8(), dfdReader._nextUint8(), dfdReader._nextUint8()];\n  const bytesPlane = [dfdReader._nextUint8(), dfdReader._nextUint8(), dfdReader._nextUint8(), dfdReader._nextUint8(), dfdReader._nextUint8(), dfdReader._nextUint8(), dfdReader._nextUint8(), dfdReader._nextUint8()];\n  const samples = [];\n  const dfd = {\n    vendorId,\n    descriptorType,\n    versionNumber,\n    colorModel,\n    colorPrimaries,\n    transferFunction,\n    flags,\n    texelBlockDimension,\n    bytesPlane,\n    samples\n  };\n  const sampleStart = 6;\n  const sampleWords = 4;\n  const numSamples = (descriptorBlockSize / 4 - sampleStart) / sampleWords;\n  for (let i = 0; i < numSamples; i++) {\n    const sample = {\n      bitOffset: dfdReader._nextUint16(),\n      bitLength: dfdReader._nextUint8(),\n      channelType: dfdReader._nextUint8(),\n      samplePosition: [dfdReader._nextUint8(), dfdReader._nextUint8(), dfdReader._nextUint8(), dfdReader._nextUint8()],\n      sampleLower: Number.NEGATIVE_INFINITY,\n      sampleUpper: Number.POSITIVE_INFINITY\n    };\n    if (sample.channelType & KHR_DF_SAMPLE_DATATYPE_SIGNED) {\n      sample.sampleLower = dfdReader._nextInt32();\n      sample.sampleUpper = dfdReader._nextInt32();\n    } else {\n      sample.sampleLower = dfdReader._nextUint32();\n      sample.sampleUpper = dfdReader._nextUint32();\n    }\n    dfd.samples[i] = sample;\n  }\n  container.dataFormatDescriptor.length = 0;\n  container.dataFormatDescriptor.push(dfd);\n  ///////////////////////////////////////////////////\n  // Key/Value Data (KVD).\n  ///////////////////////////////////////////////////\n  const kvdReader = new BufferReader(data, kvdByteOffset, kvdByteLength, true);\n  while (kvdReader._offset < kvdByteLength) {\n    const keyValueByteLength = kvdReader._nextUint32();\n    const keyData = kvdReader._scan(keyValueByteLength);\n    const key = decodeText(keyData);\n    container.keyValue[key] = kvdReader._nextUint8Array(keyValueByteLength - keyData.byteLength - 1);\n    if (key.match(/^ktx/i)) {\n      const text = decodeText(container.keyValue[key]);\n      container.keyValue[key] = text.substring(0, text.lastIndexOf('\\x00'));\n    }\n    const kvPadding = keyValueByteLength % 4 ? 4 - keyValueByteLength % 4 : 0; // align(4)\n    // 4-byte alignment.\n    kvdReader._skip(kvPadding);\n  }\n  ///////////////////////////////////////////////////\n  // Supercompression Global Data (SGD).\n  ///////////////////////////////////////////////////\n  if (sgdByteLength <= 0) return container;\n  const sgdReader = new BufferReader(data, sgdByteOffset, sgdByteLength, true);\n  const endpointCount = sgdReader._nextUint16();\n  const selectorCount = sgdReader._nextUint16();\n  const endpointsByteLength = sgdReader._nextUint32();\n  const selectorsByteLength = sgdReader._nextUint32();\n  const tablesByteLength = sgdReader._nextUint32();\n  const extendedByteLength = sgdReader._nextUint32();\n  const imageDescs = [];\n  for (let i = 0, il = Math.max(container.levelCount, 1); i < il; i++) {\n    imageDescs.push({\n      imageFlags: sgdReader._nextUint32(),\n      rgbSliceByteOffset: sgdReader._nextUint32(),\n      rgbSliceByteLength: sgdReader._nextUint32(),\n      alphaSliceByteOffset: sgdReader._nextUint32(),\n      alphaSliceByteLength: sgdReader._nextUint32()\n    });\n  }\n  const endpointsByteOffset = sgdByteOffset + sgdReader._offset;\n  const selectorsByteOffset = endpointsByteOffset + endpointsByteLength;\n  const tablesByteOffset = selectorsByteOffset + selectorsByteLength;\n  const extendedByteOffset = tablesByteOffset + tablesByteLength;\n  const endpointsData = new Uint8Array(data.buffer, data.byteOffset + endpointsByteOffset, endpointsByteLength);\n  const selectorsData = new Uint8Array(data.buffer, data.byteOffset + selectorsByteOffset, selectorsByteLength);\n  const tablesData = new Uint8Array(data.buffer, data.byteOffset + tablesByteOffset, tablesByteLength);\n  const extendedData = new Uint8Array(data.buffer, data.byteOffset + extendedByteOffset, extendedByteLength);\n  container.globalData = {\n    endpointCount,\n    selectorCount,\n    imageDescs,\n    endpointsData,\n    selectorsData,\n    tablesData,\n    extendedData\n  };\n  return container;\n}\n\nfunction _extends() {\n  return _extends = Object.assign ? Object.assign.bind() : function (n) {\n    for (var e = 1; e < arguments.length; e++) {\n      var t = arguments[e];\n      for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]);\n    }\n    return n;\n  }, _extends.apply(null, arguments);\n}\n\nconst DEFAULT_OPTIONS = {\n  keepWriter: false\n};\n/**\n * Serializes a {@link KTX2Container} instance to a KTX 2.0 file. Mip levels and other binary data\n * are copied into the resulting Uint8Array, so the original container can safely be edited or\n * destroyed after it is serialized.\n *\n * Options:\n * - keepWriter: If true, 'KTXWriter' key/value field is written as provided by the container.\n * \t\tOtherwise, a string for the current ktx-parse version is generated. Default: false.\n *\n * @param container\n * @param options\n */\nfunction write(container, options = {}) {\n  // biome-ignore lint/style/noParameterAssign: Merging defaults only.\n  options = _extends({}, DEFAULT_OPTIONS, options);\n  ///////////////////////////////////////////////////\n  // Supercompression Global Data (SGD).\n  ///////////////////////////////////////////////////\n  let sgdBuffer = new ArrayBuffer(0);\n  if (container.globalData) {\n    const sgdHeaderBuffer = new ArrayBuffer(20 + container.globalData.imageDescs.length * 5 * 4);\n    const sgdHeaderView = new DataView(sgdHeaderBuffer);\n    sgdHeaderView.setUint16(0, container.globalData.endpointCount, true);\n    sgdHeaderView.setUint16(2, container.globalData.selectorCount, true);\n    sgdHeaderView.setUint32(4, container.globalData.endpointsData.byteLength, true);\n    sgdHeaderView.setUint32(8, container.globalData.selectorsData.byteLength, true);\n    sgdHeaderView.setUint32(12, container.globalData.tablesData.byteLength, true);\n    sgdHeaderView.setUint32(16, container.globalData.extendedData.byteLength, true);\n    for (let i = 0; i < container.globalData.imageDescs.length; i++) {\n      const imageDesc = container.globalData.imageDescs[i];\n      sgdHeaderView.setUint32(20 + i * 5 * 4 + 0, imageDesc.imageFlags, true);\n      sgdHeaderView.setUint32(20 + i * 5 * 4 + 4, imageDesc.rgbSliceByteOffset, true);\n      sgdHeaderView.setUint32(20 + i * 5 * 4 + 8, imageDesc.rgbSliceByteLength, true);\n      sgdHeaderView.setUint32(20 + i * 5 * 4 + 12, imageDesc.alphaSliceByteOffset, true);\n      sgdHeaderView.setUint32(20 + i * 5 * 4 + 16, imageDesc.alphaSliceByteLength, true);\n    }\n    sgdBuffer = concat([sgdHeaderBuffer, container.globalData.endpointsData, container.globalData.selectorsData, container.globalData.tablesData, container.globalData.extendedData]);\n  }\n  ///////////////////////////////////////////////////\n  // Key/Value Data (KVD).\n  ///////////////////////////////////////////////////\n  const keyValueData = [];\n  const keyValueList = Object.entries(_extends({}, container.keyValue, !options.keepWriter && {\n    KTXwriter: KTX_WRITER\n  }));\n  keyValueList.sort((a, b) => a[0] > b[0] ? 1 : -1);\n  for (const [key, value] of keyValueList) {\n    const keyData = encodeText(key);\n    const valueData = typeof value === 'string' ? concat([encodeText(value), NUL]) : value;\n    const kvByteLength = keyData.byteLength + 1 + valueData.byteLength;\n    const kvPadding = getPadding(kvByteLength, 4); // align(4)\n    keyValueData.push(concat([new Uint32Array([kvByteLength]), keyData, NUL, valueData, new Uint8Array(kvPadding).fill(0x00) // align(4)\n    ]));\n  }\n  const kvdBuffer = concat(keyValueData);\n  ///////////////////////////////////////////////////\n  // Data Format Descriptor (DFD).\n  ///////////////////////////////////////////////////\n  if (container.dataFormatDescriptor.length !== 1 || container.dataFormatDescriptor[0].descriptorType !== KHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT) {\n    throw new Error('Only BASICFORMAT Data Format Descriptor output supported.');\n  }\n  const dfd = container.dataFormatDescriptor[0];\n  const dfdBuffer = new ArrayBuffer(28 + dfd.samples.length * 16);\n  const dfdView = new DataView(dfdBuffer);\n  const descriptorBlockSize = 24 + dfd.samples.length * 16;\n  dfdView.setUint32(0, dfdBuffer.byteLength, true);\n  dfdView.setUint16(4, dfd.vendorId, true);\n  dfdView.setUint16(6, dfd.descriptorType, true);\n  dfdView.setUint16(8, dfd.versionNumber, true);\n  dfdView.setUint16(10, descriptorBlockSize, true);\n  dfdView.setUint8(12, dfd.colorModel);\n  dfdView.setUint8(13, dfd.colorPrimaries);\n  dfdView.setUint8(14, dfd.transferFunction);\n  dfdView.setUint8(15, dfd.flags);\n  if (!Array.isArray(dfd.texelBlockDimension)) {\n    throw new Error('texelBlockDimension is now an array. For dimensionality `d`, set `d - 1`.');\n  }\n  dfdView.setUint8(16, dfd.texelBlockDimension[0]);\n  dfdView.setUint8(17, dfd.texelBlockDimension[1]);\n  dfdView.setUint8(18, dfd.texelBlockDimension[2]);\n  dfdView.setUint8(19, dfd.texelBlockDimension[3]);\n  for (let i = 0; i < 8; i++) dfdView.setUint8(20 + i, dfd.bytesPlane[i]);\n  for (let i = 0; i < dfd.samples.length; i++) {\n    const sample = dfd.samples[i];\n    const sampleByteOffset = 28 + i * 16;\n    dfdView.setUint16(sampleByteOffset + 0, sample.bitOffset, true);\n    dfdView.setUint8(sampleByteOffset + 2, sample.bitLength);\n    dfdView.setUint8(sampleByteOffset + 3, sample.channelType);\n    dfdView.setUint8(sampleByteOffset + 4, sample.samplePosition[0]);\n    dfdView.setUint8(sampleByteOffset + 5, sample.samplePosition[1]);\n    dfdView.setUint8(sampleByteOffset + 6, sample.samplePosition[2]);\n    dfdView.setUint8(sampleByteOffset + 7, sample.samplePosition[3]);\n    if (sample.channelType & KHR_DF_SAMPLE_DATATYPE_SIGNED) {\n      dfdView.setInt32(sampleByteOffset + 8, sample.sampleLower, true);\n      dfdView.setInt32(sampleByteOffset + 12, sample.sampleUpper, true);\n    } else {\n      dfdView.setUint32(sampleByteOffset + 8, sample.sampleLower, true);\n      dfdView.setUint32(sampleByteOffset + 12, sample.sampleUpper, true);\n    }\n  }\n  ///////////////////////////////////////////////////\n  // Data alignment.\n  ///////////////////////////////////////////////////\n  const dfdByteOffset = KTX2_ID.length + HEADER_BYTE_LENGTH + container.levels.length * 3 * 8;\n  const kvdByteOffset = dfdByteOffset + dfdBuffer.byteLength;\n  let sgdByteOffset = sgdBuffer.byteLength > 0 ? kvdByteOffset + kvdBuffer.byteLength : 0;\n  if (sgdByteOffset % 8) sgdByteOffset += 8 - sgdByteOffset % 8; // align(8)\n  ///////////////////////////////////////////////////\n  // Level Index.\n  ///////////////////////////////////////////////////\n  const levelData = [];\n  const levelIndex = new DataView(new ArrayBuffer(container.levels.length * 3 * 8));\n  const levelDataByteOffsets = new Uint32Array(container.levels.length);\n  let levelAlign = 0;\n  if (container.supercompressionScheme === KHR_SUPERCOMPRESSION_NONE) {\n    levelAlign = leastCommonMultiple(getBlockByteLength(container), 4);\n  }\n  // Level data is ordered small → large.\n  let levelDataByteOffset = (sgdByteOffset || kvdByteOffset + kvdBuffer.byteLength) + sgdBuffer.byteLength;\n  for (let i = container.levels.length - 1; i >= 0; i--) {\n    // Level padding.\n    if (levelDataByteOffset % levelAlign) {\n      const paddingBytes = getPadding(levelDataByteOffset, levelAlign);\n      levelData.push(new Uint8Array(paddingBytes));\n      levelDataByteOffset += paddingBytes;\n    }\n    // Level data.\n    const level = container.levels[i];\n    levelData.push(level.levelData);\n    levelDataByteOffsets[i] = levelDataByteOffset;\n    levelDataByteOffset += level.levelData.byteLength;\n  }\n  // Level index is ordered large → small.\n  for (let i = 0; i < container.levels.length; i++) {\n    const level = container.levels[i];\n    levelIndex.setBigUint64(i * 24 + 0, BigInt(levelDataByteOffsets[i]), true);\n    levelIndex.setBigUint64(i * 24 + 8, BigInt(level.levelData.byteLength), true);\n    levelIndex.setBigUint64(i * 24 + 16, BigInt(level.uncompressedByteLength), true);\n  }\n  ///////////////////////////////////////////////////\n  // Header.\n  ///////////////////////////////////////////////////\n  const headerBuffer = new ArrayBuffer(HEADER_BYTE_LENGTH);\n  const headerView = new DataView(headerBuffer);\n  headerView.setUint32(0, container.vkFormat, true);\n  headerView.setUint32(4, container.typeSize, true);\n  headerView.setUint32(8, container.pixelWidth, true);\n  headerView.setUint32(12, container.pixelHeight, true);\n  headerView.setUint32(16, container.pixelDepth, true);\n  headerView.setUint32(20, container.layerCount, true);\n  headerView.setUint32(24, container.faceCount, true);\n  headerView.setUint32(28, container.levelCount, true);\n  headerView.setUint32(32, container.supercompressionScheme, true);\n  headerView.setUint32(36, dfdByteOffset, true);\n  headerView.setUint32(40, dfdBuffer.byteLength, true);\n  headerView.setUint32(44, kvdByteOffset, true);\n  headerView.setUint32(48, kvdBuffer.byteLength, true);\n  headerView.setBigUint64(52, BigInt(sgdBuffer.byteLength > 0 ? sgdByteOffset : 0), true);\n  headerView.setBigUint64(60, BigInt(sgdBuffer.byteLength), true);\n  ///////////////////////////////////////////////////\n  // Compose.\n  ///////////////////////////////////////////////////\n  return new Uint8Array(concat([new Uint8Array(KTX2_ID).buffer, headerBuffer, levelIndex.buffer, dfdBuffer, kvdBuffer, sgdByteOffset > 0 ? new ArrayBuffer(sgdByteOffset - (kvdByteOffset + kvdBuffer.byteLength)) // align(8)\n  : new ArrayBuffer(0), sgdBuffer, ...levelData]));\n}\n\nexport { KHR_DF_CHANNEL_RGBSDA_ALPHA, KHR_DF_CHANNEL_RGBSDA_BLUE, KHR_DF_CHANNEL_RGBSDA_DEPTH, KHR_DF_CHANNEL_RGBSDA_GREEN, KHR_DF_CHANNEL_RGBSDA_RED, KHR_DF_CHANNEL_RGBSDA_STENCIL, KHR_DF_FLAG_ALPHA_PREMULTIPLIED, KHR_DF_FLAG_ALPHA_STRAIGHT, KHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT, KHR_DF_MODEL_ASTC, KHR_DF_MODEL_ETC1, KHR_DF_MODEL_ETC1S, KHR_DF_MODEL_ETC2, KHR_DF_MODEL_RGBSDA, KHR_DF_MODEL_UASTC, KHR_DF_MODEL_UNSPECIFIED, KHR_DF_PRIMARIES_ACES, KHR_DF_PRIMARIES_ACESCC, KHR_DF_PRIMARIES_ADOBERGB, KHR_DF_PRIMARIES_BT2020, KHR_DF_PRIMARIES_BT601_EBU, KHR_DF_PRIMARIES_BT601_SMPTE, KHR_DF_PRIMARIES_BT709, KHR_DF_PRIMARIES_CIEXYZ, KHR_DF_PRIMARIES_DISPLAYP3, KHR_DF_PRIMARIES_NTSC1953, KHR_DF_PRIMARIES_PAL525, KHR_DF_PRIMARIES_UNSPECIFIED, KHR_DF_SAMPLE_DATATYPE_EXPONENT, KHR_DF_SAMPLE_DATATYPE_FLOAT, KHR_DF_SAMPLE_DATATYPE_LINEAR, KHR_DF_SAMPLE_DATATYPE_SIGNED, KHR_DF_TRANSFER_ACESCC, KHR_DF_TRANSFER_ACESCCT, KHR_DF_TRANSFER_ADOBERGB, KHR_DF_TRANSFER_BT1886, KHR_DF_TRANSFER_DCIP3, KHR_DF_TRANSFER_HLG_EOTF, KHR_DF_TRANSFER_HLG_OETF, KHR_DF_TRANSFER_ITU, KHR_DF_TRANSFER_LINEAR, KHR_DF_TRANSFER_NTSC, KHR_DF_TRANSFER_PAL625_EOTF, KHR_DF_TRANSFER_PAL_OETF, KHR_DF_TRANSFER_PQ_EOTF, KHR_DF_TRANSFER_PQ_OETF, KHR_DF_TRANSFER_SLOG, KHR_DF_TRANSFER_SLOG2, KHR_DF_TRANSFER_SRGB, KHR_DF_TRANSFER_ST240, KHR_DF_TRANSFER_UNSPECIFIED, KHR_DF_VENDORID_KHRONOS, KHR_DF_VERSION, KHR_SUPERCOMPRESSION_BASISLZ, KHR_SUPERCOMPRESSION_NONE, KHR_SUPERCOMPRESSION_ZLIB, KHR_SUPERCOMPRESSION_ZSTD, VK_FORMAT_A1R5G5B5_UNORM_PACK16, VK_FORMAT_A2B10G10R10_SINT_PACK32, VK_FORMAT_A2B10G10R10_SNORM_PACK32, VK_FORMAT_A2B10G10R10_UINT_PACK32, VK_FORMAT_A2B10G10R10_UNORM_PACK32, VK_FORMAT_A2R10G10B10_SINT_PACK32, VK_FORMAT_A2R10G10B10_SNORM_PACK32, VK_FORMAT_A2R10G10B10_UINT_PACK32, VK_FORMAT_A2R10G10B10_UNORM_PACK32, VK_FORMAT_A4B4G4R4_UNORM_PACK16_EXT, VK_FORMAT_A4R4G4B4_UNORM_PACK16_EXT, VK_FORMAT_ASTC_10x10_SFLOAT_BLOCK_EXT, VK_FORMAT_ASTC_10x10_SRGB_BLOCK, VK_FORMAT_ASTC_10x10_UNORM_BLOCK, VK_FORMAT_ASTC_10x5_SFLOAT_BLOCK_EXT, VK_FORMAT_ASTC_10x5_SRGB_BLOCK, VK_FORMAT_ASTC_10x5_UNORM_BLOCK, VK_FORMAT_ASTC_10x6_SFLOAT_BLOCK_EXT, VK_FORMAT_ASTC_10x6_SRGB_BLOCK, VK_FORMAT_ASTC_10x6_UNORM_BLOCK, VK_FORMAT_ASTC_10x8_SFLOAT_BLOCK_EXT, VK_FORMAT_ASTC_10x8_SRGB_BLOCK, VK_FORMAT_ASTC_10x8_UNORM_BLOCK, VK_FORMAT_ASTC_12x10_SFLOAT_BLOCK_EXT, VK_FORMAT_ASTC_12x10_SRGB_BLOCK, VK_FORMAT_ASTC_12x10_UNORM_BLOCK, VK_FORMAT_ASTC_12x12_SFLOAT_BLOCK_EXT, VK_FORMAT_ASTC_12x12_SRGB_BLOCK, VK_FORMAT_ASTC_12x12_UNORM_BLOCK, VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT, VK_FORMAT_ASTC_4x4_SRGB_BLOCK, VK_FORMAT_ASTC_4x4_UNORM_BLOCK, VK_FORMAT_ASTC_5x4_SFLOAT_BLOCK_EXT, VK_FORMAT_ASTC_5x4_SRGB_BLOCK, VK_FORMAT_ASTC_5x4_UNORM_BLOCK, VK_FORMAT_ASTC_5x5_SFLOAT_BLOCK_EXT, VK_FORMAT_ASTC_5x5_SRGB_BLOCK, VK_FORMAT_ASTC_5x5_UNORM_BLOCK, VK_FORMAT_ASTC_6x5_SFLOAT_BLOCK_EXT, VK_FORMAT_ASTC_6x5_SRGB_BLOCK, VK_FORMAT_ASTC_6x5_UNORM_BLOCK, VK_FORMAT_ASTC_6x6_SFLOAT_BLOCK_EXT, VK_FORMAT_ASTC_6x6_SRGB_BLOCK, VK_FORMAT_ASTC_6x6_UNORM_BLOCK, VK_FORMAT_ASTC_8x5_SFLOAT_BLOCK_EXT, VK_FORMAT_ASTC_8x5_SRGB_BLOCK, VK_FORMAT_ASTC_8x5_UNORM_BLOCK, VK_FORMAT_ASTC_8x6_SFLOAT_BLOCK_EXT, VK_FORMAT_ASTC_8x6_SRGB_BLOCK, VK_FORMAT_ASTC_8x6_UNORM_BLOCK, VK_FORMAT_ASTC_8x8_SFLOAT_BLOCK_EXT, VK_FORMAT_ASTC_8x8_SRGB_BLOCK, VK_FORMAT_ASTC_8x8_UNORM_BLOCK, VK_FORMAT_B10G11R11_UFLOAT_PACK32, VK_FORMAT_B10X6G10X6R10X6G10X6_422_UNORM_4PACK16, VK_FORMAT_B12X4G12X4R12X4G12X4_422_UNORM_4PACK16, VK_FORMAT_B4G4R4A4_UNORM_PACK16, VK_FORMAT_B5G5R5A1_UNORM_PACK16, VK_FORMAT_B5G6R5_UNORM_PACK16, VK_FORMAT_B8G8R8A8_SINT, VK_FORMAT_B8G8R8A8_SNORM, VK_FORMAT_B8G8R8A8_SRGB, VK_FORMAT_B8G8R8A8_UINT, VK_FORMAT_B8G8R8A8_UNORM, VK_FORMAT_B8G8R8_SINT, VK_FORMAT_B8G8R8_SNORM, VK_FORMAT_B8G8R8_SRGB, VK_FORMAT_B8G8R8_UINT, VK_FORMAT_B8G8R8_UNORM, VK_FORMAT_BC1_RGBA_SRGB_BLOCK, VK_FORMAT_BC1_RGBA_UNORM_BLOCK, VK_FORMAT_BC1_RGB_SRGB_BLOCK, VK_FORMAT_BC1_RGB_UNORM_BLOCK, VK_FORMAT_BC2_SRGB_BLOCK, VK_FORMAT_BC2_UNORM_BLOCK, VK_FORMAT_BC3_SRGB_BLOCK, VK_FORMAT_BC3_UNORM_BLOCK, VK_FORMAT_BC4_SNORM_BLOCK, VK_FORMAT_BC4_UNORM_BLOCK, VK_FORMAT_BC5_SNORM_BLOCK, VK_FORMAT_BC5_UNORM_BLOCK, VK_FORMAT_BC6H_SFLOAT_BLOCK, VK_FORMAT_BC6H_UFLOAT_BLOCK, VK_FORMAT_BC7_SRGB_BLOCK, VK_FORMAT_BC7_UNORM_BLOCK, VK_FORMAT_D16_UNORM, VK_FORMAT_D16_UNORM_S8_UINT, VK_FORMAT_D24_UNORM_S8_UINT, VK_FORMAT_D32_SFLOAT, VK_FORMAT_D32_SFLOAT_S8_UINT, VK_FORMAT_E5B9G9R9_UFLOAT_PACK32, VK_FORMAT_EAC_R11G11_SNORM_BLOCK, VK_FORMAT_EAC_R11G11_UNORM_BLOCK, VK_FORMAT_EAC_R11_SNORM_BLOCK, VK_FORMAT_EAC_R11_UNORM_BLOCK, VK_FORMAT_ETC2_R8G8B8A1_SRGB_BLOCK, VK_FORMAT_ETC2_R8G8B8A1_UNORM_BLOCK, VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK, VK_FORMAT_ETC2_R8G8B8A8_UNORM_BLOCK, VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK, VK_FORMAT_ETC2_R8G8B8_UNORM_BLOCK, VK_FORMAT_G10X6B10X6G10X6R10X6_422_UNORM_4PACK16, VK_FORMAT_G12X4B12X4G12X4R12X4_422_UNORM_4PACK16, VK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG, VK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG, VK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG, VK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG, VK_FORMAT_PVRTC2_2BPP_SRGB_BLOCK_IMG, VK_FORMAT_PVRTC2_2BPP_UNORM_BLOCK_IMG, VK_FORMAT_PVRTC2_4BPP_SRGB_BLOCK_IMG, VK_FORMAT_PVRTC2_4BPP_UNORM_BLOCK_IMG, VK_FORMAT_R10X6G10X6B10X6A10X6_UNORM_4PACK16, VK_FORMAT_R10X6G10X6_UNORM_2PACK16, VK_FORMAT_R10X6_UNORM_PACK16, VK_FORMAT_R12X4G12X4B12X4A12X4_UNORM_4PACK16, VK_FORMAT_R12X4G12X4_UNORM_2PACK16, VK_FORMAT_R12X4_UNORM_PACK16, VK_FORMAT_R16G16B16A16_SFLOAT, VK_FORMAT_R16G16B16A16_SINT, VK_FORMAT_R16G16B16A16_SNORM, VK_FORMAT_R16G16B16A16_UINT, VK_FORMAT_R16G16B16A16_UNORM, VK_FORMAT_R16G16B16_SFLOAT, VK_FORMAT_R16G16B16_SINT, VK_FORMAT_R16G16B16_SNORM, VK_FORMAT_R16G16B16_UINT, VK_FORMAT_R16G16B16_UNORM, VK_FORMAT_R16G16_SFLOAT, VK_FORMAT_R16G16_SINT, VK_FORMAT_R16G16_SNORM, VK_FORMAT_R16G16_UINT, VK_FORMAT_R16G16_UNORM, VK_FORMAT_R16_SFLOAT, VK_FORMAT_R16_SINT, VK_FORMAT_R16_SNORM, VK_FORMAT_R16_UINT, VK_FORMAT_R16_UNORM, VK_FORMAT_R32G32B32A32_SFLOAT, VK_FORMAT_R32G32B32A32_SINT, VK_FORMAT_R32G32B32A32_UINT, VK_FORMAT_R32G32B32_SFLOAT, VK_FORMAT_R32G32B32_SINT, VK_FORMAT_R32G32B32_UINT, VK_FORMAT_R32G32_SFLOAT, VK_FORMAT_R32G32_SINT, VK_FORMAT_R32G32_UINT, VK_FORMAT_R32_SFLOAT, VK_FORMAT_R32_SINT, VK_FORMAT_R32_UINT, VK_FORMAT_R4G4B4A4_UNORM_PACK16, VK_FORMAT_R4G4_UNORM_PACK8, VK_FORMAT_R5G5B5A1_UNORM_PACK16, VK_FORMAT_R5G6B5_UNORM_PACK16, VK_FORMAT_R64G64B64A64_SFLOAT, VK_FORMAT_R64G64B64A64_SINT, VK_FORMAT_R64G64B64A64_UINT, VK_FORMAT_R64G64B64_SFLOAT, VK_FORMAT_R64G64B64_SINT, VK_FORMAT_R64G64B64_UINT, VK_FORMAT_R64G64_SFLOAT, VK_FORMAT_R64G64_SINT, VK_FORMAT_R64G64_UINT, VK_FORMAT_R64_SFLOAT, VK_FORMAT_R64_SINT, VK_FORMAT_R64_UINT, VK_FORMAT_R8G8B8A8_SINT, VK_FORMAT_R8G8B8A8_SNORM, VK_FORMAT_R8G8B8A8_SRGB, VK_FORMAT_R8G8B8A8_UINT, VK_FORMAT_R8G8B8A8_UNORM, VK_FORMAT_R8G8B8_SINT, VK_FORMAT_R8G8B8_SNORM, VK_FORMAT_R8G8B8_SRGB, VK_FORMAT_R8G8B8_UINT, VK_FORMAT_R8G8B8_UNORM, VK_FORMAT_R8G8_SINT, VK_FORMAT_R8G8_SNORM, VK_FORMAT_R8G8_SRGB, VK_FORMAT_R8G8_UINT, VK_FORMAT_R8G8_UNORM, VK_FORMAT_R8_SINT, VK_FORMAT_R8_SNORM, VK_FORMAT_R8_SRGB, VK_FORMAT_R8_UINT, VK_FORMAT_R8_UNORM, VK_FORMAT_S8_UINT, VK_FORMAT_UNDEFINED, VK_FORMAT_X8_D24_UNORM_PACK32, createDefaultContainer, read, write };\n//# sourceMappingURL=ktx-parse.modern.js.map\n","import { ExtensionProperty, PropertyType, RefMap, Extension, BufferUtils, WriterContext, Primitive, Root, AnimationSampler, AnimationChannel, Accessor, MathUtils, GLB_BUFFER, ImageUtils, getBounds, TextureInfo, TextureChannel, RefSet } from '@gltf-transform/core';\nimport { read, KHR_DF_MODEL_ETC1S, KHR_DF_MODEL_UASTC } from 'ktx-parse';\n\nconst EXT_MESH_GPU_INSTANCING = 'EXT_mesh_gpu_instancing';\nconst EXT_MESHOPT_COMPRESSION = 'EXT_meshopt_compression';\nconst EXT_TEXTURE_WEBP = 'EXT_texture_webp';\nconst EXT_TEXTURE_AVIF = 'EXT_texture_avif';\nconst KHR_DRACO_MESH_COMPRESSION = 'KHR_draco_mesh_compression';\nconst KHR_LIGHTS_PUNCTUAL = 'KHR_lights_punctual';\nconst KHR_MATERIALS_ANISOTROPY = 'KHR_materials_anisotropy';\nconst KHR_MATERIALS_CLEARCOAT = 'KHR_materials_clearcoat';\nconst KHR_MATERIALS_DIFFUSE_TRANSMISSION = 'KHR_materials_diffuse_transmission';\nconst KHR_MATERIALS_DISPERSION = 'KHR_materials_dispersion';\nconst KHR_MATERIALS_EMISSIVE_STRENGTH = 'KHR_materials_emissive_strength';\nconst KHR_MATERIALS_IOR = 'KHR_materials_ior';\nconst KHR_MATERIALS_IRIDESCENCE = 'KHR_materials_iridescence';\nconst KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS = 'KHR_materials_pbrSpecularGlossiness';\nconst KHR_MATERIALS_SHEEN = 'KHR_materials_sheen';\nconst KHR_MATERIALS_SPECULAR = 'KHR_materials_specular';\nconst KHR_MATERIALS_TRANSMISSION = 'KHR_materials_transmission';\nconst KHR_MATERIALS_UNLIT = 'KHR_materials_unlit';\nconst KHR_MATERIALS_VOLUME = 'KHR_materials_volume';\nconst KHR_MATERIALS_VARIANTS = 'KHR_materials_variants';\nconst KHR_MESH_QUANTIZATION = 'KHR_mesh_quantization';\nconst KHR_TEXTURE_BASISU = 'KHR_texture_basisu';\nconst KHR_TEXTURE_TRANSFORM = 'KHR_texture_transform';\nconst KHR_XMP_JSON_LD = 'KHR_xmp_json_ld';\n\n// See BufferViewUsage in `writer-context.ts`.\nconst INSTANCE_ATTRIBUTE = 'INSTANCE_ATTRIBUTE';\n/**\n * Defines GPU instances of a {@link Mesh} under one {@link Node}. See {@link EXTMeshGPUInstancing}.\n */\nclass InstancedMesh extends ExtensionProperty {\n  init() {\n    this.extensionName = EXT_MESH_GPU_INSTANCING;\n    this.propertyType = 'InstancedMesh';\n    this.parentTypes = [PropertyType.NODE];\n  }\n  getDefaults() {\n    return Object.assign(super.getDefaults(), {\n      attributes: new RefMap()\n    });\n  }\n  /** Returns an instance attribute as an {@link Accessor}. */\n  getAttribute(semantic) {\n    return this.getRefMap('attributes', semantic);\n  }\n  /**\n   * Sets an instance attribute to an {@link Accessor}. All attributes must have the same\n   * instance count.\n   */\n  setAttribute(semantic, accessor) {\n    return this.setRefMap('attributes', semantic, accessor, {\n      usage: INSTANCE_ATTRIBUTE\n    });\n  }\n  /**\n   * Lists all instance attributes {@link Accessor}s associated with the InstancedMesh. Order\n   * will be consistent with the order returned by {@link .listSemantics}().\n   */\n  listAttributes() {\n    return this.listRefMapValues('attributes');\n  }\n  /**\n   * Lists all instance attribute semantics associated with the primitive. Order will be\n   * consistent with the order returned by {@link .listAttributes}().\n   */\n  listSemantics() {\n    return this.listRefMapKeys('attributes');\n  }\n}\nInstancedMesh.EXTENSION_NAME = EXT_MESH_GPU_INSTANCING;\n\n/**\n * [`EXT_mesh_gpu_instancing`](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_mesh_gpu_instancing/)\n * prepares mesh data for efficient GPU instancing.\n *\n * GPU instancing allows engines to render many copies of a single mesh at once using a small number\n * of draw calls. Instancing is particularly useful for things like trees, grass, road signs, etc.\n * Keep in mind that predefined batches, as used in this extension, may prevent frustum culling\n * within a batch. Dividing batches into collocated cells may be preferable to using a single large\n * batch.\n *\n * > _**NOTICE:** While this extension stores mesh data optimized for GPU instancing, it\n * > is important to note that (1) GPU instancing and other optimizations are possible — and\n * > encouraged — even without this extension, and (2) other common meanings of the term\n * > \"instancing\" exist, distinct from this extension. See\n * > [Appendix: Motivation and Purpose](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_mesh_gpu_instancing#appendix-motivation-and-purpose)\n * > of the `EXT_mesh_gpu_instancing` specification._\n *\n * Properties:\n * - {@link InstancedMesh}\n *\n * ### Example\n *\n * The `EXTMeshGPUInstancing` class provides a single {@link ExtensionProperty} type, `InstancedMesh`,\n * which may be attached to any {@link Node} instance. For example:\n *\n * ```typescript\n * import { EXTMeshGPUInstancing } from '@gltf-transform/extensions';\n *\n * // Create standard mesh, node, and scene hierarchy.\n * // ...\n *\n * // Assign positions for each instance.\n * const batchPositions = doc.createAccessor('instance_positions')\n * \t.setArray(new Float32Array([\n * \t\t0, 0, 0,\n * \t\t1, 0, 0,\n * \t\t2, 0, 0,\n * \t]))\n * \t.setType(Accessor.Type.VEC3)\n * \t.setBuffer(buffer);\n *\n * // Assign IDs for each instance.\n * const batchIDs = doc.createAccessor('instance_ids')\n * \t.setArray(new Uint8Array([0, 1, 2]))\n * \t.setType(Accessor.Type.SCALAR)\n * \t.setBuffer(buffer);\n *\n * // Create an Extension attached to the Document.\n * const batchExtension = document.createExtension(EXTMeshGPUInstancing)\n * \t.setRequired(true);\n * const batch = batchExtension.createInstancedMesh()\n * \t.setAttribute('TRANSLATION', batchPositions)\n * \t.setAttribute('_ID', batchIDs);\n *\n * node\n * \t.setMesh(mesh)\n * \t.setExtension('EXT_mesh_gpu_instancing', batch);\n * ```\n *\n * Standard instance attributes are `TRANSLATION`, `ROTATION`, and `SCALE`, and support the accessor\n * types allowed by the extension specification. Custom instance attributes are allowed, and should\n * be prefixed with an underscore (`_*`).\n */\nclass EXTMeshGPUInstancing extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = EXT_MESH_GPU_INSTANCING;\n    /** @hidden */\n    this.provideTypes = [PropertyType.NODE];\n    /** @hidden */\n    this.prewriteTypes = [PropertyType.ACCESSOR];\n  }\n  /** Creates a new InstancedMesh property for use on a {@link Node}. */\n  createInstancedMesh() {\n    return new InstancedMesh(this.document.getGraph());\n  }\n  /** @hidden */\n  read(context) {\n    const jsonDoc = context.jsonDoc;\n    const nodeDefs = jsonDoc.json.nodes || [];\n    nodeDefs.forEach((nodeDef, nodeIndex) => {\n      if (!nodeDef.extensions || !nodeDef.extensions[EXT_MESH_GPU_INSTANCING]) return;\n      const instancedMeshDef = nodeDef.extensions[EXT_MESH_GPU_INSTANCING];\n      const instancedMesh = this.createInstancedMesh();\n      for (const semantic in instancedMeshDef.attributes) {\n        instancedMesh.setAttribute(semantic, context.accessors[instancedMeshDef.attributes[semantic]]);\n      }\n      context.nodes[nodeIndex].setExtension(EXT_MESH_GPU_INSTANCING, instancedMesh);\n    });\n    return this;\n  }\n  /** @hidden */\n  prewrite(context) {\n    // Set usage for instance attribute accessors, so they are stored in separate buffer\n    // views grouped by parent reference.\n    context.accessorUsageGroupedByParent.add(INSTANCE_ATTRIBUTE);\n    for (const prop of this.properties) {\n      for (const attribute of prop.listAttributes()) {\n        context.addAccessorToUsageGroup(attribute, INSTANCE_ATTRIBUTE);\n      }\n    }\n    return this;\n  }\n  /** @hidden */\n  write(context) {\n    const jsonDoc = context.jsonDoc;\n    this.document.getRoot().listNodes().forEach(node => {\n      const instancedMesh = node.getExtension(EXT_MESH_GPU_INSTANCING);\n      if (instancedMesh) {\n        const nodeIndex = context.nodeIndexMap.get(node);\n        const nodeDef = jsonDoc.json.nodes[nodeIndex];\n        const instancedMeshDef = {\n          attributes: {}\n        };\n        instancedMesh.listSemantics().forEach(semantic => {\n          const attribute = instancedMesh.getAttribute(semantic);\n          instancedMeshDef.attributes[semantic] = context.accessorIndexMap.get(attribute);\n        });\n        nodeDef.extensions = nodeDef.extensions || {};\n        nodeDef.extensions[EXT_MESH_GPU_INSTANCING] = instancedMeshDef;\n      }\n    });\n    return this;\n  }\n}\nEXTMeshGPUInstancing.EXTENSION_NAME = EXT_MESH_GPU_INSTANCING;\n\nfunction _extends() {\n  return _extends = Object.assign ? Object.assign.bind() : function (n) {\n    for (var e = 1; e < arguments.length; e++) {\n      var t = arguments[e];\n      for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]);\n    }\n    return n;\n  }, _extends.apply(null, arguments);\n}\n\nvar EncoderMethod$1;\n(function (EncoderMethod) {\n  EncoderMethod[\"QUANTIZE\"] = \"quantize\";\n  EncoderMethod[\"FILTER\"] = \"filter\";\n})(EncoderMethod$1 || (EncoderMethod$1 = {}));\nvar MeshoptMode;\n(function (MeshoptMode) {\n  MeshoptMode[\"ATTRIBUTES\"] = \"ATTRIBUTES\";\n  MeshoptMode[\"TRIANGLES\"] = \"TRIANGLES\";\n  MeshoptMode[\"INDICES\"] = \"INDICES\";\n})(MeshoptMode || (MeshoptMode = {}));\nvar MeshoptFilter;\n(function (MeshoptFilter) {\n  /** No filter — quantize only. */\n  MeshoptFilter[\"NONE\"] = \"NONE\";\n  /** Four 8- or 16-bit normalized values. */\n  MeshoptFilter[\"OCTAHEDRAL\"] = \"OCTAHEDRAL\";\n  /** Four 16-bit normalized values. */\n  MeshoptFilter[\"QUATERNION\"] = \"QUATERNION\";\n  /** K single-precision floating point values. */\n  MeshoptFilter[\"EXPONENTIAL\"] = \"EXPONENTIAL\";\n})(MeshoptFilter || (MeshoptFilter = {}));\n\n/**\n * Returns true for a fallback buffer, else false.\n *\n *   - All references to the fallback buffer must come from bufferViews that\n *     have a EXT_meshopt_compression extension specified.\n *   - No references to the fallback buffer may come from\n *     EXT_meshopt_compression extension JSON.\n */\nfunction isFallbackBuffer(bufferDef) {\n  if (!bufferDef.extensions || !bufferDef.extensions[EXT_MESHOPT_COMPRESSION]) return false;\n  const fallbackDef = bufferDef.extensions[EXT_MESHOPT_COMPRESSION];\n  return !!fallbackDef.fallback;\n}\n\nconst {\n  BYTE,\n  SHORT,\n  FLOAT\n} = Accessor.ComponentType;\nconst {\n  encodeNormalizedInt,\n  decodeNormalizedInt\n} = MathUtils;\n/** Pre-processes array with required filters or padding. */\nfunction prepareAccessor(accessor, encoder, mode, filterOptions) {\n  const {\n    filter,\n    bits\n  } = filterOptions;\n  const result = {\n    array: accessor.getArray(),\n    byteStride: accessor.getElementSize() * accessor.getComponentSize(),\n    componentType: accessor.getComponentType(),\n    normalized: accessor.getNormalized()\n  };\n  if (mode !== MeshoptMode.ATTRIBUTES) return result;\n  if (filter !== MeshoptFilter.NONE) {\n    let array = accessor.getNormalized() ? decodeNormalizedIntArray(accessor) : new Float32Array(result.array);\n    switch (filter) {\n      case MeshoptFilter.EXPONENTIAL:\n        // → K single-precision floating point values.\n        result.byteStride = accessor.getElementSize() * 4;\n        result.componentType = FLOAT;\n        result.normalized = false;\n        result.array = encoder.encodeFilterExp(array, accessor.getCount(), result.byteStride, bits);\n        break;\n      case MeshoptFilter.OCTAHEDRAL:\n        // → four 8- or 16-bit normalized values.\n        result.byteStride = bits > 8 ? 8 : 4;\n        result.componentType = bits > 8 ? SHORT : BYTE;\n        result.normalized = true;\n        array = accessor.getElementSize() === 3 ? padNormals(array) : array;\n        result.array = encoder.encodeFilterOct(array, accessor.getCount(), result.byteStride, bits);\n        break;\n      case MeshoptFilter.QUATERNION:\n        // → four 16-bit normalized values.\n        result.byteStride = 8;\n        result.componentType = SHORT;\n        result.normalized = true;\n        result.array = encoder.encodeFilterQuat(array, accessor.getCount(), result.byteStride, bits);\n        break;\n      default:\n        throw new Error('Invalid filter.');\n    }\n    result.min = accessor.getMin([]);\n    result.max = accessor.getMax([]);\n    if (accessor.getNormalized()) {\n      result.min = result.min.map(v => decodeNormalizedInt(v, accessor.getComponentType()));\n      result.max = result.max.map(v => decodeNormalizedInt(v, accessor.getComponentType()));\n    }\n    if (result.normalized) {\n      result.min = result.min.map(v => encodeNormalizedInt(v, result.componentType));\n      result.max = result.max.map(v => encodeNormalizedInt(v, result.componentType));\n    }\n  } else if (result.byteStride % 4) {\n    result.array = padArrayElements(result.array, accessor.getElementSize());\n    result.byteStride = result.array.byteLength / accessor.getCount();\n  }\n  return result;\n}\nfunction decodeNormalizedIntArray(attribute) {\n  const componentType = attribute.getComponentType();\n  const srcArray = attribute.getArray();\n  const dstArray = new Float32Array(srcArray.length);\n  for (let i = 0; i < srcArray.length; i++) {\n    dstArray[i] = decodeNormalizedInt(srcArray[i], componentType);\n  }\n  return dstArray;\n}\n/** Pads array to 4 byte alignment, required for Meshopt ATTRIBUTE buffer views. */\nfunction padArrayElements(srcArray, elementSize) {\n  const byteStride = BufferUtils.padNumber(srcArray.BYTES_PER_ELEMENT * elementSize);\n  const elementStride = byteStride / srcArray.BYTES_PER_ELEMENT;\n  const elementCount = srcArray.length / elementSize;\n  const dstArray = new srcArray.constructor(elementCount * elementStride);\n  for (let i = 0; i * elementSize < srcArray.length; i++) {\n    for (let j = 0; j < elementSize; j++) {\n      dstArray[i * elementStride + j] = srcArray[i * elementSize + j];\n    }\n  }\n  return dstArray;\n}\n/** Pad normals with a .w component for octahedral encoding. */\nfunction padNormals(srcArray) {\n  const dstArray = new Float32Array(srcArray.length * 4 / 3);\n  for (let i = 0, il = srcArray.length / 3; i < il; i++) {\n    dstArray[i * 4] = srcArray[i * 3];\n    dstArray[i * 4 + 1] = srcArray[i * 3 + 1];\n    dstArray[i * 4 + 2] = srcArray[i * 3 + 2];\n  }\n  return dstArray;\n}\nfunction getMeshoptMode(accessor, usage) {\n  if (usage === WriterContext.BufferViewUsage.ELEMENT_ARRAY_BUFFER) {\n    const isTriangles = accessor.listParents().some(parent => {\n      return parent instanceof Primitive && parent.getMode() === Primitive.Mode.TRIANGLES;\n    });\n    return isTriangles ? MeshoptMode.TRIANGLES : MeshoptMode.INDICES;\n  }\n  return MeshoptMode.ATTRIBUTES;\n}\nfunction getMeshoptFilter(accessor, doc) {\n  const refs = doc.getGraph().listParentEdges(accessor).filter(edge => !(edge.getParent() instanceof Root));\n  for (const ref of refs) {\n    const refName = ref.getName();\n    const refKey = ref.getAttributes().key || '';\n    const isDelta = ref.getParent().propertyType === PropertyType.PRIMITIVE_TARGET;\n    // Indices.\n    if (refName === 'indices') return {\n      filter: MeshoptFilter.NONE\n    };\n    // Attributes.\n    //\n    // NOTES:\n    // - Vertex attributes should be filtered IFF they are _not_ quantized in\n    //   'packages/cli/src/transforms/meshopt.ts'.\n    // - POSITION and TEXCOORD_0 could use exponential filtering, but this produces broken\n    //   output in some cases (e.g. Matilda.glb), for unknown reasons. gltfpack uses manual\n    //   quantization for these attributes.\n    // - NORMAL and TANGENT attributes use Octahedral filters, but deltas in morphs do not.\n    // - When specifying bit depth for vertex attributes, check the defaults in `quantize.ts`\n    //\t and overrides in `meshopt.ts`. Don't store deltas at higher precision than base.\n    if (refName === 'attributes') {\n      if (refKey === 'POSITION') return {\n        filter: MeshoptFilter.NONE\n      };\n      if (refKey === 'TEXCOORD_0') return {\n        filter: MeshoptFilter.NONE\n      };\n      if (refKey.startsWith('JOINTS_')) return {\n        filter: MeshoptFilter.NONE\n      };\n      if (refKey.startsWith('WEIGHTS_')) return {\n        filter: MeshoptFilter.NONE\n      };\n      if (refKey === 'NORMAL' || refKey === 'TANGENT') {\n        return isDelta ? {\n          filter: MeshoptFilter.NONE\n        } : {\n          filter: MeshoptFilter.OCTAHEDRAL,\n          bits: 8\n        };\n      }\n    }\n    // Animation.\n    if (refName === 'output') {\n      const targetPath = getTargetPath(accessor);\n      if (targetPath === 'rotation') return {\n        filter: MeshoptFilter.QUATERNION,\n        bits: 16\n      };\n      if (targetPath === 'translation') return {\n        filter: MeshoptFilter.EXPONENTIAL,\n        bits: 12\n      };\n      if (targetPath === 'scale') return {\n        filter: MeshoptFilter.EXPONENTIAL,\n        bits: 12\n      };\n      return {\n        filter: MeshoptFilter.NONE\n      };\n    }\n    // See: https://github.com/donmccurdy/glTF-Transform/issues/489\n    if (refName === 'input') return {\n      filter: MeshoptFilter.NONE\n    };\n    if (refName === 'inverseBindMatrices') return {\n      filter: MeshoptFilter.NONE\n    };\n  }\n  return {\n    filter: MeshoptFilter.NONE\n  };\n}\nfunction getTargetPath(accessor) {\n  for (const sampler of accessor.listParents()) {\n    if (!(sampler instanceof AnimationSampler)) continue;\n    for (const channel of sampler.listParents()) {\n      if (!(channel instanceof AnimationChannel)) continue;\n      return channel.getTargetPath();\n    }\n  }\n  return null;\n}\n\nconst DEFAULT_ENCODER_OPTIONS$1 = {\n  method: EncoderMethod$1.QUANTIZE\n};\n/**\n * [`EXT_meshopt_compression`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Vendor/EXT_meshopt_compression/)\n * provides compression and fast decoding for geometry, morph targets, and animations.\n *\n * Meshopt compression (based on the [meshoptimizer](https://github.com/zeux/meshoptimizer)\n * library) offers a lightweight decoder with very fast runtime decompression, and is\n * appropriate for models of any size. Meshopt can reduce the transmission sizes of geometry,\n * morph targets, animation, and other numeric data stored in buffer views. When textures are\n * large, other complementary compression methods should be used as well.\n *\n * For the full benefits of meshopt compression, **apply gzip, brotli, or another lossless\n * compression method** to the resulting .glb, .gltf, or .bin files. Meshopt specifically\n * pre-optimizes assets for this purpose — without this secondary compression, the size\n * reduction is considerably less.\n *\n * Be aware that decompression happens before uploading to the GPU. While Meshopt decoding is\n * considerably faster than Draco decoding, neither compression method will improve runtime\n * performance directly. To improve framerate, you'll need to simplify the geometry by reducing\n * vertex count or draw calls — not just compress it. Finally, be aware that Meshopt compression is\n * lossy: repeatedly compressing and decompressing a model in a pipeline will lose precision, so\n * compression should generally be the last stage of an art workflow, and uncompressed original\n * files should be kept.\n *\n * The meshoptimizer library ([github](https://github.com/zeux/meshoptimizer/tree/master/js),\n * [npm](https://www.npmjs.com/package/meshoptimizer)) is a required dependency for reading or\n * writing files, and must be provided by the application. Compression may alternatively be applied\n * with the [gltfpack](https://github.com/zeux/meshoptimizer/tree/master/gltf) tool.\n *\n * ### Example — Read\n *\n * To read glTF files using Meshopt compression, ensure that the extension\n * and a decoder are registered. Geometry and other data are decompressed\n * while reading the file.\n *\n * ```typescript\n * import { NodeIO } from '@gltf-transform/core';\n * import { EXTMeshoptCompression } from '@gltf-transform/extensions';\n * import { MeshoptDecoder } from 'meshoptimizer';\n *\n * await MeshoptDecoder.ready;\n *\n * const io = new NodeIO()\n * \t.registerExtensions([EXTMeshoptCompression])\n * \t.registerDependencies({ 'meshopt.decoder': MeshoptDecoder });\n *\n * // Read and decode.\n * const document = await io.read('compressed.glb');\n * ```\n *\n * ### Example — Write\n *\n * The simplest way to apply Meshopt compression is with the {@link meshopt}\n * transform. The extension and an encoder must be registered.\n *\n * ```typescript\n * import { NodeIO } from '@gltf-transform/core';\n * import { EXTMeshoptCompression } from '@gltf-transform/extensions';\n * import { meshopt } from '@gltf-transform/functions';\n * import { MeshoptEncoder } from 'meshoptimizer';\n *\n * await MeshoptEncoder.ready;\n *\n * const io = new NodeIO()\n * \t.registerExtensions([EXTMeshoptCompression])\n * \t.registerDependencies({ 'meshopt.encoder': MeshoptEncoder });\n *\n * await document.transform(\n *   meshopt({encoder: MeshoptEncoder, level: 'medium'})\n * );\n *\n * await io.write('compressed-medium.glb', document);\n * ```\n *\n * ### Example — Advanced\n *\n * Internally, the {@link meshopt} transform reorders and quantizes vertex data\n * to preparate for compression. If you prefer different pre-processing, the\n * EXTMeshoptCompression extension can be added to the document manually:\n *\n * ```typescript\n * import { reorder, quantize } from '@gltf-transform/functions';\n * import { EXTMeshoptCompression } from '@gltf-transform/extensions';\n * import { MeshoptEncoder } from 'meshoptimizer';\n *\n * await document.transform(\n * \treorder({encoder: MeshoptEncoder}),\n * \tquantize()\n * );\n *\n * document.createExtension(EXTMeshoptCompression)\n * \t.setRequired(true)\n * \t.setEncoderOptions({ method: EXTMeshoptCompression.EncoderMethod.QUANTIZE });\n * ```\n *\n * In either case, compression is deferred until generating output with an I/O\n * class.\n */\nclass EXTMeshoptCompression extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = EXT_MESHOPT_COMPRESSION;\n    /** @hidden */\n    this.prereadTypes = [PropertyType.BUFFER, PropertyType.PRIMITIVE];\n    /** @hidden */\n    this.prewriteTypes = [PropertyType.BUFFER, PropertyType.ACCESSOR];\n    /** @hidden */\n    this.readDependencies = ['meshopt.decoder'];\n    /** @hidden */\n    this.writeDependencies = ['meshopt.encoder'];\n    this._decoder = null;\n    this._decoderFallbackBufferMap = new Map();\n    this._encoder = null;\n    this._encoderOptions = DEFAULT_ENCODER_OPTIONS$1;\n    this._encoderFallbackBuffer = null;\n    this._encoderBufferViews = {};\n    this._encoderBufferViewData = {};\n    this._encoderBufferViewAccessors = {};\n  }\n  /** @hidden */\n  install(key, dependency) {\n    if (key === 'meshopt.decoder') {\n      this._decoder = dependency;\n    }\n    if (key === 'meshopt.encoder') {\n      this._encoder = dependency;\n    }\n    return this;\n  }\n  /**\n   * Configures Meshopt options for quality/compression tuning. The two methods rely on different\n   * pre-processing before compression, and should be compared on the basis of (a) quality/loss\n   * and (b) final asset size after _also_ applying a lossless compression such as gzip or brotli.\n   *\n   * - QUANTIZE: Default. Pre-process with {@link quantize quantize()} (lossy to specified\n   * \tprecision) before applying lossless Meshopt compression. Offers a considerable compression\n   * \tratio with or without further supercompression. Equivalent to `gltfpack -c`.\n   * - FILTER: Pre-process with lossy filters to improve compression, before applying lossless\n   *\tMeshopt compression. While output may initially be larger than with the QUANTIZE method,\n   *\tthis method will benefit more from supercompression (e.g. gzip or brotli). Equivalent to\n   * \t`gltfpack -cc`.\n   *\n   * Output with the FILTER method will generally be smaller after supercompression (e.g. gzip or\n   * brotli) is applied, but may be larger than QUANTIZE output without it. Decoding is very fast\n   * with both methods.\n   *\n   * Example:\n   *\n   * ```ts\n   * import { EXTMeshoptCompression } from '@gltf-transform/extensions';\n   *\n   * doc.createExtension(EXTMeshoptCompression)\n   * \t.setRequired(true)\n   * \t.setEncoderOptions({\n   * \t\tmethod: EXTMeshoptCompression.EncoderMethod.QUANTIZE\n   * \t});\n   * ```\n   */\n  setEncoderOptions(options) {\n    this._encoderOptions = _extends({}, DEFAULT_ENCODER_OPTIONS$1, options);\n    return this;\n  }\n  /**********************************************************************************************\n   * Decoding.\n   */\n  /** @internal Checks preconditions, decodes buffer views, and creates decoded primitives. */\n  preread(context, propertyType) {\n    if (!this._decoder) {\n      if (!this.isRequired()) return this;\n      throw new Error(`[${EXT_MESHOPT_COMPRESSION}] Please install extension dependency, \"meshopt.decoder\".`);\n    }\n    if (!this._decoder.supported) {\n      if (!this.isRequired()) return this;\n      throw new Error(`[${EXT_MESHOPT_COMPRESSION}]: Missing WASM support.`);\n    }\n    if (propertyType === PropertyType.BUFFER) {\n      this._prereadBuffers(context);\n    } else if (propertyType === PropertyType.PRIMITIVE) {\n      this._prereadPrimitives(context);\n    }\n    return this;\n  }\n  /** @internal Decode buffer views. */\n  _prereadBuffers(context) {\n    const jsonDoc = context.jsonDoc;\n    const viewDefs = jsonDoc.json.bufferViews || [];\n    viewDefs.forEach((viewDef, index) => {\n      if (!viewDef.extensions || !viewDef.extensions[EXT_MESHOPT_COMPRESSION]) return;\n      const meshoptDef = viewDef.extensions[EXT_MESHOPT_COMPRESSION];\n      const byteOffset = meshoptDef.byteOffset || 0;\n      const byteLength = meshoptDef.byteLength || 0;\n      const count = meshoptDef.count;\n      const stride = meshoptDef.byteStride;\n      const result = new Uint8Array(count * stride);\n      const bufferDef = jsonDoc.json.buffers[meshoptDef.buffer];\n      // TODO(cleanup): Should be encapsulated in writer-context.ts.\n      const resource = bufferDef.uri ? jsonDoc.resources[bufferDef.uri] : jsonDoc.resources[GLB_BUFFER];\n      const source = BufferUtils.toView(resource, byteOffset, byteLength);\n      this._decoder.decodeGltfBuffer(result, count, stride, source, meshoptDef.mode, meshoptDef.filter);\n      context.bufferViews[index] = result;\n    });\n  }\n  /**\n   * Mark fallback buffers and replacements.\n   *\n   * Note: Alignment with primitives is arbitrary; this just needs to happen\n   * after Buffers have been parsed.\n   * @internal\n   */\n  _prereadPrimitives(context) {\n    const jsonDoc = context.jsonDoc;\n    const viewDefs = jsonDoc.json.bufferViews || [];\n    //\n    viewDefs.forEach(viewDef => {\n      if (!viewDef.extensions || !viewDef.extensions[EXT_MESHOPT_COMPRESSION]) return;\n      const meshoptDef = viewDef.extensions[EXT_MESHOPT_COMPRESSION];\n      const buffer = context.buffers[meshoptDef.buffer];\n      const fallbackBuffer = context.buffers[viewDef.buffer];\n      const fallbackBufferDef = jsonDoc.json.buffers[viewDef.buffer];\n      if (isFallbackBuffer(fallbackBufferDef)) {\n        this._decoderFallbackBufferMap.set(fallbackBuffer, buffer);\n      }\n    });\n  }\n  /** @hidden Removes Fallback buffers, if extension is required. */\n  read(_context) {\n    if (!this.isRequired()) return this;\n    // Replace fallback buffers.\n    for (const [fallbackBuffer, buffer] of this._decoderFallbackBufferMap) {\n      for (const parent of fallbackBuffer.listParents()) {\n        if (parent instanceof Accessor) {\n          parent.swap(fallbackBuffer, buffer);\n        }\n      }\n      fallbackBuffer.dispose();\n    }\n    return this;\n  }\n  /**********************************************************************************************\n   * Encoding.\n   */\n  /** @internal Claims accessors that can be compressed and writes compressed buffer views. */\n  prewrite(context, propertyType) {\n    if (propertyType === PropertyType.ACCESSOR) {\n      this._prewriteAccessors(context);\n    } else if (propertyType === PropertyType.BUFFER) {\n      this._prewriteBuffers(context);\n    }\n    return this;\n  }\n  /** @internal Claims accessors that can be compressed. */\n  _prewriteAccessors(context) {\n    const json = context.jsonDoc.json;\n    const encoder = this._encoder;\n    const options = this._encoderOptions;\n    const graph = this.document.getGraph();\n    const fallbackBuffer = this.document.createBuffer(); // Disposed on write.\n    const fallbackBufferIndex = this.document.getRoot().listBuffers().indexOf(fallbackBuffer);\n    let nextID = 1;\n    const parentToID = new Map();\n    const getParentID = property => {\n      for (const parent of graph.listParents(property)) {\n        if (parent.propertyType === PropertyType.ROOT) continue;\n        let id = parentToID.get(property);\n        if (id === undefined) parentToID.set(property, id = nextID++);\n        return id;\n      }\n      return -1;\n    };\n    this._encoderFallbackBuffer = fallbackBuffer;\n    this._encoderBufferViews = {};\n    this._encoderBufferViewData = {};\n    this._encoderBufferViewAccessors = {};\n    for (const accessor of this.document.getRoot().listAccessors()) {\n      // See: https://github.com/donmccurdy/glTF-Transform/pull/323#issuecomment-898791251\n      // Example: https://skfb.ly/6qAD8\n      if (getTargetPath(accessor) === 'weights') continue;\n      // See: https://github.com/donmccurdy/glTF-Transform/issues/289\n      if (accessor.getSparse()) continue;\n      const usage = context.getAccessorUsage(accessor);\n      const parentID = context.accessorUsageGroupedByParent.has(usage) ? getParentID(accessor) : null;\n      const mode = getMeshoptMode(accessor, usage);\n      const filter = options.method === EncoderMethod$1.FILTER ? getMeshoptFilter(accessor, this.document) : {\n        filter: MeshoptFilter.NONE\n      };\n      const preparedAccessor = prepareAccessor(accessor, encoder, mode, filter);\n      const {\n        array,\n        byteStride\n      } = preparedAccessor;\n      const buffer = accessor.getBuffer();\n      if (!buffer) throw new Error(`${EXT_MESHOPT_COMPRESSION}: Missing buffer for accessor.`);\n      const bufferIndex = this.document.getRoot().listBuffers().indexOf(buffer);\n      // Buffer view grouping key.\n      const key = [usage, parentID, mode, filter.filter, byteStride, bufferIndex].join(':');\n      let bufferView = this._encoderBufferViews[key];\n      let bufferViewData = this._encoderBufferViewData[key];\n      let bufferViewAccessors = this._encoderBufferViewAccessors[key];\n      // Write new buffer view, if needed.\n      if (!bufferView || !bufferViewData) {\n        bufferViewAccessors = this._encoderBufferViewAccessors[key] = [];\n        bufferViewData = this._encoderBufferViewData[key] = [];\n        bufferView = this._encoderBufferViews[key] = {\n          buffer: fallbackBufferIndex,\n          target: WriterContext.USAGE_TO_TARGET[usage],\n          byteOffset: 0,\n          byteLength: 0,\n          byteStride: usage === WriterContext.BufferViewUsage.ARRAY_BUFFER ? byteStride : undefined,\n          extensions: {\n            [EXT_MESHOPT_COMPRESSION]: {\n              buffer: bufferIndex,\n              byteOffset: 0,\n              byteLength: 0,\n              mode: mode,\n              filter: filter.filter !== MeshoptFilter.NONE ? filter.filter : undefined,\n              byteStride: byteStride,\n              count: 0\n            }\n          }\n        };\n      }\n      // Write accessor.\n      const accessorDef = context.createAccessorDef(accessor);\n      accessorDef.componentType = preparedAccessor.componentType;\n      accessorDef.normalized = preparedAccessor.normalized;\n      accessorDef.byteOffset = bufferView.byteLength;\n      if (accessorDef.min && preparedAccessor.min) accessorDef.min = preparedAccessor.min;\n      if (accessorDef.max && preparedAccessor.max) accessorDef.max = preparedAccessor.max;\n      context.accessorIndexMap.set(accessor, json.accessors.length);\n      json.accessors.push(accessorDef);\n      bufferViewAccessors.push(accessorDef);\n      // Update buffer view.\n      bufferViewData.push(new Uint8Array(array.buffer, array.byteOffset, array.byteLength));\n      bufferView.byteLength += array.byteLength;\n      bufferView.extensions.EXT_meshopt_compression.count += accessor.getCount();\n    }\n  }\n  /** @internal Writes compressed buffer views. */\n  _prewriteBuffers(context) {\n    const encoder = this._encoder;\n    for (const key in this._encoderBufferViews) {\n      const bufferView = this._encoderBufferViews[key];\n      const bufferViewData = this._encoderBufferViewData[key];\n      const buffer = this.document.getRoot().listBuffers()[bufferView.extensions[EXT_MESHOPT_COMPRESSION].buffer];\n      const otherBufferViews = context.otherBufferViews.get(buffer) || [];\n      const {\n        count,\n        byteStride,\n        mode\n      } = bufferView.extensions[EXT_MESHOPT_COMPRESSION];\n      const srcArray = BufferUtils.concat(bufferViewData);\n      const dstArray = encoder.encodeGltfBuffer(srcArray, count, byteStride, mode);\n      const compressedData = BufferUtils.pad(dstArray);\n      bufferView.extensions[EXT_MESHOPT_COMPRESSION].byteLength = dstArray.byteLength;\n      bufferViewData.length = 0;\n      bufferViewData.push(compressedData);\n      otherBufferViews.push(compressedData);\n      context.otherBufferViews.set(buffer, otherBufferViews);\n    }\n  }\n  /** @hidden Puts encoded data into glTF output. */\n  write(context) {\n    let fallbackBufferByteOffset = 0;\n    // Write final encoded buffer view properties.\n    for (const key in this._encoderBufferViews) {\n      const bufferView = this._encoderBufferViews[key];\n      const bufferViewData = this._encoderBufferViewData[key][0];\n      const bufferViewIndex = context.otherBufferViewsIndexMap.get(bufferViewData);\n      const bufferViewAccessors = this._encoderBufferViewAccessors[key];\n      for (const accessorDef of bufferViewAccessors) {\n        accessorDef.bufferView = bufferViewIndex;\n      }\n      const finalBufferViewDef = context.jsonDoc.json.bufferViews[bufferViewIndex];\n      const compressedByteOffset = finalBufferViewDef.byteOffset || 0;\n      Object.assign(finalBufferViewDef, bufferView);\n      finalBufferViewDef.byteOffset = fallbackBufferByteOffset;\n      const bufferViewExtensionDef = finalBufferViewDef.extensions[EXT_MESHOPT_COMPRESSION];\n      bufferViewExtensionDef.byteOffset = compressedByteOffset;\n      fallbackBufferByteOffset += BufferUtils.padNumber(bufferView.byteLength);\n    }\n    // Write final fallback buffer.\n    const fallbackBuffer = this._encoderFallbackBuffer;\n    const fallbackBufferIndex = context.bufferIndexMap.get(fallbackBuffer);\n    const fallbackBufferDef = context.jsonDoc.json.buffers[fallbackBufferIndex];\n    fallbackBufferDef.byteLength = fallbackBufferByteOffset;\n    fallbackBufferDef.extensions = {\n      [EXT_MESHOPT_COMPRESSION]: {\n        fallback: true\n      }\n    };\n    fallbackBuffer.dispose();\n    return this;\n  }\n}\nEXTMeshoptCompression.EXTENSION_NAME = EXT_MESHOPT_COMPRESSION;\nEXTMeshoptCompression.EncoderMethod = EncoderMethod$1;\n\nclass AVIFImageUtils {\n  match(array) {\n    return array.length >= 12 && BufferUtils.decodeText(array.slice(4, 12)) === 'ftypavif';\n  }\n  /**\n   * Probes size of AVIF or HEIC image. Assumes a single static image, without\n   * orientation or other metadata that would affect dimensions.\n   */\n  getSize(array) {\n    if (!this.match(array)) return null;\n    // References:\n    // - https://stackoverflow.com/questions/66222773/how-to-get-image-dimensions-from-an-avif-file\n    // - https://github.com/nodeca/probe-image-size/blob/master/lib/parse_sync/avif.js\n    const view = new DataView(array.buffer, array.byteOffset, array.byteLength);\n    let box = unbox(view, 0);\n    if (!box) return null;\n    let offset = box.end;\n    while (box = unbox(view, offset)) {\n      if (box.type === 'meta') {\n        offset = box.start + 4; // version + flags\n      } else if (box.type === 'iprp' || box.type === 'ipco') {\n        offset = box.start;\n      } else if (box.type === 'ispe') {\n        return [view.getUint32(box.start + 4), view.getUint32(box.start + 8)];\n      } else if (box.type === 'mdat') {\n        break; // mdat should be last, unlikely to find metadata past here.\n      } else {\n        offset = box.end;\n      }\n    }\n    return null;\n  }\n  getChannels(_buffer) {\n    return 4;\n  }\n}\n/**\n * [`EXT_texture_avif`](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_avif/)\n * enables AVIF images for any material texture.\n *\n * AVIF offers greatly reduced transmission size, but\n * [requires browser support](https://caniuse.com/avif). Like PNG and JPEG, an AVIF image is\n * *fully decompressed* when uploaded to the GPU, which increases upload time and GPU memory cost.\n * For seamless uploads and minimal GPU memory cost, it is necessary to use a GPU texture format\n * like Basis Universal, with the `KHR_texture_basisu` extension.\n *\n * Defining no {@link ExtensionProperty} types, this {@link Extension} is simply attached to the\n * {@link Document}, and affects the entire Document by allowing use of the `image/avif` MIME type\n * and passing AVIF image data to the {@link Texture.setImage} method. Without the Extension, the\n * same MIME types and image data would yield an invalid glTF document, under the stricter core glTF\n * specification.\n *\n * Properties:\n * - N/A\n *\n * ### Example\n *\n * ```typescript\n * import { TextureAVIF } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const avifExtension = document.createExtension(TextureAVIF)\n * \t.setRequired(true);\n * document.createTexture('MyAVIFTexture')\n * \t.setMimeType('image/avif')\n * \t.setImage(fs.readFileSync('my-texture.avif'));\n * ```\n *\n * AVIF conversion is not done automatically when adding the extension as shown above — you must\n * convert the image data first, then pass the `.avif` payload to {@link Texture.setImage}.\n *\n * When the `EXT_texture_avif` extension is added to a file by glTF-Transform, the extension should\n * always be required. This tool does not support writing assets that \"fall back\" to optional PNG or\n * JPEG image data.\n */\nclass EXTTextureAVIF extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = EXT_TEXTURE_AVIF;\n    /** @hidden */\n    this.prereadTypes = [PropertyType.TEXTURE];\n  }\n  /** @hidden */\n  static register() {\n    ImageUtils.registerFormat('image/avif', new AVIFImageUtils());\n  }\n  /** @hidden */\n  preread(context) {\n    const textureDefs = context.jsonDoc.json.textures || [];\n    textureDefs.forEach(textureDef => {\n      if (textureDef.extensions && textureDef.extensions[EXT_TEXTURE_AVIF]) {\n        textureDef.source = textureDef.extensions[EXT_TEXTURE_AVIF].source;\n      }\n    });\n    return this;\n  }\n  /** @hidden */\n  read(_context) {\n    return this;\n  }\n  /** @hidden */\n  write(context) {\n    const jsonDoc = context.jsonDoc;\n    this.document.getRoot().listTextures().forEach(texture => {\n      if (texture.getMimeType() === 'image/avif') {\n        const imageIndex = context.imageIndexMap.get(texture);\n        const textureDefs = jsonDoc.json.textures || [];\n        textureDefs.forEach(textureDef => {\n          if (textureDef.source === imageIndex) {\n            textureDef.extensions = textureDef.extensions || {};\n            textureDef.extensions[EXT_TEXTURE_AVIF] = {\n              source: textureDef.source\n            };\n            delete textureDef.source;\n          }\n        });\n      }\n    });\n    return this;\n  }\n}\nEXTTextureAVIF.EXTENSION_NAME = EXT_TEXTURE_AVIF;\nfunction unbox(data, offset) {\n  if (data.byteLength < 4 + offset) return null;\n  // size includes first 4 bytes (length)\n  const size = data.getUint32(offset);\n  if (data.byteLength < size + offset || size < 8) return null;\n  return {\n    type: BufferUtils.decodeText(new Uint8Array(data.buffer, data.byteOffset + offset + 4, 4)),\n    start: offset + 8,\n    end: offset + size\n  };\n}\n\nclass WEBPImageUtils {\n  match(array) {\n    return array.length >= 12 && array[8] === 87 && array[9] === 69 && array[10] === 66 && array[11] === 80;\n  }\n  getSize(array) {\n    // Reference: http://tools.ietf.org/html/rfc6386\n    const RIFF = BufferUtils.decodeText(array.slice(0, 4));\n    const WEBP = BufferUtils.decodeText(array.slice(8, 12));\n    if (RIFF !== 'RIFF' || WEBP !== 'WEBP') return null;\n    const view = new DataView(array.buffer, array.byteOffset);\n    // Reference: https://wiki.tcl-lang.org/page/Reading+WEBP+image+dimensions\n    let offset = 12;\n    while (offset < view.byteLength) {\n      const chunkId = BufferUtils.decodeText(new Uint8Array([view.getUint8(offset), view.getUint8(offset + 1), view.getUint8(offset + 2), view.getUint8(offset + 3)]));\n      const chunkByteLength = view.getUint32(offset + 4, true);\n      if (chunkId === 'VP8 ') {\n        const width = view.getInt16(offset + 14, true) & 0x3fff;\n        const height = view.getInt16(offset + 16, true) & 0x3fff;\n        return [width, height];\n      } else if (chunkId === 'VP8L') {\n        const b0 = view.getUint8(offset + 9);\n        const b1 = view.getUint8(offset + 10);\n        const b2 = view.getUint8(offset + 11);\n        const b3 = view.getUint8(offset + 12);\n        const width = 1 + ((b1 & 0x3f) << 8 | b0);\n        const height = 1 + ((b3 & 0xf) << 10 | b2 << 2 | (b1 & 0xc0) >> 6);\n        return [width, height];\n      }\n      offset += 8 + chunkByteLength + chunkByteLength % 2;\n    }\n    return null;\n  }\n  getChannels(_buffer) {\n    return 4;\n  }\n}\n/**\n * [`EXT_texture_webp`](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_webp/)\n * enables WebP images for any material texture.\n *\n * WebP offers greatly reduced transmission size, but\n * [requires browser support](https://caniuse.com/webp). Like PNG and JPEG, a WebP image is\n * *fully decompressed* when uploaded to the GPU, which increases upload time and GPU memory cost.\n * For seamless uploads and minimal GPU memory cost, it is necessary to use a GPU texture format\n * like Basis Universal, with the `KHR_texture_basisu` extension.\n *\n * Defining no {@link ExtensionProperty} types, this {@link Extension} is simply attached to the\n * {@link Document}, and affects the entire Document by allowing use of the `image/webp` MIME type\n * and passing WebP image data to the {@link Texture.setImage} method. Without the Extension, the\n * same MIME types and image data would yield an invalid glTF document, under the stricter core glTF\n * specification.\n *\n * Properties:\n * - N/A\n *\n * ### Example\n *\n * ```typescript\n * import { EXTTextureWebP } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const webpExtension = document.createExtension(EXTTextureWebP)\n * \t.setRequired(true);\n * document.createTexture('MyWebPTexture')\n * \t.setMimeType('image/webp')\n * \t.setImage(fs.readFileSync('my-texture.webp'));\n * ```\n *\n * WebP conversion is not done automatically when adding the extension as shown above — you must\n * convert the image data first, then pass the `.webp` payload to {@link Texture.setImage}.\n *\n * When the `EXT_texture_webp` extension is added to a file by glTF-Transform, the extension should\n * always be required. This tool does not support writing assets that \"fall back\" to optional PNG or\n * JPEG image data.\n */\nclass EXTTextureWebP extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = EXT_TEXTURE_WEBP;\n    /** @hidden */\n    this.prereadTypes = [PropertyType.TEXTURE];\n  }\n  /** @hidden */\n  static register() {\n    ImageUtils.registerFormat('image/webp', new WEBPImageUtils());\n  }\n  /** @hidden */\n  preread(context) {\n    const textureDefs = context.jsonDoc.json.textures || [];\n    textureDefs.forEach(textureDef => {\n      if (textureDef.extensions && textureDef.extensions[EXT_TEXTURE_WEBP]) {\n        textureDef.source = textureDef.extensions[EXT_TEXTURE_WEBP].source;\n      }\n    });\n    return this;\n  }\n  /** @hidden */\n  read(_context) {\n    return this;\n  }\n  /** @hidden */\n  write(context) {\n    const jsonDoc = context.jsonDoc;\n    this.document.getRoot().listTextures().forEach(texture => {\n      if (texture.getMimeType() === 'image/webp') {\n        const imageIndex = context.imageIndexMap.get(texture);\n        const textureDefs = jsonDoc.json.textures || [];\n        textureDefs.forEach(textureDef => {\n          if (textureDef.source === imageIndex) {\n            textureDef.extensions = textureDef.extensions || {};\n            textureDef.extensions[EXT_TEXTURE_WEBP] = {\n              source: textureDef.source\n            };\n            delete textureDef.source;\n          }\n        });\n      }\n    });\n    return this;\n  }\n}\nEXTTextureWebP.EXTENSION_NAME = EXT_TEXTURE_WEBP;\n\nlet decoderModule;\n// Initialized when decoder module loads.\nlet COMPONENT_ARRAY;\nlet DATA_TYPE;\nfunction decodeGeometry(decoder, data) {\n  const buffer = new decoderModule.DecoderBuffer();\n  try {\n    buffer.Init(data, data.length);\n    const geometryType = decoder.GetEncodedGeometryType(buffer);\n    if (geometryType !== decoderModule.TRIANGULAR_MESH) {\n      throw new Error(`[${KHR_DRACO_MESH_COMPRESSION}] Unknown geometry type.`);\n    }\n    const dracoMesh = new decoderModule.Mesh();\n    const status = decoder.DecodeBufferToMesh(buffer, dracoMesh);\n    if (!status.ok() || dracoMesh.ptr === 0) {\n      throw new Error(`[${KHR_DRACO_MESH_COMPRESSION}] Decoding failure.`);\n    }\n    return dracoMesh;\n  } finally {\n    decoderModule.destroy(buffer);\n  }\n}\nfunction decodeIndex(decoder, mesh) {\n  const numFaces = mesh.num_faces();\n  const numIndices = numFaces * 3;\n  let ptr;\n  let indices;\n  if (mesh.num_points() <= 65534) {\n    const byteLength = numIndices * Uint16Array.BYTES_PER_ELEMENT;\n    ptr = decoderModule._malloc(byteLength);\n    decoder.GetTrianglesUInt16Array(mesh, byteLength, ptr);\n    indices = new Uint16Array(decoderModule.HEAPU16.buffer, ptr, numIndices).slice();\n  } else {\n    const byteLength = numIndices * Uint32Array.BYTES_PER_ELEMENT;\n    ptr = decoderModule._malloc(byteLength);\n    decoder.GetTrianglesUInt32Array(mesh, byteLength, ptr);\n    indices = new Uint32Array(decoderModule.HEAPU32.buffer, ptr, numIndices).slice();\n  }\n  decoderModule._free(ptr);\n  return indices;\n}\nfunction decodeAttribute(decoder, mesh, attribute, accessorDef) {\n  const dataType = DATA_TYPE[accessorDef.componentType];\n  const ArrayCtor = COMPONENT_ARRAY[accessorDef.componentType];\n  const numComponents = attribute.num_components();\n  const numPoints = mesh.num_points();\n  const numValues = numPoints * numComponents;\n  const byteLength = numValues * ArrayCtor.BYTES_PER_ELEMENT;\n  const ptr = decoderModule._malloc(byteLength);\n  decoder.GetAttributeDataArrayForAllPoints(mesh, attribute, dataType, byteLength, ptr);\n  const array = new ArrayCtor(decoderModule.HEAPF32.buffer, ptr, numValues).slice();\n  decoderModule._free(ptr);\n  return array;\n}\nfunction initDecoderModule(_decoderModule) {\n  decoderModule = _decoderModule;\n  COMPONENT_ARRAY = {\n    [Accessor.ComponentType.FLOAT]: Float32Array,\n    [Accessor.ComponentType.UNSIGNED_INT]: Uint32Array,\n    [Accessor.ComponentType.UNSIGNED_SHORT]: Uint16Array,\n    [Accessor.ComponentType.UNSIGNED_BYTE]: Uint8Array,\n    [Accessor.ComponentType.SHORT]: Int16Array,\n    [Accessor.ComponentType.BYTE]: Int8Array\n  };\n  DATA_TYPE = {\n    [Accessor.ComponentType.FLOAT]: decoderModule.DT_FLOAT32,\n    [Accessor.ComponentType.UNSIGNED_INT]: decoderModule.DT_UINT32,\n    [Accessor.ComponentType.UNSIGNED_SHORT]: decoderModule.DT_UINT16,\n    [Accessor.ComponentType.UNSIGNED_BYTE]: decoderModule.DT_UINT8,\n    [Accessor.ComponentType.SHORT]: decoderModule.DT_INT16,\n    [Accessor.ComponentType.BYTE]: decoderModule.DT_INT8\n  };\n}\n\nlet encoderModule;\nvar EncoderMethod;\n(function (EncoderMethod) {\n  EncoderMethod[EncoderMethod[\"EDGEBREAKER\"] = 1] = \"EDGEBREAKER\";\n  EncoderMethod[EncoderMethod[\"SEQUENTIAL\"] = 0] = \"SEQUENTIAL\";\n})(EncoderMethod || (EncoderMethod = {}));\nvar AttributeEnum;\n(function (AttributeEnum) {\n  AttributeEnum[\"POSITION\"] = \"POSITION\";\n  AttributeEnum[\"NORMAL\"] = \"NORMAL\";\n  AttributeEnum[\"COLOR\"] = \"COLOR\";\n  AttributeEnum[\"TEX_COORD\"] = \"TEX_COORD\";\n  AttributeEnum[\"GENERIC\"] = \"GENERIC\";\n})(AttributeEnum || (AttributeEnum = {}));\nconst DEFAULT_QUANTIZATION_BITS = {\n  [AttributeEnum.POSITION]: 14,\n  [AttributeEnum.NORMAL]: 10,\n  [AttributeEnum.COLOR]: 8,\n  [AttributeEnum.TEX_COORD]: 12,\n  [AttributeEnum.GENERIC]: 12\n};\nconst DEFAULT_ENCODER_OPTIONS = {\n  decodeSpeed: 5,\n  encodeSpeed: 5,\n  method: EncoderMethod.EDGEBREAKER,\n  quantizationBits: DEFAULT_QUANTIZATION_BITS,\n  quantizationVolume: 'mesh'\n};\nfunction initEncoderModule(_encoderModule) {\n  encoderModule = _encoderModule;\n}\n/**\n * References:\n * - https://github.com/mrdoob/three.js/blob/dev/examples/js/exporters/DRACOExporter.js\n * - https://github.com/CesiumGS/gltf-pipeline/blob/master/lib/compressDracoMeshes.js\n */\nfunction encodeGeometry(prim, _options = DEFAULT_ENCODER_OPTIONS) {\n  const options = _extends({}, DEFAULT_ENCODER_OPTIONS, _options);\n  options.quantizationBits = _extends({}, DEFAULT_QUANTIZATION_BITS, _options.quantizationBits);\n  const builder = new encoderModule.MeshBuilder();\n  const mesh = new encoderModule.Mesh();\n  const encoder = new encoderModule.ExpertEncoder(mesh);\n  const attributeIDs = {};\n  const dracoBuffer = new encoderModule.DracoInt8Array();\n  const hasMorphTargets = prim.listTargets().length > 0;\n  let hasSparseAttributes = false;\n  for (const semantic of prim.listSemantics()) {\n    const attribute = prim.getAttribute(semantic);\n    if (attribute.getSparse()) {\n      hasSparseAttributes = true;\n      continue;\n    }\n    const attributeEnum = getAttributeEnum(semantic);\n    const attributeID = addAttribute(builder, attribute.getComponentType(), mesh, encoderModule[attributeEnum], attribute.getCount(), attribute.getElementSize(), attribute.getArray());\n    if (attributeID === -1) throw new Error(`Error compressing \"${semantic}\" attribute.`);\n    attributeIDs[semantic] = attributeID;\n    if (options.quantizationVolume === 'mesh' || semantic !== 'POSITION') {\n      encoder.SetAttributeQuantization(attributeID, options.quantizationBits[attributeEnum]);\n    } else if (typeof options.quantizationVolume === 'object') {\n      const {\n        quantizationVolume\n      } = options;\n      const range = Math.max(quantizationVolume.max[0] - quantizationVolume.min[0], quantizationVolume.max[1] - quantizationVolume.min[1], quantizationVolume.max[2] - quantizationVolume.min[2]);\n      encoder.SetAttributeExplicitQuantization(attributeID, options.quantizationBits[attributeEnum], attribute.getElementSize(), quantizationVolume.min, range);\n    } else {\n      throw new Error('Invalid quantization volume state.');\n    }\n  }\n  const indices = prim.getIndices();\n  if (!indices) throw new EncodingError('Primitive must have indices.');\n  builder.AddFacesToMesh(mesh, indices.getCount() / 3, indices.getArray());\n  encoder.SetSpeedOptions(options.encodeSpeed, options.decodeSpeed);\n  encoder.SetTrackEncodedProperties(true);\n  // TODO(cleanup): Use edgebreaker without deduplication if possible.\n  // See https://github.com/google/draco/issues/929.\n  if (options.method === EncoderMethod.SEQUENTIAL || hasMorphTargets || hasSparseAttributes) {\n    encoder.SetEncodingMethod(encoderModule.MESH_SEQUENTIAL_ENCODING);\n  } else {\n    encoder.SetEncodingMethod(encoderModule.MESH_EDGEBREAKER_ENCODING);\n  }\n  // Encode, preserving vertex order for primitives with morph targets and sparse accessors.\n  const byteLength = encoder.EncodeToDracoBuffer(!(hasMorphTargets || hasSparseAttributes), dracoBuffer);\n  if (byteLength <= 0) throw new EncodingError('Error applying Draco compression.');\n  const data = new Uint8Array(byteLength);\n  for (let i = 0; i < byteLength; ++i) {\n    data[i] = dracoBuffer.GetValue(i);\n  }\n  const numVertices = encoder.GetNumberOfEncodedPoints();\n  const numIndices = encoder.GetNumberOfEncodedFaces() * 3;\n  encoderModule.destroy(dracoBuffer);\n  encoderModule.destroy(mesh);\n  encoderModule.destroy(builder);\n  encoderModule.destroy(encoder);\n  return {\n    numVertices,\n    numIndices,\n    data,\n    attributeIDs\n  };\n}\nfunction getAttributeEnum(semantic) {\n  if (semantic === 'POSITION') {\n    return AttributeEnum.POSITION;\n  } else if (semantic === 'NORMAL') {\n    return AttributeEnum.NORMAL;\n  } else if (semantic.startsWith('COLOR_')) {\n    return AttributeEnum.COLOR;\n  } else if (semantic.startsWith('TEXCOORD_')) {\n    return AttributeEnum.TEX_COORD;\n  }\n  return AttributeEnum.GENERIC;\n}\nfunction addAttribute(builder, componentType, mesh, attribute, count, itemSize, array) {\n  switch (componentType) {\n    case Accessor.ComponentType.UNSIGNED_BYTE:\n      return builder.AddUInt8Attribute(mesh, attribute, count, itemSize, array);\n    case Accessor.ComponentType.BYTE:\n      return builder.AddInt8Attribute(mesh, attribute, count, itemSize, array);\n    case Accessor.ComponentType.UNSIGNED_SHORT:\n      return builder.AddUInt16Attribute(mesh, attribute, count, itemSize, array);\n    case Accessor.ComponentType.SHORT:\n      return builder.AddInt16Attribute(mesh, attribute, count, itemSize, array);\n    case Accessor.ComponentType.UNSIGNED_INT:\n      return builder.AddUInt32Attribute(mesh, attribute, count, itemSize, array);\n    case Accessor.ComponentType.FLOAT:\n      return builder.AddFloatAttribute(mesh, attribute, count, itemSize, array);\n    default:\n      throw new Error(`Unexpected component type, \"${componentType}\".`);\n  }\n}\nclass EncodingError extends Error {}\n\n/**\n * [`KHR_draco_mesh_compression`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_draco_mesh_compression/)\n * provides advanced compression for mesh geometry.\n *\n * For models where geometry is a significant factor (>1 MB), Draco can reduce filesize by ~95%\n * in many cases. When animation or textures are large, other complementary compression methods\n * should be used as well. For geometry <1MB, the size of the WASM decoder library may outweigh\n * size savings.\n *\n * Be aware that decompression happens before uploading to the GPU — this will add some latency to\n * the parsing process, and means that compressing geometry with  Draco does _not_ affect runtime\n * performance. To improve framerate, you'll need to simplify the geometry by reducing vertex count\n * or draw calls — not just compress it. Finally, be aware that Draco compression is lossy:\n * repeatedly compressing and decompressing a model in a pipeline will lose precision, so\n * compression should generally be the last stage of an art workflow, and uncompressed original\n * files should be kept.\n *\n * A decoder or encoder from the `draco3dgltf` npm module for Node.js (or\n * [elsewhere for web](https://stackoverflow.com/a/66978236/1314762)) is required for reading and writing,\n * and must be provided by the application.\n *\n * ### Encoding options\n *\n * Two compression methods are available: 'edgebreaker' and 'sequential'. The\n * edgebreaker method will give higher compression in general, but changes the\n * order of the model's vertices. To preserve index order, use sequential\n * compression. When a mesh uses morph targets, or a high decoding speed is\n * selected, sequential compression will automatically be chosen.\n *\n * Both speed options affect the encoder's choice of algorithms. For example, a\n * requirement for fast decoding may prevent the encoder from using the best\n * compression methods even if the encoding speed is set to 0. In general, the\n * faster of the two options limits the choice of features that can be used by the\n * encoder. Setting --decodeSpeed to be faster than the --encodeSpeed may allow\n * the encoder to choose the optimal method out of the available features for the\n * given --decodeSpeed.\n *\n * ### Example — Read\n *\n * To read glTF files using Draco compression, ensure that the extension\n * and a decoder are registered. Geometry is decompressed while reading.\n *\n * ```typescript\n * import { NodeIO } from '@gltf-transform/core';\n * import { KHRDracoMeshCompression } from '@gltf-transform/extensions';\n * import draco3d from 'draco3dgltf';\n *\n * const io = new NodeIO()\n * \t.registerExtensions([KHRDracoMeshCompression])\n * \t.registerDependencies({\n * \t\t'draco3d.decoder': await draco3d.createDecoderModule()\n * \t});\n *\n * // Read and decode.\n * const document = await io.read('compressed.glb');\n * ```\n *\n * ### Example — Write\n *\n * The simplest way to apply Draco compression is with the {@link draco}\n * transform. The extension and an encoder must be registered.\n *\n * ```typescript\n * import { NodeIO } from '@gltf-transform/core';\n * import { KHRDracoMeshCompression } from '@gltf-transform/extensions';\n * import { draco } from '@gltf-transform/functions';\n * import draco3d from 'draco3dgltf';\n *\n * const io = new NodeIO()\n * \t.registerExtensions([KHRDracoMeshCompression])\n * \t.registerDependencies({\n * \t\t'draco3d.encoder': await draco3d.createEncoderModule()\n * \t});\n *\n * await document.transform(\n *   draco({method: 'edgebreaker'})\n * );\n *\n * await io.write('compressed.glb', document);\n * ```\n *\n * ### Example\n *\n * Equivalently, the KHRDracoMeshCompression extension can be added manually to a document.\n *\n * ```typescript\n * import { KHRDracoMeshCompression } from '@gltf-transform/extensions';\n *\n * document.createExtension(KHRDracoMeshCompression)\n * \t.setRequired(true)\n * \t.setEncoderOptions({\n * \t\tmethod: KHRDracoMeshCompression.EncoderMethod.EDGEBREAKER,\n * \t\tencodeSpeed: 5,\n * \t\tdecodeSpeed: 5,\n * \t});\n *\n * await io.write('compressed.glb', document);\n * ```\n *\n * In either case, Compression is deferred until generating output with an\n * I/O class.\n */\nclass KHRDracoMeshCompression extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_DRACO_MESH_COMPRESSION;\n    /** @hidden */\n    this.prereadTypes = [PropertyType.PRIMITIVE];\n    /** @hidden */\n    this.prewriteTypes = [PropertyType.ACCESSOR];\n    /** @hidden */\n    this.readDependencies = ['draco3d.decoder'];\n    /** @hidden */\n    this.writeDependencies = ['draco3d.encoder'];\n    this._decoderModule = null;\n    this._encoderModule = null;\n    this._encoderOptions = {};\n  }\n  /** @hidden */\n  install(key, dependency) {\n    if (key === 'draco3d.decoder') {\n      this._decoderModule = dependency;\n      initDecoderModule(this._decoderModule);\n    }\n    if (key === 'draco3d.encoder') {\n      this._encoderModule = dependency;\n      initEncoderModule(this._encoderModule);\n    }\n    return this;\n  }\n  /**\n   * Sets Draco compression options. Compression does not take effect until the Document is\n   * written with an I/O class.\n   *\n   * Defaults:\n   * ```\n   * decodeSpeed?: number = 5;\n   * encodeSpeed?: number = 5;\n   * method?: EncoderMethod = EncoderMethod.EDGEBREAKER;\n   * quantizationBits?: {[ATTRIBUTE_NAME]: bits};\n   * quantizationVolume?: 'mesh' | 'scene' | bbox = 'mesh';\n   * ```\n   */\n  setEncoderOptions(options) {\n    this._encoderOptions = options;\n    return this;\n  }\n  /** @hidden */\n  preread(context) {\n    if (!this._decoderModule) {\n      throw new Error(`[${KHR_DRACO_MESH_COMPRESSION}] Please install extension dependency, \"draco3d.decoder\".`);\n    }\n    const logger = this.document.getLogger();\n    const jsonDoc = context.jsonDoc;\n    const dracoMeshes = new Map();\n    try {\n      const meshDefs = jsonDoc.json.meshes || [];\n      for (const meshDef of meshDefs) {\n        for (const primDef of meshDef.primitives) {\n          if (!primDef.extensions || !primDef.extensions[KHR_DRACO_MESH_COMPRESSION]) continue;\n          const dracoDef = primDef.extensions[KHR_DRACO_MESH_COMPRESSION];\n          let [decoder, dracoMesh] = dracoMeshes.get(dracoDef.bufferView) || [];\n          if (!dracoMesh || !decoder) {\n            const bufferViewDef = jsonDoc.json.bufferViews[dracoDef.bufferView];\n            const bufferDef = jsonDoc.json.buffers[bufferViewDef.buffer];\n            // TODO(cleanup): Should be encapsulated in writer-context.ts.\n            const resource = bufferDef.uri ? jsonDoc.resources[bufferDef.uri] : jsonDoc.resources[GLB_BUFFER];\n            const byteOffset = bufferViewDef.byteOffset || 0;\n            const byteLength = bufferViewDef.byteLength;\n            const compressedData = BufferUtils.toView(resource, byteOffset, byteLength);\n            decoder = new this._decoderModule.Decoder();\n            dracoMesh = decodeGeometry(decoder, compressedData);\n            dracoMeshes.set(dracoDef.bufferView, [decoder, dracoMesh]);\n            logger.debug(`[${KHR_DRACO_MESH_COMPRESSION}] Decompressed ${compressedData.byteLength} bytes.`);\n          }\n          // Attributes.\n          for (const semantic in dracoDef.attributes) {\n            const accessorDef = context.jsonDoc.json.accessors[primDef.attributes[semantic]];\n            const dracoAttribute = decoder.GetAttributeByUniqueId(dracoMesh, dracoDef.attributes[semantic]);\n            const attributeArray = decodeAttribute(decoder, dracoMesh, dracoAttribute, accessorDef);\n            context.accessors[primDef.attributes[semantic]].setArray(attributeArray);\n          }\n          // Indices. Optional, see https://github.com/google/draco/issues/720.\n          if (primDef.indices !== undefined) {\n            context.accessors[primDef.indices].setArray(decodeIndex(decoder, dracoMesh));\n          }\n        }\n      }\n    } finally {\n      for (const [decoder, dracoMesh] of Array.from(dracoMeshes.values())) {\n        this._decoderModule.destroy(decoder);\n        this._decoderModule.destroy(dracoMesh);\n      }\n    }\n    return this;\n  }\n  /** @hidden */\n  read(_context) {\n    return this;\n  }\n  /** @hidden */\n  prewrite(context, _propertyType) {\n    if (!this._encoderModule) {\n      throw new Error(`[${KHR_DRACO_MESH_COMPRESSION}] Please install extension dependency, \"draco3d.encoder\".`);\n    }\n    const logger = this.document.getLogger();\n    logger.debug(`[${KHR_DRACO_MESH_COMPRESSION}] Compression options: ${JSON.stringify(this._encoderOptions)}`);\n    const primitiveHashMap = listDracoPrimitives(this.document);\n    const primitiveEncodingMap = new Map();\n    let quantizationVolume = 'mesh';\n    if (this._encoderOptions.quantizationVolume === 'scene') {\n      if (this.document.getRoot().listScenes().length !== 1) {\n        logger.warn(`[${KHR_DRACO_MESH_COMPRESSION}]: quantizationVolume=scene requires exactly 1 scene.`);\n      } else {\n        quantizationVolume = getBounds(this.document.getRoot().listScenes().pop());\n      }\n    }\n    for (const prim of Array.from(primitiveHashMap.keys())) {\n      const primHash = primitiveHashMap.get(prim);\n      if (!primHash) throw new Error('Unexpected primitive.');\n      // Reuse an existing EncodedPrimitive, if possible.\n      if (primitiveEncodingMap.has(primHash)) {\n        primitiveEncodingMap.set(primHash, primitiveEncodingMap.get(primHash));\n        continue;\n      }\n      const indices = prim.getIndices(); // Condition for listDracoPrimitives().\n      const accessorDefs = context.jsonDoc.json.accessors;\n      // Create a new EncodedPrimitive.\n      let encodedPrim;\n      try {\n        encodedPrim = encodeGeometry(prim, _extends({}, this._encoderOptions, {\n          quantizationVolume\n        }));\n      } catch (e) {\n        if (e instanceof EncodingError) {\n          logger.warn(`[${KHR_DRACO_MESH_COMPRESSION}]: ${e.message} Skipping primitive compression.`);\n          continue;\n        }\n        throw e;\n      }\n      primitiveEncodingMap.set(primHash, encodedPrim);\n      // Create indices definition, update count.\n      const indicesDef = context.createAccessorDef(indices);\n      indicesDef.count = encodedPrim.numIndices;\n      context.accessorIndexMap.set(indices, accessorDefs.length);\n      accessorDefs.push(indicesDef);\n      // In rare cases Draco increases vertex count, requiring a larger index component type.\n      // https://github.com/donmccurdy/glTF-Transform/issues/1370\n      if (encodedPrim.numVertices > 65534 && Accessor.getComponentSize(indicesDef.componentType) <= 2) {\n        indicesDef.componentType = Accessor.ComponentType.UNSIGNED_INT;\n      } else if (encodedPrim.numVertices > 254 && Accessor.getComponentSize(indicesDef.componentType) <= 1) {\n        indicesDef.componentType = Accessor.ComponentType.UNSIGNED_SHORT;\n      }\n      // Create attribute definitions, update count.\n      for (const semantic of prim.listSemantics()) {\n        const attribute = prim.getAttribute(semantic);\n        if (encodedPrim.attributeIDs[semantic] === undefined) continue; // sparse\n        const attributeDef = context.createAccessorDef(attribute);\n        attributeDef.count = encodedPrim.numVertices;\n        context.accessorIndexMap.set(attribute, accessorDefs.length);\n        accessorDefs.push(attributeDef);\n      }\n      // Map compressed buffer view to a Buffer.\n      const buffer = prim.getAttribute('POSITION').getBuffer() || this.document.getRoot().listBuffers()[0];\n      if (!context.otherBufferViews.has(buffer)) context.otherBufferViews.set(buffer, []);\n      context.otherBufferViews.get(buffer).push(encodedPrim.data);\n    }\n    logger.debug(`[${KHR_DRACO_MESH_COMPRESSION}] Compressed ${primitiveHashMap.size} primitives.`);\n    context.extensionData[KHR_DRACO_MESH_COMPRESSION] = {\n      primitiveHashMap,\n      primitiveEncodingMap\n    };\n    return this;\n  }\n  /** @hidden */\n  write(context) {\n    const dracoContext = context.extensionData[KHR_DRACO_MESH_COMPRESSION];\n    for (const mesh of this.document.getRoot().listMeshes()) {\n      const meshDef = context.jsonDoc.json.meshes[context.meshIndexMap.get(mesh)];\n      for (let i = 0; i < mesh.listPrimitives().length; i++) {\n        const prim = mesh.listPrimitives()[i];\n        const primDef = meshDef.primitives[i];\n        const primHash = dracoContext.primitiveHashMap.get(prim);\n        if (!primHash) continue;\n        const encodedPrim = dracoContext.primitiveEncodingMap.get(primHash);\n        if (!encodedPrim) continue;\n        primDef.extensions = primDef.extensions || {};\n        primDef.extensions[KHR_DRACO_MESH_COMPRESSION] = {\n          bufferView: context.otherBufferViewsIndexMap.get(encodedPrim.data),\n          attributes: encodedPrim.attributeIDs\n        };\n      }\n    }\n    // Omit the extension if nothing was compressed.\n    if (!dracoContext.primitiveHashMap.size) {\n      const json = context.jsonDoc.json;\n      json.extensionsUsed = (json.extensionsUsed || []).filter(name => name !== KHR_DRACO_MESH_COMPRESSION);\n      json.extensionsRequired = (json.extensionsRequired || []).filter(name => name !== KHR_DRACO_MESH_COMPRESSION);\n    }\n    return this;\n  }\n}\n/**\n * Returns a list of Primitives compatible with Draco compression. If any required preconditions\n * fail, and would break assumptions required for compression, this function will throw an error.\n */\nKHRDracoMeshCompression.EXTENSION_NAME = KHR_DRACO_MESH_COMPRESSION;\n/**\n * Compression method. `EncoderMethod.EDGEBREAKER` usually provides a higher compression ratio,\n * while `EncoderMethod.SEQUENTIAL` better preserves original vertex order.\n */\nKHRDracoMeshCompression.EncoderMethod = EncoderMethod;\nfunction listDracoPrimitives(doc) {\n  const logger = doc.getLogger();\n  const included = new Set();\n  const excluded = new Set();\n  let nonIndexed = 0;\n  let nonTriangles = 0;\n  // Support compressing only indexed, mode=TRIANGLES primitives.\n  for (const mesh of doc.getRoot().listMeshes()) {\n    for (const prim of mesh.listPrimitives()) {\n      if (!prim.getIndices()) {\n        excluded.add(prim);\n        nonIndexed++;\n      } else if (prim.getMode() !== Primitive.Mode.TRIANGLES) {\n        excluded.add(prim);\n        nonTriangles++;\n      } else {\n        included.add(prim);\n      }\n    }\n  }\n  if (nonIndexed > 0) {\n    logger.warn(`[${KHR_DRACO_MESH_COMPRESSION}] Skipping Draco compression of ${nonIndexed} non-indexed primitives.`);\n  }\n  if (nonTriangles > 0) {\n    logger.warn(`[${KHR_DRACO_MESH_COMPRESSION}] Skipping Draco compression of ${nonTriangles} non-TRIANGLES primitives.`);\n  }\n  // Create an Accessor->index mapping.\n  const accessors = doc.getRoot().listAccessors();\n  const accessorIndices = new Map();\n  for (let i = 0; i < accessors.length; i++) accessorIndices.set(accessors[i], i);\n  // For each compressed Primitive, create a hash key identifying its accessors. Map each\n  // compressed Primitive and Accessor to this hash key.\n  const includedAccessors = new Map();\n  const includedHashKeys = new Set();\n  const primToHashKey = new Map();\n  for (const prim of Array.from(included)) {\n    let hashKey = createHashKey(prim, accessorIndices);\n    // If accessors of an identical primitive have already been checked, we're done.\n    if (includedHashKeys.has(hashKey)) {\n      primToHashKey.set(prim, hashKey);\n      continue;\n    }\n    // If any accessors are already in use, but the same hashKey hasn't been written, then we\n    // need to create copies of these accessors for the current encoded primitive. We can't\n    // reuse the same compressed accessor for two encoded primitives, because Draco might\n    // change the vertex count, change the vertex order, or cause other conflicts.\n    if (includedAccessors.has(prim.getIndices())) {\n      const indices = prim.getIndices(); // Condition for 'included' list.\n      const dstIndices = indices.clone();\n      accessorIndices.set(dstIndices, doc.getRoot().listAccessors().length - 1);\n      prim.swap(indices, dstIndices); // TODO(cleanup): I/O should not modify Document.\n    }\n    for (const attribute of prim.listAttributes()) {\n      if (includedAccessors.has(attribute)) {\n        const dstAttribute = attribute.clone();\n        accessorIndices.set(dstAttribute, doc.getRoot().listAccessors().length - 1);\n        prim.swap(attribute, dstAttribute); // TODO(cleanup): I/O should not modify Document.\n      }\n    }\n    // With conflicts resolved, compute the hash key again.\n    hashKey = createHashKey(prim, accessorIndices);\n    // Commit the primitive and its accessors to the hash key.\n    includedHashKeys.add(hashKey);\n    primToHashKey.set(prim, hashKey);\n    includedAccessors.set(prim.getIndices(), hashKey);\n    for (const attribute of prim.listAttributes()) {\n      includedAccessors.set(attribute, hashKey);\n    }\n  }\n  // For each compressed Accessor, ensure that it isn't used except by a Primitive.\n  for (const accessor of Array.from(includedAccessors.keys())) {\n    const parentTypes = new Set(accessor.listParents().map(prop => prop.propertyType));\n    if (parentTypes.size !== 2 || !parentTypes.has(PropertyType.PRIMITIVE) || !parentTypes.has(PropertyType.ROOT)) {\n      throw new Error(`[${KHR_DRACO_MESH_COMPRESSION}] Compressed accessors must only be used as indices or vertex attributes.`);\n    }\n  }\n  // For each compressed Primitive, ensure that Accessors are mapped only to the same hash key.\n  for (const prim of Array.from(included)) {\n    const hashKey = primToHashKey.get(prim);\n    const indices = prim.getIndices(); // Condition for 'included' list.\n    if (includedAccessors.get(indices) !== hashKey || prim.listAttributes().some(attr => includedAccessors.get(attr) !== hashKey)) {\n      throw new Error(`[${KHR_DRACO_MESH_COMPRESSION}] Draco primitives must share all, or no, accessors.`);\n    }\n  }\n  // For each excluded Primitive, ensure that no Accessors are compressed.\n  for (const prim of Array.from(excluded)) {\n    const indices = prim.getIndices(); // Condition for 'included' list.\n    if (includedAccessors.has(indices) || prim.listAttributes().some(attr => includedAccessors.has(attr))) {\n      throw new Error(`[${KHR_DRACO_MESH_COMPRESSION}] Accessor cannot be shared by compressed and uncompressed primitives.`);\n    }\n  }\n  return primToHashKey;\n}\nfunction createHashKey(prim, indexMap) {\n  const hashElements = [];\n  const indices = prim.getIndices(); // Condition for 'included' list.\n  hashElements.push(indexMap.get(indices));\n  for (const attribute of prim.listAttributes()) {\n    hashElements.push(indexMap.get(attribute));\n  }\n  return hashElements.sort().join('|');\n}\n\n/**\n * Defines a light attached to a {@link Node}. See {@link KHRLightsPunctual}.\n */\nclass Light extends ExtensionProperty {\n  /**********************************************************************************************\n   * INSTANCE.\n   */\n  init() {\n    this.extensionName = KHR_LIGHTS_PUNCTUAL;\n    this.propertyType = 'Light';\n    this.parentTypes = [PropertyType.NODE];\n  }\n  getDefaults() {\n    return Object.assign(super.getDefaults(), {\n      color: [1, 1, 1],\n      intensity: 1,\n      type: Light.Type.POINT,\n      range: null,\n      innerConeAngle: 0,\n      outerConeAngle: Math.PI / 4\n    });\n  }\n  /**********************************************************************************************\n   * COLOR.\n   */\n  /** Light color; Linear-sRGB components. */\n  getColor() {\n    return this.get('color');\n  }\n  /** Light color; Linear-sRGB components. */\n  setColor(color) {\n    return this.set('color', color);\n  }\n  /**********************************************************************************************\n   * INTENSITY.\n   */\n  /**\n   * Brightness of light. Units depend on the type of light: point and spot lights use luminous\n   * intensity in candela (lm/sr) while directional lights use illuminance in lux (lm/m2).\n   */\n  getIntensity() {\n    return this.get('intensity');\n  }\n  /**\n   * Brightness of light. Units depend on the type of light: point and spot lights use luminous\n   * intensity in candela (lm/sr) while directional lights use illuminance in lux (lm/m2).\n   */\n  setIntensity(intensity) {\n    return this.set('intensity', intensity);\n  }\n  /**********************************************************************************************\n   * TYPE.\n   */\n  /** Type. */\n  getType() {\n    return this.get('type');\n  }\n  /** Type. */\n  setType(type) {\n    return this.set('type', type);\n  }\n  /**********************************************************************************************\n   * RANGE.\n   */\n  /**\n   * Hint defining a distance cutoff at which the light's intensity may be considered to have\n   * reached zero. Supported only for point and spot lights. Must be > 0. When undefined, range\n   * is assumed to be infinite.\n   */\n  getRange() {\n    return this.get('range');\n  }\n  /**\n   * Hint defining a distance cutoff at which the light's intensity may be considered to have\n   * reached zero. Supported only for point and spot lights. Must be > 0. When undefined, range\n   * is assumed to be infinite.\n   */\n  setRange(range) {\n    return this.set('range', range);\n  }\n  /**********************************************************************************************\n   * SPOT LIGHT PROPERTIES\n   */\n  /**\n   * Angle, in radians, from centre of spotlight where falloff begins. Must be >= 0 and\n   * < outerConeAngle.\n   */\n  getInnerConeAngle() {\n    return this.get('innerConeAngle');\n  }\n  /**\n   * Angle, in radians, from centre of spotlight where falloff begins. Must be >= 0 and\n   * < outerConeAngle.\n   */\n  setInnerConeAngle(angle) {\n    return this.set('innerConeAngle', angle);\n  }\n  /**\n   * Angle, in radians, from centre of spotlight where falloff ends. Must be > innerConeAngle and\n   * <= PI / 2.0.\n   */\n  getOuterConeAngle() {\n    return this.get('outerConeAngle');\n  }\n  /**\n   * Angle, in radians, from centre of spotlight where falloff ends. Must be > innerConeAngle and\n   * <= PI / 2.0.\n   */\n  setOuterConeAngle(angle) {\n    return this.set('outerConeAngle', angle);\n  }\n}\nLight.EXTENSION_NAME = KHR_LIGHTS_PUNCTUAL;\n/**********************************************************************************************\n * CONSTANTS.\n */\nLight.Type = {\n  POINT: 'point',\n  SPOT: 'spot',\n  DIRECTIONAL: 'directional'\n};\n\n/**\n * [`KHR_lights_punctual`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_lights_punctual/) defines three \"punctual\" light types: directional, point and\n * spot.\n *\n * Punctual lights are parameterized, infinitely small points that emit light in\n * well-defined directions and intensities. Lights are referenced by nodes and inherit the transform\n * of that node.\n *\n * Properties:\n * - {@link Light}\n *\n * ### Example\n *\n * ```typescript\n * import { KHRLightsPunctual, Light, LightType } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const lightsExtension = document.createExtension(KHRLightsPunctual);\n *\n * // Create a Light property.\n * const light = lightsExtension.createLight()\n *\t.setType(LightType.POINT)\n *\t.setIntensity(2.0)\n *\t.setColor([1.0, 0.0, 0.0]);\n *\n * // Attach the property to a Material.\n * node.setExtension('KHR_lights_punctual', light);\n * ```\n */\nclass KHRLightsPunctual extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_LIGHTS_PUNCTUAL;\n  }\n  /** Creates a new punctual Light property for use on a {@link Node}. */\n  createLight(name = '') {\n    return new Light(this.document.getGraph(), name);\n  }\n  /** @hidden */\n  read(context) {\n    const jsonDoc = context.jsonDoc;\n    if (!jsonDoc.json.extensions || !jsonDoc.json.extensions[KHR_LIGHTS_PUNCTUAL]) return this;\n    const rootDef = jsonDoc.json.extensions[KHR_LIGHTS_PUNCTUAL];\n    const lightDefs = rootDef.lights || [];\n    const lights = lightDefs.map(lightDef => {\n      var _lightDef$spot, _lightDef$spot2;\n      const light = this.createLight().setName(lightDef.name || '').setType(lightDef.type);\n      if (lightDef.color !== undefined) light.setColor(lightDef.color);\n      if (lightDef.intensity !== undefined) light.setIntensity(lightDef.intensity);\n      if (lightDef.range !== undefined) light.setRange(lightDef.range);\n      if (((_lightDef$spot = lightDef.spot) == null ? void 0 : _lightDef$spot.innerConeAngle) !== undefined) {\n        light.setInnerConeAngle(lightDef.spot.innerConeAngle);\n      }\n      if (((_lightDef$spot2 = lightDef.spot) == null ? void 0 : _lightDef$spot2.outerConeAngle) !== undefined) {\n        light.setOuterConeAngle(lightDef.spot.outerConeAngle);\n      }\n      return light;\n    });\n    jsonDoc.json.nodes.forEach((nodeDef, nodeIndex) => {\n      if (!nodeDef.extensions || !nodeDef.extensions[KHR_LIGHTS_PUNCTUAL]) return;\n      const lightNodeDef = nodeDef.extensions[KHR_LIGHTS_PUNCTUAL];\n      context.nodes[nodeIndex].setExtension(KHR_LIGHTS_PUNCTUAL, lights[lightNodeDef.light]);\n    });\n    return this;\n  }\n  /** @hidden */\n  write(context) {\n    const jsonDoc = context.jsonDoc;\n    if (this.properties.size === 0) return this;\n    const lightDefs = [];\n    const lightIndexMap = new Map();\n    for (const property of this.properties) {\n      const light = property;\n      const lightDef = {\n        type: light.getType()\n      };\n      if (!MathUtils.eq(light.getColor(), [1, 1, 1])) lightDef.color = light.getColor();\n      if (light.getIntensity() !== 1) lightDef.intensity = light.getIntensity();\n      if (light.getRange() != null) lightDef.range = light.getRange();\n      if (light.getName()) lightDef.name = light.getName();\n      if (light.getType() === Light.Type.SPOT) {\n        lightDef.spot = {\n          innerConeAngle: light.getInnerConeAngle(),\n          outerConeAngle: light.getOuterConeAngle()\n        };\n      }\n      lightDefs.push(lightDef);\n      lightIndexMap.set(light, lightDefs.length - 1);\n    }\n    this.document.getRoot().listNodes().forEach(node => {\n      const light = node.getExtension(KHR_LIGHTS_PUNCTUAL);\n      if (light) {\n        const nodeIndex = context.nodeIndexMap.get(node);\n        const nodeDef = jsonDoc.json.nodes[nodeIndex];\n        nodeDef.extensions = nodeDef.extensions || {};\n        nodeDef.extensions[KHR_LIGHTS_PUNCTUAL] = {\n          light: lightIndexMap.get(light)\n        };\n      }\n    });\n    jsonDoc.json.extensions = jsonDoc.json.extensions || {};\n    jsonDoc.json.extensions[KHR_LIGHTS_PUNCTUAL] = {\n      lights: lightDefs\n    };\n    return this;\n  }\n}\nKHRLightsPunctual.EXTENSION_NAME = KHR_LIGHTS_PUNCTUAL;\n\nconst {\n  R: R$7,\n  G: G$7,\n  B: B$5\n} = TextureChannel;\n/**\n * Defines anisotropy (directionally-dependent reflections) on a PBR {@link Material}. See\n * {@link KHRMaterialsAnisotropy}.\n */\nclass Anisotropy extends ExtensionProperty {\n  init() {\n    this.extensionName = KHR_MATERIALS_ANISOTROPY;\n    this.propertyType = 'Anisotropy';\n    this.parentTypes = [PropertyType.MATERIAL];\n  }\n  getDefaults() {\n    return Object.assign(super.getDefaults(), {\n      anisotropyStrength: 0.0,\n      anisotropyRotation: 0.0,\n      anisotropyTexture: null,\n      anisotropyTextureInfo: new TextureInfo(this.graph, 'anisotropyTextureInfo')\n    });\n  }\n  /**********************************************************************************************\n   * Anisotropy strength.\n   */\n  /** Anisotropy strength. */\n  getAnisotropyStrength() {\n    return this.get('anisotropyStrength');\n  }\n  /** Anisotropy strength. */\n  setAnisotropyStrength(strength) {\n    return this.set('anisotropyStrength', strength);\n  }\n  /**********************************************************************************************\n   * Anisotropy rotation.\n   */\n  /** Anisotropy rotation; linear multiplier. */\n  getAnisotropyRotation() {\n    return this.get('anisotropyRotation');\n  }\n  /** Anisotropy rotation; linear multiplier. */\n  setAnisotropyRotation(rotation) {\n    return this.set('anisotropyRotation', rotation);\n  }\n  /**********************************************************************************************\n   * Anisotropy texture.\n   */\n  /**\n   * Anisotropy texture. Red and green channels represent the anisotropy\n   * direction in [-1, 1] tangent, bitangent space, to be rotated by\n   * anisotropyRotation. The blue channel contains strength as [0, 1] to be\n   * multiplied by anisotropyStrength.\n   */\n  getAnisotropyTexture() {\n    return this.getRef('anisotropyTexture');\n  }\n  /**\n   * Settings affecting the material's use of its anisotropy texture. If no\n   * texture is attached, {@link TextureInfo} is `null`.\n   */\n  getAnisotropyTextureInfo() {\n    return this.getRef('anisotropyTexture') ? this.getRef('anisotropyTextureInfo') : null;\n  }\n  /** Anisotropy texture. See {@link Anisotropy.getAnisotropyTexture getAnisotropyTexture}. */\n  setAnisotropyTexture(texture) {\n    return this.setRef('anisotropyTexture', texture, {\n      channels: R$7 | G$7 | B$5\n    });\n  }\n}\nAnisotropy.EXTENSION_NAME = KHR_MATERIALS_ANISOTROPY;\n\n/**\n * [`KHR_materials_anisotropy`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_anisotropy/)\n * defines anisotropy (directionally-dependent reflections) on a PBR material.\n *\n * ![Illustration](/media/extensions/khr-materials-anisotropy.jpg)\n *\n * > _**Figure:** Effect of each color channel in the anisotropyTexture. Left\n * > to right: the full anisotropy texture, filling the red channel with black,\n * > filling the green channel with black, filling the blue channel with black.\n * > Source: [Khronos Group & Wayfair](https://github.com/KhronosGroup/glTF-Sample-Assets/tree/main/Models/AnisotropyBarnLamp)._\n *\n * This extension defines the anisotropic property of a material as observable with brushed metals\n * for instance. An asymmetric specular lobe model is introduced to allow for such phenomena. The\n * visually distinct feature of that lobe is the elongated appearance of the specular reflection.\n * For a single punctual light source, the specular reflection will eventually degenerate into a\n * zero width line in the limit, that is where the material is fully anisotropic, as opposed to be\n * fully isotropic in which case the specular reflection is radially symmetric.\n *\n * Properties:\n * - {@link Anisotropy}\n *\n * ### Example\n *\n * The `KHRMaterialsAnisotropy` class provides a single {@link ExtensionProperty} type, `Anisotropy`,\n * which may be attached to any {@link Material} instance. For example:\n *\n * ```typescript\n * import { KHRMaterialsAnisotropy, Anisotropy } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const anisotropyExtension = document.createExtension(KHRMaterialsAnisotropy);\n *\n * // Create an Anisotropy property.\n * const anisotropy = anisotropyExtension.createAnisotropy()\n * \t.setAnisotropyStrength(1.0)\n * \t.setAnisotropyRotation(Math.PI / 4);\n *\n * // Attach the property to a Material.\n * material.setExtension('KHR_materials_anisotropy', anisotropy);\n * ```\n */\nclass KHRMaterialsAnisotropy extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_MATERIALS_ANISOTROPY;\n    this.prereadTypes = [PropertyType.MESH];\n    this.prewriteTypes = [PropertyType.MESH];\n  }\n  /** Creates a new Anisotropy property for use on a {@link Material}. */\n  createAnisotropy() {\n    return new Anisotropy(this.document.getGraph());\n  }\n  /** @hidden */\n  read(_context) {\n    return this;\n  }\n  /** @hidden */\n  write(_context) {\n    return this;\n  }\n  /** @hidden */\n  preread(context) {\n    const jsonDoc = context.jsonDoc;\n    const materialDefs = jsonDoc.json.materials || [];\n    const textureDefs = jsonDoc.json.textures || [];\n    materialDefs.forEach((materialDef, materialIndex) => {\n      if (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_ANISOTROPY]) {\n        const anisotropy = this.createAnisotropy();\n        context.materials[materialIndex].setExtension(KHR_MATERIALS_ANISOTROPY, anisotropy);\n        const anisotropyDef = materialDef.extensions[KHR_MATERIALS_ANISOTROPY];\n        // Factors.\n        if (anisotropyDef.anisotropyStrength !== undefined) {\n          anisotropy.setAnisotropyStrength(anisotropyDef.anisotropyStrength);\n        }\n        if (anisotropyDef.anisotropyRotation !== undefined) {\n          anisotropy.setAnisotropyRotation(anisotropyDef.anisotropyRotation);\n        }\n        // Textures.\n        if (anisotropyDef.anisotropyTexture !== undefined) {\n          const textureInfoDef = anisotropyDef.anisotropyTexture;\n          const texture = context.textures[textureDefs[textureInfoDef.index].source];\n          anisotropy.setAnisotropyTexture(texture);\n          context.setTextureInfo(anisotropy.getAnisotropyTextureInfo(), textureInfoDef);\n        }\n      }\n    });\n    return this;\n  }\n  /** @hidden */\n  prewrite(context) {\n    const jsonDoc = context.jsonDoc;\n    this.document.getRoot().listMaterials().forEach(material => {\n      const anisotropy = material.getExtension(KHR_MATERIALS_ANISOTROPY);\n      if (anisotropy) {\n        const materialIndex = context.materialIndexMap.get(material);\n        const materialDef = jsonDoc.json.materials[materialIndex];\n        materialDef.extensions = materialDef.extensions || {};\n        // Factors.\n        const anisotropyDef = materialDef.extensions[KHR_MATERIALS_ANISOTROPY] = {};\n        if (anisotropy.getAnisotropyStrength() > 0) {\n          anisotropyDef.anisotropyStrength = anisotropy.getAnisotropyStrength();\n        }\n        if (anisotropy.getAnisotropyRotation() !== 0) {\n          anisotropyDef.anisotropyRotation = anisotropy.getAnisotropyRotation();\n        }\n        // Textures.\n        if (anisotropy.getAnisotropyTexture()) {\n          const texture = anisotropy.getAnisotropyTexture();\n          const textureInfo = anisotropy.getAnisotropyTextureInfo();\n          anisotropyDef.anisotropyTexture = context.createTextureInfoDef(texture, textureInfo);\n        }\n      }\n    });\n    return this;\n  }\n}\nKHRMaterialsAnisotropy.EXTENSION_NAME = KHR_MATERIALS_ANISOTROPY;\n\nconst {\n  R: R$6,\n  G: G$6,\n  B: B$4\n} = TextureChannel;\n/**\n * Defines clear coat for a PBR material. See {@link KHRMaterialsClearcoat}.\n */\nclass Clearcoat extends ExtensionProperty {\n  init() {\n    this.extensionName = KHR_MATERIALS_CLEARCOAT;\n    this.propertyType = 'Clearcoat';\n    this.parentTypes = [PropertyType.MATERIAL];\n  }\n  getDefaults() {\n    return Object.assign(super.getDefaults(), {\n      clearcoatFactor: 0,\n      clearcoatTexture: null,\n      clearcoatTextureInfo: new TextureInfo(this.graph, 'clearcoatTextureInfo'),\n      clearcoatRoughnessFactor: 0,\n      clearcoatRoughnessTexture: null,\n      clearcoatRoughnessTextureInfo: new TextureInfo(this.graph, 'clearcoatRoughnessTextureInfo'),\n      clearcoatNormalScale: 1,\n      clearcoatNormalTexture: null,\n      clearcoatNormalTextureInfo: new TextureInfo(this.graph, 'clearcoatNormalTextureInfo')\n    });\n  }\n  /**********************************************************************************************\n   * Clearcoat.\n   */\n  /** Clearcoat; linear multiplier. See {@link Clearcoat.getClearcoatTexture getClearcoatTexture}. */\n  getClearcoatFactor() {\n    return this.get('clearcoatFactor');\n  }\n  /** Clearcoat; linear multiplier. See {@link Clearcoat.getClearcoatTexture getClearcoatTexture}. */\n  setClearcoatFactor(factor) {\n    return this.set('clearcoatFactor', factor);\n  }\n  /**\n   * Clearcoat texture; linear multiplier. The `r` channel of this texture specifies an amount\n   * [0-1] of coating over the surface of the material, which may have its own roughness and\n   * normal map properties.\n   */\n  getClearcoatTexture() {\n    return this.getRef('clearcoatTexture');\n  }\n  /**\n   * Settings affecting the material's use of its clearcoat texture. If no texture is attached,\n   * {@link TextureInfo} is `null`.\n   */\n  getClearcoatTextureInfo() {\n    return this.getRef('clearcoatTexture') ? this.getRef('clearcoatTextureInfo') : null;\n  }\n  /** Sets clearcoat texture. See {@link Clearcoat.getClearcoatTexture getClearcoatTexture}. */\n  setClearcoatTexture(texture) {\n    return this.setRef('clearcoatTexture', texture, {\n      channels: R$6\n    });\n  }\n  /**********************************************************************************************\n   * Clearcoat roughness.\n   */\n  /**\n   * Clearcoat roughness; linear multiplier.\n   * See {@link Clearcoat.getClearcoatRoughnessTexture getClearcoatRoughnessTexture}.\n   */\n  getClearcoatRoughnessFactor() {\n    return this.get('clearcoatRoughnessFactor');\n  }\n  /**\n   * Clearcoat roughness; linear multiplier.\n   * See {@link Clearcoat.getClearcoatRoughnessTexture getClearcoatRoughnessTexture}.\n   */\n  setClearcoatRoughnessFactor(factor) {\n    return this.set('clearcoatRoughnessFactor', factor);\n  }\n  /**\n   * Clearcoat roughness texture; linear multiplier. The `g` channel of this texture specifies\n   * roughness, independent of the base layer's roughness.\n   */\n  getClearcoatRoughnessTexture() {\n    return this.getRef('clearcoatRoughnessTexture');\n  }\n  /**\n   * Settings affecting the material's use of its clearcoat roughness texture. If no texture is\n   * attached, {@link TextureInfo} is `null`.\n   */\n  getClearcoatRoughnessTextureInfo() {\n    return this.getRef('clearcoatRoughnessTexture') ? this.getRef('clearcoatRoughnessTextureInfo') : null;\n  }\n  /**\n   * Sets clearcoat roughness texture.\n   * See {@link Clearcoat.getClearcoatRoughnessTexture getClearcoatRoughnessTexture}.\n   */\n  setClearcoatRoughnessTexture(texture) {\n    return this.setRef('clearcoatRoughnessTexture', texture, {\n      channels: G$6\n    });\n  }\n  /**********************************************************************************************\n   * Clearcoat normals.\n   */\n  /** Clearcoat normal scale. See {@link Clearcoat.getClearcoatNormalTexture getClearcoatNormalTexture}. */\n  getClearcoatNormalScale() {\n    return this.get('clearcoatNormalScale');\n  }\n  /** Clearcoat normal scale. See {@link Clearcoat.getClearcoatNormalTexture getClearcoatNormalTexture}. */\n  setClearcoatNormalScale(scale) {\n    return this.set('clearcoatNormalScale', scale);\n  }\n  /**\n   * Clearcoat normal map. Independent of the material base layer normal map.\n   */\n  getClearcoatNormalTexture() {\n    return this.getRef('clearcoatNormalTexture');\n  }\n  /**\n   * Settings affecting the material's use of its clearcoat normal texture. If no texture is\n   * attached, {@link TextureInfo} is `null`.\n   */\n  getClearcoatNormalTextureInfo() {\n    return this.getRef('clearcoatNormalTexture') ? this.getRef('clearcoatNormalTextureInfo') : null;\n  }\n  /** Sets clearcoat normal texture. See {@link Clearcoat.getClearcoatNormalTexture getClearcoatNormalTexture}. */\n  setClearcoatNormalTexture(texture) {\n    return this.setRef('clearcoatNormalTexture', texture, {\n      channels: R$6 | G$6 | B$4\n    });\n  }\n}\nClearcoat.EXTENSION_NAME = KHR_MATERIALS_CLEARCOAT;\n\n/**\n * [KHR_materials_clearcoat](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_clearcoat/)\n * defines a clear coating on a glTF PBR material.\n *\n * ![Illustration](/media/extensions/khr-materials-clearcoat.png)\n *\n * > _**Figure:** Comparison of a carbon-fiber material without clearcoat (left) and with clearcoat\n * > (right). Source: [Filament](https://google.github.io/filament/Materials.html)._\n *\n * A clear coat is a common technique used in Physically-Based\n * Rendering for a protective layer applied to a base material.\n * Commonly used to represent car paint, carbon fiber, or thin lacquers.\n *\n * Properties:\n * - {@link Clearcoat}\n *\n * ### Example\n *\n * ```typescript\n * import { KHRMaterialsClearcoat, Clearcoat } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const clearcoatExtension = document.createExtension(KHRMaterialsClearcoat);\n *\n * // Create Clearcoat property.\n * const clearcoat = clearcoatExtension.createClearcoat()\n *\t.setClearcoatFactor(1.0);\n *\n * // Assign to a Material.\n * material.setExtension('KHR_materials_clearcoat', clearcoat);\n * ```\n */\nclass KHRMaterialsClearcoat extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_MATERIALS_CLEARCOAT;\n    this.prereadTypes = [PropertyType.MESH];\n    this.prewriteTypes = [PropertyType.MESH];\n  }\n  /** Creates a new Clearcoat property for use on a {@link Material}. */\n  createClearcoat() {\n    return new Clearcoat(this.document.getGraph());\n  }\n  /** @hidden */\n  read(_context) {\n    return this;\n  }\n  /** @hidden */\n  write(_context) {\n    return this;\n  }\n  /** @hidden */\n  preread(context) {\n    const jsonDoc = context.jsonDoc;\n    const materialDefs = jsonDoc.json.materials || [];\n    const textureDefs = jsonDoc.json.textures || [];\n    materialDefs.forEach((materialDef, materialIndex) => {\n      if (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_CLEARCOAT]) {\n        const clearcoat = this.createClearcoat();\n        context.materials[materialIndex].setExtension(KHR_MATERIALS_CLEARCOAT, clearcoat);\n        const clearcoatDef = materialDef.extensions[KHR_MATERIALS_CLEARCOAT];\n        // Factors.\n        if (clearcoatDef.clearcoatFactor !== undefined) {\n          clearcoat.setClearcoatFactor(clearcoatDef.clearcoatFactor);\n        }\n        if (clearcoatDef.clearcoatRoughnessFactor !== undefined) {\n          clearcoat.setClearcoatRoughnessFactor(clearcoatDef.clearcoatRoughnessFactor);\n        }\n        // Textures.\n        if (clearcoatDef.clearcoatTexture !== undefined) {\n          const textureInfoDef = clearcoatDef.clearcoatTexture;\n          const texture = context.textures[textureDefs[textureInfoDef.index].source];\n          clearcoat.setClearcoatTexture(texture);\n          context.setTextureInfo(clearcoat.getClearcoatTextureInfo(), textureInfoDef);\n        }\n        if (clearcoatDef.clearcoatRoughnessTexture !== undefined) {\n          const textureInfoDef = clearcoatDef.clearcoatRoughnessTexture;\n          const texture = context.textures[textureDefs[textureInfoDef.index].source];\n          clearcoat.setClearcoatRoughnessTexture(texture);\n          context.setTextureInfo(clearcoat.getClearcoatRoughnessTextureInfo(), textureInfoDef);\n        }\n        if (clearcoatDef.clearcoatNormalTexture !== undefined) {\n          const textureInfoDef = clearcoatDef.clearcoatNormalTexture;\n          const texture = context.textures[textureDefs[textureInfoDef.index].source];\n          clearcoat.setClearcoatNormalTexture(texture);\n          context.setTextureInfo(clearcoat.getClearcoatNormalTextureInfo(), textureInfoDef);\n          if (textureInfoDef.scale !== undefined) {\n            clearcoat.setClearcoatNormalScale(textureInfoDef.scale);\n          }\n        }\n      }\n    });\n    return this;\n  }\n  /** @hidden */\n  prewrite(context) {\n    const jsonDoc = context.jsonDoc;\n    this.document.getRoot().listMaterials().forEach(material => {\n      const clearcoat = material.getExtension(KHR_MATERIALS_CLEARCOAT);\n      if (clearcoat) {\n        const materialIndex = context.materialIndexMap.get(material);\n        const materialDef = jsonDoc.json.materials[materialIndex];\n        materialDef.extensions = materialDef.extensions || {};\n        // Factors.\n        const clearcoatDef = materialDef.extensions[KHR_MATERIALS_CLEARCOAT] = {\n          clearcoatFactor: clearcoat.getClearcoatFactor(),\n          clearcoatRoughnessFactor: clearcoat.getClearcoatRoughnessFactor()\n        };\n        // Textures.\n        if (clearcoat.getClearcoatTexture()) {\n          const texture = clearcoat.getClearcoatTexture();\n          const textureInfo = clearcoat.getClearcoatTextureInfo();\n          clearcoatDef.clearcoatTexture = context.createTextureInfoDef(texture, textureInfo);\n        }\n        if (clearcoat.getClearcoatRoughnessTexture()) {\n          const texture = clearcoat.getClearcoatRoughnessTexture();\n          const textureInfo = clearcoat.getClearcoatRoughnessTextureInfo();\n          clearcoatDef.clearcoatRoughnessTexture = context.createTextureInfoDef(texture, textureInfo);\n        }\n        if (clearcoat.getClearcoatNormalTexture()) {\n          const texture = clearcoat.getClearcoatNormalTexture();\n          const textureInfo = clearcoat.getClearcoatNormalTextureInfo();\n          clearcoatDef.clearcoatNormalTexture = context.createTextureInfoDef(texture, textureInfo);\n          if (clearcoat.getClearcoatNormalScale() !== 1) {\n            clearcoatDef.clearcoatNormalTexture.scale = clearcoat.getClearcoatNormalScale();\n          }\n        }\n      }\n    });\n    return this;\n  }\n}\nKHRMaterialsClearcoat.EXTENSION_NAME = KHR_MATERIALS_CLEARCOAT;\n\nconst {\n  R: R$5,\n  G: G$5,\n  B: B$3,\n  A: A$3\n} = TextureChannel;\n/**\n * Defines diffuse transmission on a PBR {@link Material}. See {@link KHRMaterialsDiffuseTransmission}.\n *\n * @experimental KHR_materials_diffuse_transmission is not yet ratified by the Khronos Group.\n */\nclass DiffuseTransmission extends ExtensionProperty {\n  init() {\n    this.extensionName = KHR_MATERIALS_DIFFUSE_TRANSMISSION;\n    this.propertyType = 'DiffuseTransmission';\n    this.parentTypes = [PropertyType.MATERIAL];\n  }\n  getDefaults() {\n    return Object.assign(super.getDefaults(), {\n      diffuseTransmissionFactor: 0.0,\n      diffuseTransmissionTexture: null,\n      diffuseTransmissionTextureInfo: new TextureInfo(this.graph, 'diffuseTransmissionTextureInfo'),\n      diffuseTransmissionColorFactor: [1.0, 1.0, 1.0],\n      diffuseTransmissionColorTexture: null,\n      diffuseTransmissionColorTextureInfo: new TextureInfo(this.graph, 'diffuseTransmissionColorTextureInfo')\n    });\n  }\n  /**********************************************************************************************\n   * Diffuse transmission.\n   */\n  /**\n   * Percentage of reflected, non-specularly reflected light that is transmitted through the\n   * surface via the Lambertian diffuse transmission, i.e., the strength of the diffuse\n   * transmission effect.\n   */\n  getDiffuseTransmissionFactor() {\n    return this.get('diffuseTransmissionFactor');\n  }\n  /**\n   * Percentage of reflected, non-specularly reflected light that is transmitted through the\n   * surface via the Lambertian diffuse transmission, i.e., the strength of the diffuse\n   * transmission effect.\n   */\n  setDiffuseTransmissionFactor(factor) {\n    return this.set('diffuseTransmissionFactor', factor);\n  }\n  /**\n   * Texture that defines the strength of the diffuse transmission effect, stored in the alpha (A)\n   * channel. Will be multiplied by the diffuseTransmissionFactor.\n   */\n  getDiffuseTransmissionTexture() {\n    return this.getRef('diffuseTransmissionTexture');\n  }\n  /**\n   * Settings affecting the material's use of its diffuse transmission texture. If no texture is attached,\n   * {@link TextureInfo} is `null`.\n   */\n  getDiffuseTransmissionTextureInfo() {\n    return this.getRef('diffuseTransmissionTexture') ? this.getRef('diffuseTransmissionTextureInfo') : null;\n  }\n  /**\n   * Texture that defines the strength of the diffuse transmission effect, stored in the alpha (A)\n   * channel. Will be multiplied by the diffuseTransmissionFactor.\n   */\n  setDiffuseTransmissionTexture(texture) {\n    return this.setRef('diffuseTransmissionTexture', texture, {\n      channels: A$3\n    });\n  }\n  /**********************************************************************************************\n   * Diffuse transmission color.\n   */\n  /** Color of the transmitted light; Linear-sRGB components. */\n  getDiffuseTransmissionColorFactor() {\n    return this.get('diffuseTransmissionColorFactor');\n  }\n  /** Color of the transmitted light; Linear-sRGB components. */\n  setDiffuseTransmissionColorFactor(factor) {\n    return this.set('diffuseTransmissionColorFactor', factor);\n  }\n  /**\n   * Texture that defines the color of the transmitted light, stored in the RGB channels and\n   * encoded in sRGB. This texture will be multiplied by diffuseTransmissionColorFactor.\n   */\n  getDiffuseTransmissionColorTexture() {\n    return this.getRef('diffuseTransmissionColorTexture');\n  }\n  /**\n   * Settings affecting the material's use of its diffuse transmission color texture. If no\n   * texture is attached, {@link TextureInfo} is `null`.\n   */\n  getDiffuseTransmissionColorTextureInfo() {\n    return this.getRef('diffuseTransmissionColorTexture') ? this.getRef('diffuseTransmissionColorTextureInfo') : null;\n  }\n  /**\n   * Texture that defines the color of the transmitted light, stored in the RGB channels and\n   * encoded in sRGB. This texture will be multiplied by diffuseTransmissionColorFactor.\n   */\n  setDiffuseTransmissionColorTexture(texture) {\n    return this.setRef('diffuseTransmissionColorTexture', texture, {\n      channels: R$5 | G$5 | B$3\n    });\n  }\n}\nDiffuseTransmission.EXTENSION_NAME = KHR_MATERIALS_DIFFUSE_TRANSMISSION;\n\n/**\n * [KHR_materials_diffuse_transmission](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_diffuse_transmission/)\n * defines diffuse transmission on a glTF PBR material.\n *\n * ![Illustration](/media/extensions/khr-materials-diffuse-transmission.png)\n *\n * > _**Figure:** Sphere using `KHR_materials_diffuse_transmission` with varying roughness (0.0, 0.2, 0.4).\n * > Source: Khronos Group._\n *\n * Adds a Lambertian diffuse transmission BSDF to the metallic-roughness\n * material. Thin, dielectric objects like leaves or paper diffusely transmit\n * incoming light to the opposite side of the surface. For optically thick\n * media (volumes) with short scattering distances and therefore dense\n * scattering behavior, a diffuse transmission lobe is a phenomenological\n * plausible and cheap approximation.\n *\n * Properties:\n * - {@link DiffuseTransmission}\n *\n * ### Example\n *\n * ```typescript\n * import { KHRMaterialsDiffuseTransmission, DiffuseTransmission } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const diffuseTransmissionExtension = document.createExtension(KHRMaterialsDiffuseTransmission);\n *\n * // Create DiffuseTransmission property.\n * const diffuseTransmission = diffuseTransmission.createDiffuseTransmission()\n *\t.setDiffuseTransmissionFactor(1.0);\n *\n * // Assign to a Material.\n * material.setExtension('KHR_materials_diffuse_transmission', diffuseTransmission);\n * ```\n *\n * @experimental KHR_materials_diffuse_transmission is not yet ratified by the Khronos Group.\n */\nclass KHRMaterialsDiffuseTransmission extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_MATERIALS_DIFFUSE_TRANSMISSION;\n  }\n  /** Creates a new DiffuseTransmission property for use on a {@link Material}. */\n  createDiffuseTransmission() {\n    return new DiffuseTransmission(this.document.getGraph());\n  }\n  /** @hidden */\n  read(context) {\n    const jsonDoc = context.jsonDoc;\n    const materialDefs = jsonDoc.json.materials || [];\n    const textureDefs = jsonDoc.json.textures || [];\n    materialDefs.forEach((materialDef, materialIndex) => {\n      if (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_DIFFUSE_TRANSMISSION]) {\n        const transmission = this.createDiffuseTransmission();\n        context.materials[materialIndex].setExtension(KHR_MATERIALS_DIFFUSE_TRANSMISSION, transmission);\n        const transmissionDef = materialDef.extensions[KHR_MATERIALS_DIFFUSE_TRANSMISSION];\n        // Factors.\n        if (transmissionDef.diffuseTransmissionFactor !== undefined) {\n          transmission.setDiffuseTransmissionFactor(transmissionDef.diffuseTransmissionFactor);\n        }\n        if (transmissionDef.diffuseTransmissionColorFactor !== undefined) {\n          transmission.setDiffuseTransmissionColorFactor(transmissionDef.diffuseTransmissionColorFactor);\n        }\n        // Textures.\n        if (transmissionDef.diffuseTransmissionTexture !== undefined) {\n          const textureInfoDef = transmissionDef.diffuseTransmissionTexture;\n          const texture = context.textures[textureDefs[textureInfoDef.index].source];\n          transmission.setDiffuseTransmissionTexture(texture);\n          context.setTextureInfo(transmission.getDiffuseTransmissionTextureInfo(), textureInfoDef);\n        }\n        if (transmissionDef.diffuseTransmissionColorTexture !== undefined) {\n          const textureInfoDef = transmissionDef.diffuseTransmissionColorTexture;\n          const texture = context.textures[textureDefs[textureInfoDef.index].source];\n          transmission.setDiffuseTransmissionColorTexture(texture);\n          context.setTextureInfo(transmission.getDiffuseTransmissionColorTextureInfo(), textureInfoDef);\n        }\n      }\n    });\n    return this;\n  }\n  /** @hidden */\n  write(context) {\n    const jsonDoc = context.jsonDoc;\n    for (const material of this.document.getRoot().listMaterials()) {\n      const transmission = material.getExtension(KHR_MATERIALS_DIFFUSE_TRANSMISSION);\n      if (!transmission) continue;\n      const materialIndex = context.materialIndexMap.get(material);\n      const materialDef = jsonDoc.json.materials[materialIndex];\n      materialDef.extensions = materialDef.extensions || {};\n      // Factors.\n      const transmissionDef = materialDef.extensions[KHR_MATERIALS_DIFFUSE_TRANSMISSION] = {\n        diffuseTransmissionFactor: transmission.getDiffuseTransmissionFactor(),\n        diffuseTransmissionColorFactor: transmission.getDiffuseTransmissionColorFactor()\n      };\n      // Textures.\n      if (transmission.getDiffuseTransmissionTexture()) {\n        const texture = transmission.getDiffuseTransmissionTexture();\n        const textureInfo = transmission.getDiffuseTransmissionTextureInfo();\n        transmissionDef.diffuseTransmissionTexture = context.createTextureInfoDef(texture, textureInfo);\n      }\n      if (transmission.getDiffuseTransmissionColorTexture()) {\n        const texture = transmission.getDiffuseTransmissionColorTexture();\n        const textureInfo = transmission.getDiffuseTransmissionColorTextureInfo();\n        transmissionDef.diffuseTransmissionColorTexture = context.createTextureInfoDef(texture, textureInfo);\n      }\n    }\n    return this;\n  }\n}\nKHRMaterialsDiffuseTransmission.EXTENSION_NAME = KHR_MATERIALS_DIFFUSE_TRANSMISSION;\n\n/**\n * Defines dispersion for a PBR {@link Material}. See {@link KHRMaterialsDispersion}.\n */\nclass Dispersion extends ExtensionProperty {\n  init() {\n    this.extensionName = KHR_MATERIALS_DISPERSION;\n    this.propertyType = 'Dispersion';\n    this.parentTypes = [PropertyType.MATERIAL];\n  }\n  getDefaults() {\n    return Object.assign(super.getDefaults(), {\n      dispersion: 0\n    });\n  }\n  /**********************************************************************************************\n   * Dispersion.\n   */\n  /** Dispersion. */\n  getDispersion() {\n    return this.get('dispersion');\n  }\n  /** Dispersion. */\n  setDispersion(dispersion) {\n    return this.set('dispersion', dispersion);\n  }\n}\nDispersion.EXTENSION_NAME = KHR_MATERIALS_DISPERSION;\n\n/**\n * [KHR_materials_dispersion](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_dispersion/)\n * defines dispersion on a glTF PBR material.\n *\n * ![illustration](/media/extensions/khr-materials-dispersion.jpg)\n *\n * > _**Figure:** Prisms demonstrating volumetric refraction and dispersion, for varying\n * > values of dispersion and IOR. Source: Khronos Group, rendered in Adobe Stager._\n *\n * Dispersion enables configuring the strength of the angular separation of colors (chromatic\n * aberration) transmitting through a relatively clear volume.  It is an enhancement to the\n * default `KHR_materials_volume` transmission model which assumes no dispersion.\n *\n * Properties:\n * - {@link Dispersion}\n *\n * ### Example\n *\n * ```typescript\n * import { KHRMaterialsDispersion, Dispersion } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const dispersionExtension = document.createExtension(KHRMaterialsDispersion);\n *\n * // Create Dispersion property.\n * const dispersion = dispersionExtension.createDispersion().setDispersion(1.0);\n *\n * // Assign to a Material.\n * material.setExtension('KHR_materials_dispersion', dispersion);\n * ```\n */\nclass KHRMaterialsDispersion extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_MATERIALS_DISPERSION;\n    this.prereadTypes = [PropertyType.MESH];\n    this.prewriteTypes = [PropertyType.MESH];\n  }\n  /** Creates a new Dispersion property for use on a {@link Material}. */\n  createDispersion() {\n    return new Dispersion(this.document.getGraph());\n  }\n  /** @hidden */\n  read(_context) {\n    return this;\n  }\n  /** @hidden */\n  write(_context) {\n    return this;\n  }\n  /** @hidden */\n  preread(context) {\n    const jsonDoc = context.jsonDoc;\n    const materialDefs = jsonDoc.json.materials || [];\n    materialDefs.forEach((materialDef, materialIndex) => {\n      if (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_DISPERSION]) {\n        const dispersion = this.createDispersion();\n        context.materials[materialIndex].setExtension(KHR_MATERIALS_DISPERSION, dispersion);\n        const dispersionDef = materialDef.extensions[KHR_MATERIALS_DISPERSION];\n        // Factors.\n        if (dispersionDef.dispersion !== undefined) {\n          dispersion.setDispersion(dispersionDef.dispersion);\n        }\n      }\n    });\n    return this;\n  }\n  /** @hidden */\n  prewrite(context) {\n    const jsonDoc = context.jsonDoc;\n    this.document.getRoot().listMaterials().forEach(material => {\n      const dispersion = material.getExtension(KHR_MATERIALS_DISPERSION);\n      if (dispersion) {\n        const materialIndex = context.materialIndexMap.get(material);\n        const materialDef = jsonDoc.json.materials[materialIndex];\n        materialDef.extensions = materialDef.extensions || {};\n        // Factors.\n        materialDef.extensions[KHR_MATERIALS_DISPERSION] = {\n          dispersion: dispersion.getDispersion()\n        };\n      }\n    });\n    return this;\n  }\n}\nKHRMaterialsDispersion.EXTENSION_NAME = KHR_MATERIALS_DISPERSION;\n\n/**\n * Defines emissive strength for a PBR {@link Material}, allowing high-dynamic-range\n * (HDR) emissive materials. See {@link KHRMaterialsEmissiveStrength}.\n */\nclass EmissiveStrength extends ExtensionProperty {\n  init() {\n    this.extensionName = KHR_MATERIALS_EMISSIVE_STRENGTH;\n    this.propertyType = 'EmissiveStrength';\n    this.parentTypes = [PropertyType.MATERIAL];\n  }\n  getDefaults() {\n    return Object.assign(super.getDefaults(), {\n      emissiveStrength: 1.0\n    });\n  }\n  /**********************************************************************************************\n   * EmissiveStrength.\n   */\n  /** EmissiveStrength. */\n  getEmissiveStrength() {\n    return this.get('emissiveStrength');\n  }\n  /** EmissiveStrength. */\n  setEmissiveStrength(strength) {\n    return this.set('emissiveStrength', strength);\n  }\n}\nEmissiveStrength.EXTENSION_NAME = KHR_MATERIALS_EMISSIVE_STRENGTH;\n\n/**\n * [KHR_materials_emissive_strength](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_emissive_strength/)\n * defines emissive strength and enables high-dynamic-range (HDR) emissive materials.\n *\n * ![Illustration](/media/extensions/khr-materials-emissive-strength.jpg)\n *\n * > _**Figure:** Cubes with emissive color #59BCF3 and emissive strength\n * > increasing from 1 to 256 nits, left to right. Rendered in [three.js](https://threejs.org/),\n * > with independent point lighting and a bloom effect.\n * > Source: [Don McCurdy](https://www.donmccurdy.com/2024/04/27/emission-and-bloom/)._\n *\n * The core glTF 2.0 material model includes {@link Material.setEmissiveFactor `emissiveFactor`}\n * and {@link Material.setEmissiveTexture `emissiveTexture`} to control the color and intensity\n * of the light being emitted by the material, clamped to the range [0.0, 1.0]. However, in\n * PBR environments with HDR reflections and lighting, stronger emission effects may be desirable.\n *\n * In this extension, a new {@link EmissiveStrength.setEmissiveStrength `emissiveStrength`} scalar\n * factor is supplied, which governs the upper limit of emissive strength per material and may be\n * given arbitrarily high values.\n *\n * For implementations where a physical light unit is needed, the units for the multiplicative\n * product of the emissive texture and factor are candela per square meter (cd / m2), sometimes\n * called _nits_. Many realtime rendering engines simplify this calculation by assuming that an\n * emissive factor of 1.0 results in a fully exposed pixel.\n *\n * Properties:\n * - {@link EmissiveStrength}\n *\n * ### Example\n *\n * ```typescript\n * import { KHRMaterialsEmissiveStrength, EmissiveStrength } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const emissiveStrengthExtension = document.createExtension(KHRMaterialsEmissiveStrength);\n *\n * // Create EmissiveStrength property.\n * const emissiveStrength = emissiveStrengthExtension\n * \t.createEmissiveStrength().setEmissiveStrength(5.0);\n *\n * // Assign to a Material.\n * material.setExtension('KHR_materials_emissive_strength', emissiveStrength);\n * ```\n */\nclass KHRMaterialsEmissiveStrength extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_MATERIALS_EMISSIVE_STRENGTH;\n    this.prereadTypes = [PropertyType.MESH];\n    this.prewriteTypes = [PropertyType.MESH];\n  }\n  /** Creates a new EmissiveStrength property for use on a {@link Material}. */\n  createEmissiveStrength() {\n    return new EmissiveStrength(this.document.getGraph());\n  }\n  /** @hidden */\n  read(_context) {\n    return this;\n  }\n  /** @hidden */\n  write(_context) {\n    return this;\n  }\n  /** @hidden */\n  preread(context) {\n    const jsonDoc = context.jsonDoc;\n    const materialDefs = jsonDoc.json.materials || [];\n    materialDefs.forEach((materialDef, materialIndex) => {\n      if (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_EMISSIVE_STRENGTH]) {\n        const emissiveStrength = this.createEmissiveStrength();\n        context.materials[materialIndex].setExtension(KHR_MATERIALS_EMISSIVE_STRENGTH, emissiveStrength);\n        const emissiveStrengthDef = materialDef.extensions[KHR_MATERIALS_EMISSIVE_STRENGTH];\n        // Factors.\n        if (emissiveStrengthDef.emissiveStrength !== undefined) {\n          emissiveStrength.setEmissiveStrength(emissiveStrengthDef.emissiveStrength);\n        }\n      }\n    });\n    return this;\n  }\n  /** @hidden */\n  prewrite(context) {\n    const jsonDoc = context.jsonDoc;\n    this.document.getRoot().listMaterials().forEach(material => {\n      const emissiveStrength = material.getExtension(KHR_MATERIALS_EMISSIVE_STRENGTH);\n      if (emissiveStrength) {\n        const materialIndex = context.materialIndexMap.get(material);\n        const materialDef = jsonDoc.json.materials[materialIndex];\n        materialDef.extensions = materialDef.extensions || {};\n        // Factors.\n        materialDef.extensions[KHR_MATERIALS_EMISSIVE_STRENGTH] = {\n          emissiveStrength: emissiveStrength.getEmissiveStrength()\n        };\n      }\n    });\n    return this;\n  }\n}\nKHRMaterialsEmissiveStrength.EXTENSION_NAME = KHR_MATERIALS_EMISSIVE_STRENGTH;\n\n/**\n * Defines index of refraction for a PBR {@link Material}. See {@link KHRMaterialsIOR}.\n */\nclass IOR extends ExtensionProperty {\n  init() {\n    this.extensionName = KHR_MATERIALS_IOR;\n    this.propertyType = 'IOR';\n    this.parentTypes = [PropertyType.MATERIAL];\n  }\n  getDefaults() {\n    return Object.assign(super.getDefaults(), {\n      ior: 1.5\n    });\n  }\n  /**********************************************************************************************\n   * IOR.\n   */\n  /** IOR. */\n  getIOR() {\n    return this.get('ior');\n  }\n  /** IOR. */\n  setIOR(ior) {\n    return this.set('ior', ior);\n  }\n}\nIOR.EXTENSION_NAME = KHR_MATERIALS_IOR;\n\n/**\n * [KHR_materials_ior](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_ior/)\n * defines index of refraction on a glTF PBR material.\n *\n * The dielectric BRDF of the metallic-roughness material in glTF uses a fixed value of 1.5 for the\n * index of refraction. This is a good fit for many plastics and glass, but not for other materials\n * like water or asphalt, sapphire or diamond. `KHR_materials_ior` allows users to set the index of\n * refraction to a certain value.\n *\n * Properties:\n * - {@link IOR}\n *\n * ### Example\n *\n * ```typescript\n * import { KHRMaterialsIOR, IOR } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const iorExtension = document.createExtension(KHRMaterialsIOR);\n *\n * // Create IOR property.\n * const ior = iorExtension.createIOR().setIOR(1.0);\n *\n * // Assign to a Material.\n * material.setExtension('KHR_materials_ior', ior);\n * ```\n */\nclass KHRMaterialsIOR extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_MATERIALS_IOR;\n    this.prereadTypes = [PropertyType.MESH];\n    this.prewriteTypes = [PropertyType.MESH];\n  }\n  /** Creates a new IOR property for use on a {@link Material}. */\n  createIOR() {\n    return new IOR(this.document.getGraph());\n  }\n  /** @hidden */\n  read(_context) {\n    return this;\n  }\n  /** @hidden */\n  write(_context) {\n    return this;\n  }\n  /** @hidden */\n  preread(context) {\n    const jsonDoc = context.jsonDoc;\n    const materialDefs = jsonDoc.json.materials || [];\n    materialDefs.forEach((materialDef, materialIndex) => {\n      if (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_IOR]) {\n        const ior = this.createIOR();\n        context.materials[materialIndex].setExtension(KHR_MATERIALS_IOR, ior);\n        const iorDef = materialDef.extensions[KHR_MATERIALS_IOR];\n        // Factors.\n        if (iorDef.ior !== undefined) {\n          ior.setIOR(iorDef.ior);\n        }\n      }\n    });\n    return this;\n  }\n  /** @hidden */\n  prewrite(context) {\n    const jsonDoc = context.jsonDoc;\n    this.document.getRoot().listMaterials().forEach(material => {\n      const ior = material.getExtension(KHR_MATERIALS_IOR);\n      if (ior) {\n        const materialIndex = context.materialIndexMap.get(material);\n        const materialDef = jsonDoc.json.materials[materialIndex];\n        materialDef.extensions = materialDef.extensions || {};\n        // Factors.\n        materialDef.extensions[KHR_MATERIALS_IOR] = {\n          ior: ior.getIOR()\n        };\n      }\n    });\n    return this;\n  }\n}\nKHRMaterialsIOR.EXTENSION_NAME = KHR_MATERIALS_IOR;\n\nconst {\n  R: R$4,\n  G: G$4\n} = TextureChannel;\n/**\n * Defines iridescence (thin film interference) on a PBR {@link Material}. See {@link KHRMaterialsIridescence}.\n */\nclass Iridescence extends ExtensionProperty {\n  init() {\n    this.extensionName = KHR_MATERIALS_IRIDESCENCE;\n    this.propertyType = 'Iridescence';\n    this.parentTypes = [PropertyType.MATERIAL];\n  }\n  getDefaults() {\n    return Object.assign(super.getDefaults(), {\n      iridescenceFactor: 0.0,\n      iridescenceTexture: null,\n      iridescenceTextureInfo: new TextureInfo(this.graph, 'iridescenceTextureInfo'),\n      iridescenceIOR: 1.3,\n      iridescenceThicknessMinimum: 100,\n      iridescenceThicknessMaximum: 400,\n      iridescenceThicknessTexture: null,\n      iridescenceThicknessTextureInfo: new TextureInfo(this.graph, 'iridescenceThicknessTextureInfo')\n    });\n  }\n  /**********************************************************************************************\n   * Iridescence.\n   */\n  /** Iridescence; linear multiplier. See {@link Iridescence.getIridescenceTexture getIridescenceTexture}. */\n  getIridescenceFactor() {\n    return this.get('iridescenceFactor');\n  }\n  /** Iridescence; linear multiplier. See {@link Iridescence.getIridescenceTexture getIridescenceTexture}. */\n  setIridescenceFactor(factor) {\n    return this.set('iridescenceFactor', factor);\n  }\n  /**\n   * Iridescence intensity.\n   *\n   * Only the red (R) channel is used for iridescence intensity, but this texture may optionally\n   * be packed with additional data in the other channels.\n   */\n  getIridescenceTexture() {\n    return this.getRef('iridescenceTexture');\n  }\n  /**\n   * Settings affecting the material's use of its iridescence texture. If no texture is attached,\n   * {@link TextureInfo} is `null`.\n   */\n  getIridescenceTextureInfo() {\n    return this.getRef('iridescenceTexture') ? this.getRef('iridescenceTextureInfo') : null;\n  }\n  /** Iridescence intensity. See {@link Iridescence.getIridescenceTexture getIridescenceTexture}. */\n  setIridescenceTexture(texture) {\n    return this.setRef('iridescenceTexture', texture, {\n      channels: R$4\n    });\n  }\n  /**********************************************************************************************\n   * Iridescence IOR.\n   */\n  /** Index of refraction of the dielectric thin-film layer. */\n  getIridescenceIOR() {\n    return this.get('iridescenceIOR');\n  }\n  /** Index of refraction of the dielectric thin-film layer. */\n  setIridescenceIOR(ior) {\n    return this.set('iridescenceIOR', ior);\n  }\n  /**********************************************************************************************\n   * Iridescence thickness.\n   */\n  /** Minimum thickness of the thin-film layer, in nanometers (nm). */\n  getIridescenceThicknessMinimum() {\n    return this.get('iridescenceThicknessMinimum');\n  }\n  /** Minimum thickness of the thin-film layer, in nanometers (nm). */\n  setIridescenceThicknessMinimum(thickness) {\n    return this.set('iridescenceThicknessMinimum', thickness);\n  }\n  /** Maximum thickness of the thin-film layer, in nanometers (nm). */\n  getIridescenceThicknessMaximum() {\n    return this.get('iridescenceThicknessMaximum');\n  }\n  /** Maximum thickness of the thin-film layer, in nanometers (nm). */\n  setIridescenceThicknessMaximum(thickness) {\n    return this.set('iridescenceThicknessMaximum', thickness);\n  }\n  /**\n   * The green channel of this texture defines the thickness of the\n   * thin-film layer by blending between the minimum and maximum thickness.\n   */\n  getIridescenceThicknessTexture() {\n    return this.getRef('iridescenceThicknessTexture');\n  }\n  /**\n   * Settings affecting the material's use of its iridescence thickness texture.\n   * If no texture is attached, {@link TextureInfo} is `null`.\n   */\n  getIridescenceThicknessTextureInfo() {\n    return this.getRef('iridescenceThicknessTexture') ? this.getRef('iridescenceThicknessTextureInfo') : null;\n  }\n  /**\n   * Sets iridescence thickness texture.\n   * See {@link Iridescence.getIridescenceThicknessTexture getIridescenceThicknessTexture}.\n   */\n  setIridescenceThicknessTexture(texture) {\n    return this.setRef('iridescenceThicknessTexture', texture, {\n      channels: G$4\n    });\n  }\n}\nIridescence.EXTENSION_NAME = KHR_MATERIALS_IRIDESCENCE;\n\n/**\n * [`KHR_materials_iridescence`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_iridescence/)\n * defines iridescence (thin film interference) on a PBR material.\n *\n * ![Illustration](/media/extensions/khr-materials-iridescence.png)\n *\n * > _**Figure:** Varying levels of iridescence IOR values.\n * > Source: [Khronos Group](https://github.com/KhronosGroup/gltf/tree/main/extensions/2.0/Khronos/KHR_materials_iridescence)._\n *\n * Iridescence describes an effect where hue varies depending on the viewing\n * angle and illumination angle: A thin-film of a semi-transparent layer\n * results in inter-reflections and due to thin-film interference, certain\n * wavelengths get absorbed or amplified. Iridescence can be seen on soap\n * bubbles, oil films, or on the wings of many insects. With this extension,\n * thickness and index of refraction (IOR) of the thin-film can be specified,\n * enabling iridescent materials.\n *\n * Properties:\n * - {@link Iridescence}\n *\n * ### Example\n *\n * The `KHRMaterialsIridescence` class provides a single {@link ExtensionProperty} type, `Iridescence`,\n * which may be attached to any {@link Material} instance. For example:\n *\n * ```typescript\n * import { KHRMaterialsIridescence, Iridescence } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const iridescenceExtension = document.createExtension(KHRMaterialsIridescence);\n *\n * // Create an Iridescence property.\n * const iridescence = iridescenceExtension.createIridescence()\n * \t.setIridescenceFactor(1.0)\n * \t.setIridescenceIOR(1.8);\n *\n * // Attach the property to a Material.\n * material.setExtension('KHR_materials_iridescence', iridescence);\n * ```\n */\nclass KHRMaterialsIridescence extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_MATERIALS_IRIDESCENCE;\n    this.prereadTypes = [PropertyType.MESH];\n    this.prewriteTypes = [PropertyType.MESH];\n  }\n  /** Creates a new Iridescence property for use on a {@link Material}. */\n  createIridescence() {\n    return new Iridescence(this.document.getGraph());\n  }\n  /** @hidden */\n  read(_context) {\n    return this;\n  }\n  /** @hidden */\n  write(_context) {\n    return this;\n  }\n  /** @hidden */\n  preread(context) {\n    const jsonDoc = context.jsonDoc;\n    const materialDefs = jsonDoc.json.materials || [];\n    const textureDefs = jsonDoc.json.textures || [];\n    materialDefs.forEach((materialDef, materialIndex) => {\n      if (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_IRIDESCENCE]) {\n        const iridescence = this.createIridescence();\n        context.materials[materialIndex].setExtension(KHR_MATERIALS_IRIDESCENCE, iridescence);\n        const iridescenceDef = materialDef.extensions[KHR_MATERIALS_IRIDESCENCE];\n        // Factors.\n        if (iridescenceDef.iridescenceFactor !== undefined) {\n          iridescence.setIridescenceFactor(iridescenceDef.iridescenceFactor);\n        }\n        if (iridescenceDef.iridescenceIor !== undefined) {\n          iridescence.setIridescenceIOR(iridescenceDef.iridescenceIor);\n        }\n        if (iridescenceDef.iridescenceThicknessMinimum !== undefined) {\n          iridescence.setIridescenceThicknessMinimum(iridescenceDef.iridescenceThicknessMinimum);\n        }\n        if (iridescenceDef.iridescenceThicknessMaximum !== undefined) {\n          iridescence.setIridescenceThicknessMaximum(iridescenceDef.iridescenceThicknessMaximum);\n        }\n        // Textures.\n        if (iridescenceDef.iridescenceTexture !== undefined) {\n          const textureInfoDef = iridescenceDef.iridescenceTexture;\n          const texture = context.textures[textureDefs[textureInfoDef.index].source];\n          iridescence.setIridescenceTexture(texture);\n          context.setTextureInfo(iridescence.getIridescenceTextureInfo(), textureInfoDef);\n        }\n        if (iridescenceDef.iridescenceThicknessTexture !== undefined) {\n          const textureInfoDef = iridescenceDef.iridescenceThicknessTexture;\n          const texture = context.textures[textureDefs[textureInfoDef.index].source];\n          iridescence.setIridescenceThicknessTexture(texture);\n          context.setTextureInfo(iridescence.getIridescenceThicknessTextureInfo(), textureInfoDef);\n        }\n      }\n    });\n    return this;\n  }\n  /** @hidden */\n  prewrite(context) {\n    const jsonDoc = context.jsonDoc;\n    this.document.getRoot().listMaterials().forEach(material => {\n      const iridescence = material.getExtension(KHR_MATERIALS_IRIDESCENCE);\n      if (iridescence) {\n        const materialIndex = context.materialIndexMap.get(material);\n        const materialDef = jsonDoc.json.materials[materialIndex];\n        materialDef.extensions = materialDef.extensions || {};\n        // Factors.\n        const iridescenceDef = materialDef.extensions[KHR_MATERIALS_IRIDESCENCE] = {};\n        if (iridescence.getIridescenceFactor() > 0) {\n          iridescenceDef.iridescenceFactor = iridescence.getIridescenceFactor();\n        }\n        if (iridescence.getIridescenceIOR() !== 1.3) {\n          iridescenceDef.iridescenceIor = iridescence.getIridescenceIOR();\n        }\n        if (iridescence.getIridescenceThicknessMinimum() !== 100) {\n          iridescenceDef.iridescenceThicknessMinimum = iridescence.getIridescenceThicknessMinimum();\n        }\n        if (iridescence.getIridescenceThicknessMaximum() !== 400) {\n          iridescenceDef.iridescenceThicknessMaximum = iridescence.getIridescenceThicknessMaximum();\n        }\n        // Textures.\n        if (iridescence.getIridescenceTexture()) {\n          const texture = iridescence.getIridescenceTexture();\n          const textureInfo = iridescence.getIridescenceTextureInfo();\n          iridescenceDef.iridescenceTexture = context.createTextureInfoDef(texture, textureInfo);\n        }\n        if (iridescence.getIridescenceThicknessTexture()) {\n          const texture = iridescence.getIridescenceThicknessTexture();\n          const textureInfo = iridescence.getIridescenceThicknessTextureInfo();\n          iridescenceDef.iridescenceThicknessTexture = context.createTextureInfoDef(texture, textureInfo);\n        }\n      }\n    });\n    return this;\n  }\n}\nKHRMaterialsIridescence.EXTENSION_NAME = KHR_MATERIALS_IRIDESCENCE;\n\nconst {\n  R: R$3,\n  G: G$3,\n  B: B$2,\n  A: A$2\n} = TextureChannel;\n/**\n * Converts a {@link Material} to a spec/gloss workflow. See {@link KHRMaterialsPBRSpecularGlossiness}.\n */\nclass PBRSpecularGlossiness extends ExtensionProperty {\n  init() {\n    this.extensionName = KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;\n    this.propertyType = 'PBRSpecularGlossiness';\n    this.parentTypes = [PropertyType.MATERIAL];\n  }\n  getDefaults() {\n    return Object.assign(super.getDefaults(), {\n      diffuseFactor: [1.0, 1.0, 1.0, 1.0],\n      diffuseTexture: null,\n      diffuseTextureInfo: new TextureInfo(this.graph, 'diffuseTextureInfo'),\n      specularFactor: [1.0, 1.0, 1.0],\n      glossinessFactor: 1.0,\n      specularGlossinessTexture: null,\n      specularGlossinessTextureInfo: new TextureInfo(this.graph, 'specularGlossinessTextureInfo')\n    });\n  }\n  /**********************************************************************************************\n   * Diffuse.\n   */\n  /** Diffuse; Linear-sRGB components. See {@link PBRSpecularGlossiness.getDiffuseTexture getDiffuseTexture}. */\n  getDiffuseFactor() {\n    return this.get('diffuseFactor');\n  }\n  /** Diffuse; Linear-sRGB components. See {@link PBRSpecularGlossiness.getDiffuseTexture getDiffuseTexture}. */\n  setDiffuseFactor(factor) {\n    return this.set('diffuseFactor', factor);\n  }\n  /**\n   * Diffuse texture; sRGB. Alternative to baseColorTexture, used within the\n   * spec/gloss PBR workflow.\n   */\n  getDiffuseTexture() {\n    return this.getRef('diffuseTexture');\n  }\n  /**\n   * Settings affecting the material's use of its diffuse texture. If no texture is attached,\n   * {@link TextureInfo} is `null`.\n   */\n  getDiffuseTextureInfo() {\n    return this.getRef('diffuseTexture') ? this.getRef('diffuseTextureInfo') : null;\n  }\n  /** Sets diffuse texture. See {@link PBRSpecularGlossiness.getDiffuseTexture getDiffuseTexture}. */\n  setDiffuseTexture(texture) {\n    return this.setRef('diffuseTexture', texture, {\n      channels: R$3 | G$3 | B$2 | A$2,\n      isColor: true\n    });\n  }\n  /**********************************************************************************************\n   * Specular.\n   */\n  /** Specular; linear multiplier. */\n  getSpecularFactor() {\n    return this.get('specularFactor');\n  }\n  /** Specular; linear multiplier. */\n  setSpecularFactor(factor) {\n    return this.set('specularFactor', factor);\n  }\n  /**********************************************************************************************\n   * Glossiness.\n   */\n  /** Glossiness; linear multiplier. */\n  getGlossinessFactor() {\n    return this.get('glossinessFactor');\n  }\n  /** Glossiness; linear multiplier. */\n  setGlossinessFactor(factor) {\n    return this.set('glossinessFactor', factor);\n  }\n  /**********************************************************************************************\n   * Specular/Glossiness.\n   */\n  /** Spec/gloss texture; linear multiplier. */\n  getSpecularGlossinessTexture() {\n    return this.getRef('specularGlossinessTexture');\n  }\n  /**\n   * Settings affecting the material's use of its spec/gloss texture. If no texture is attached,\n   * {@link TextureInfo} is `null`.\n   */\n  getSpecularGlossinessTextureInfo() {\n    return this.getRef('specularGlossinessTexture') ? this.getRef('specularGlossinessTextureInfo') : null;\n  }\n  /** Spec/gloss texture; linear multiplier. */\n  setSpecularGlossinessTexture(texture) {\n    return this.setRef('specularGlossinessTexture', texture, {\n      channels: R$3 | G$3 | B$2 | A$2\n    });\n  }\n}\nPBRSpecularGlossiness.EXTENSION_NAME = KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;\n\n/**\n * [`KHR_materials_pbrSpecularGlossiness`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_pbrSpecularGlossiness/)\n * converts a PBR material from the default metal/rough workflow to a spec/gloss workflow.\n *\n * > _**NOTICE:** The spec/gloss workflow does _not_ support other PBR extensions such as clearcoat,\n * > transmission, IOR, etc. For the complete PBR feature set and specular data, use the\n * > {@link KHRMaterialsSpecular} extension instead, which provides specular data within a metal/rough\n * > workflow._\n *\n * ![Illustration](/media/extensions/khr-material-pbr-specular-glossiness.png)\n *\n * > _**Figure:** Components of a PBR spec/gloss material. Source: Khronos Group._\n *\n * Properties:\n * - {@link PBRSpecularGlossiness}\n *\n * ### Example\n *\n * ```typescript\n * import { KHRMaterialsPBRSpecularGlossiness } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const specGlossExtension = document.createExtension(KHRMaterialsPBRSpecularGlossiness);\n *\n * // Create a PBRSpecularGlossiness property.\n * const specGloss = specGlossExtension.createPBRSpecularGlossiness()\n * \t.setSpecularFactor(1.0);\n *\n * // // Assign to a Material.\n * material.setExtension('KHR_materials_pbrSpecularGlossiness', specGloss);\n * ```\n */\nclass KHRMaterialsPBRSpecularGlossiness extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;\n    this.prereadTypes = [PropertyType.MESH];\n    this.prewriteTypes = [PropertyType.MESH];\n  }\n  /** Creates a new PBRSpecularGlossiness property for use on a {@link Material}. */\n  createPBRSpecularGlossiness() {\n    return new PBRSpecularGlossiness(this.document.getGraph());\n  }\n  /** @hidden */\n  read(_context) {\n    return this;\n  }\n  /** @hidden */\n  write(_context) {\n    return this;\n  }\n  /** @hidden */\n  preread(context) {\n    const jsonDoc = context.jsonDoc;\n    const materialDefs = jsonDoc.json.materials || [];\n    const textureDefs = jsonDoc.json.textures || [];\n    materialDefs.forEach((materialDef, materialIndex) => {\n      if (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]) {\n        const specGloss = this.createPBRSpecularGlossiness();\n        context.materials[materialIndex].setExtension(KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS, specGloss);\n        const specGlossDef = materialDef.extensions[KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];\n        // Factors.\n        if (specGlossDef.diffuseFactor !== undefined) {\n          specGloss.setDiffuseFactor(specGlossDef.diffuseFactor);\n        }\n        if (specGlossDef.specularFactor !== undefined) {\n          specGloss.setSpecularFactor(specGlossDef.specularFactor);\n        }\n        if (specGlossDef.glossinessFactor !== undefined) {\n          specGloss.setGlossinessFactor(specGlossDef.glossinessFactor);\n        }\n        // Textures.\n        if (specGlossDef.diffuseTexture !== undefined) {\n          const textureInfoDef = specGlossDef.diffuseTexture;\n          const texture = context.textures[textureDefs[textureInfoDef.index].source];\n          specGloss.setDiffuseTexture(texture);\n          context.setTextureInfo(specGloss.getDiffuseTextureInfo(), textureInfoDef);\n        }\n        if (specGlossDef.specularGlossinessTexture !== undefined) {\n          const textureInfoDef = specGlossDef.specularGlossinessTexture;\n          const texture = context.textures[textureDefs[textureInfoDef.index].source];\n          specGloss.setSpecularGlossinessTexture(texture);\n          context.setTextureInfo(specGloss.getSpecularGlossinessTextureInfo(), textureInfoDef);\n        }\n      }\n    });\n    return this;\n  }\n  /** @hidden */\n  prewrite(context) {\n    const jsonDoc = context.jsonDoc;\n    this.document.getRoot().listMaterials().forEach(material => {\n      const specGloss = material.getExtension(KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS);\n      if (specGloss) {\n        const materialIndex = context.materialIndexMap.get(material);\n        const materialDef = jsonDoc.json.materials[materialIndex];\n        materialDef.extensions = materialDef.extensions || {};\n        // Factors.\n        const specGlossDef = materialDef.extensions[KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS] = {\n          diffuseFactor: specGloss.getDiffuseFactor(),\n          specularFactor: specGloss.getSpecularFactor(),\n          glossinessFactor: specGloss.getGlossinessFactor()\n        };\n        // Textures.\n        if (specGloss.getDiffuseTexture()) {\n          const texture = specGloss.getDiffuseTexture();\n          const textureInfo = specGloss.getDiffuseTextureInfo();\n          specGlossDef.diffuseTexture = context.createTextureInfoDef(texture, textureInfo);\n        }\n        if (specGloss.getSpecularGlossinessTexture()) {\n          const texture = specGloss.getSpecularGlossinessTexture();\n          const textureInfo = specGloss.getSpecularGlossinessTextureInfo();\n          specGlossDef.specularGlossinessTexture = context.createTextureInfoDef(texture, textureInfo);\n        }\n      }\n    });\n    return this;\n  }\n}\nKHRMaterialsPBRSpecularGlossiness.EXTENSION_NAME = KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;\n\nconst {\n  R: R$2,\n  G: G$2,\n  B: B$1,\n  A: A$1\n} = TextureChannel;\n/**\n * Defines sheen on a PBR {@link Material}. See {@link KHRMaterialsSheen}.\n */\nclass Sheen extends ExtensionProperty {\n  init() {\n    this.extensionName = KHR_MATERIALS_SHEEN;\n    this.propertyType = 'Sheen';\n    this.parentTypes = [PropertyType.MATERIAL];\n  }\n  getDefaults() {\n    return Object.assign(super.getDefaults(), {\n      sheenColorFactor: [0.0, 0.0, 0.0],\n      sheenColorTexture: null,\n      sheenColorTextureInfo: new TextureInfo(this.graph, 'sheenColorTextureInfo'),\n      sheenRoughnessFactor: 0.0,\n      sheenRoughnessTexture: null,\n      sheenRoughnessTextureInfo: new TextureInfo(this.graph, 'sheenRoughnessTextureInfo')\n    });\n  }\n  /**********************************************************************************************\n   * Sheen color.\n   */\n  /** Sheen; linear multiplier. */\n  getSheenColorFactor() {\n    return this.get('sheenColorFactor');\n  }\n  /** Sheen; linear multiplier. */\n  setSheenColorFactor(factor) {\n    return this.set('sheenColorFactor', factor);\n  }\n  /**\n   * Sheen color texture, in sRGB colorspace.\n   */\n  getSheenColorTexture() {\n    return this.getRef('sheenColorTexture');\n  }\n  /**\n   * Settings affecting the material's use of its sheen color texture. If no texture is attached,\n   * {@link TextureInfo} is `null`.\n   */\n  getSheenColorTextureInfo() {\n    return this.getRef('sheenColorTexture') ? this.getRef('sheenColorTextureInfo') : null;\n  }\n  /** Sets sheen color texture. See {@link Sheen.getSheenColorTexture getSheenColorTexture}. */\n  setSheenColorTexture(texture) {\n    return this.setRef('sheenColorTexture', texture, {\n      channels: R$2 | G$2 | B$1,\n      isColor: true\n    });\n  }\n  /**********************************************************************************************\n   * Sheen roughness.\n   */\n  /** Sheen roughness; linear multiplier. See {@link Sheen.getSheenRoughnessTexture getSheenRoughnessTexture}. */\n  getSheenRoughnessFactor() {\n    return this.get('sheenRoughnessFactor');\n  }\n  /** Sheen roughness; linear multiplier. See {@link Sheen.getSheenRoughnessTexture getSheenRoughnessTexture}. */\n  setSheenRoughnessFactor(factor) {\n    return this.set('sheenRoughnessFactor', factor);\n  }\n  /**\n   * Sheen roughness texture; linear multiplier. The `a` channel of this texture specifies\n   * roughness, independent of the base layer's roughness.\n   */\n  getSheenRoughnessTexture() {\n    return this.getRef('sheenRoughnessTexture');\n  }\n  /**\n   * Settings affecting the material's use of its sheen roughness texture. If no texture is\n   * attached, {@link TextureInfo} is `null`.\n   */\n  getSheenRoughnessTextureInfo() {\n    return this.getRef('sheenRoughnessTexture') ? this.getRef('sheenRoughnessTextureInfo') : null;\n  }\n  /**\n   * Sets sheen roughness texture.  The `a` channel of this texture specifies\n   * roughness, independent of the base layer's roughness.\n   */\n  setSheenRoughnessTexture(texture) {\n    return this.setRef('sheenRoughnessTexture', texture, {\n      channels: A$1\n    });\n  }\n}\nSheen.EXTENSION_NAME = KHR_MATERIALS_SHEEN;\n\n/**\n * [`KHR_materials_sheen`](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_sheen/)\n * defines a velvet-like sheen layered on a glTF PBR material.\n *\n * ![Illustration](/media/extensions/khr-materials-sheen.png)\n *\n * > _**Figure:** A cushion, showing high material roughness and low sheen roughness. Soft\n * > highlights at edges of the material show backscattering from microfibers. Source: Khronos\n * > Group._\n *\n * A sheen layer is a common technique used in Physically-Based Rendering to represent\n * cloth and fabric materials.\n *\n * Properties:\n * - {@link Sheen}\n *\n * ### Example\n *\n * The `KHRMaterialsSheen` class provides a single {@link ExtensionProperty} type, `Sheen`,\n * which may be attached to any {@link Material} instance. For example:\n *\n * ```typescript\n * import { KHRMaterialsSheen, Sheen } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const sheenExtension = document.createExtension(KHRMaterialsSheen);\n *\n * // Create a Sheen property.\n * const sheen = sheenExtension.createSheen()\n * \t.setSheenColorFactor([1.0, 1.0, 1.0]);\n *\n * // Attach the property to a Material.\n * material.setExtension('KHR_materials_sheen', sheen);\n * ```\n */\nclass KHRMaterialsSheen extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_MATERIALS_SHEEN;\n    this.prereadTypes = [PropertyType.MESH];\n    this.prewriteTypes = [PropertyType.MESH];\n  }\n  /** Creates a new Sheen property for use on a {@link Material}. */\n  createSheen() {\n    return new Sheen(this.document.getGraph());\n  }\n  /** @hidden */\n  read(_context) {\n    return this;\n  }\n  /** @hidden */\n  write(_context) {\n    return this;\n  }\n  /** @hidden */\n  preread(context) {\n    const jsonDoc = context.jsonDoc;\n    const materialDefs = jsonDoc.json.materials || [];\n    const textureDefs = jsonDoc.json.textures || [];\n    materialDefs.forEach((materialDef, materialIndex) => {\n      if (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_SHEEN]) {\n        const sheen = this.createSheen();\n        context.materials[materialIndex].setExtension(KHR_MATERIALS_SHEEN, sheen);\n        const sheenDef = materialDef.extensions[KHR_MATERIALS_SHEEN];\n        // Factors.\n        if (sheenDef.sheenColorFactor !== undefined) {\n          sheen.setSheenColorFactor(sheenDef.sheenColorFactor);\n        }\n        if (sheenDef.sheenRoughnessFactor !== undefined) {\n          sheen.setSheenRoughnessFactor(sheenDef.sheenRoughnessFactor);\n        }\n        // Textures.\n        if (sheenDef.sheenColorTexture !== undefined) {\n          const textureInfoDef = sheenDef.sheenColorTexture;\n          const texture = context.textures[textureDefs[textureInfoDef.index].source];\n          sheen.setSheenColorTexture(texture);\n          context.setTextureInfo(sheen.getSheenColorTextureInfo(), textureInfoDef);\n        }\n        if (sheenDef.sheenRoughnessTexture !== undefined) {\n          const textureInfoDef = sheenDef.sheenRoughnessTexture;\n          const texture = context.textures[textureDefs[textureInfoDef.index].source];\n          sheen.setSheenRoughnessTexture(texture);\n          context.setTextureInfo(sheen.getSheenRoughnessTextureInfo(), textureInfoDef);\n        }\n      }\n    });\n    return this;\n  }\n  /** @hidden */\n  prewrite(context) {\n    const jsonDoc = context.jsonDoc;\n    this.document.getRoot().listMaterials().forEach(material => {\n      const sheen = material.getExtension(KHR_MATERIALS_SHEEN);\n      if (sheen) {\n        const materialIndex = context.materialIndexMap.get(material);\n        const materialDef = jsonDoc.json.materials[materialIndex];\n        materialDef.extensions = materialDef.extensions || {};\n        // Factors.\n        const sheenDef = materialDef.extensions[KHR_MATERIALS_SHEEN] = {\n          sheenColorFactor: sheen.getSheenColorFactor(),\n          sheenRoughnessFactor: sheen.getSheenRoughnessFactor()\n        };\n        // Textures.\n        if (sheen.getSheenColorTexture()) {\n          const texture = sheen.getSheenColorTexture();\n          const textureInfo = sheen.getSheenColorTextureInfo();\n          sheenDef.sheenColorTexture = context.createTextureInfoDef(texture, textureInfo);\n        }\n        if (sheen.getSheenRoughnessTexture()) {\n          const texture = sheen.getSheenRoughnessTexture();\n          const textureInfo = sheen.getSheenRoughnessTextureInfo();\n          sheenDef.sheenRoughnessTexture = context.createTextureInfoDef(texture, textureInfo);\n        }\n      }\n    });\n    return this;\n  }\n}\nKHRMaterialsSheen.EXTENSION_NAME = KHR_MATERIALS_SHEEN;\n\nconst {\n  R: R$1,\n  G: G$1,\n  B,\n  A\n} = TextureChannel;\n/**\n * Defines specular reflectivity on a PBR {@link Material}. See {@link KHRMaterialsSpecular}.\n */\nclass Specular extends ExtensionProperty {\n  init() {\n    this.extensionName = KHR_MATERIALS_SPECULAR;\n    this.propertyType = 'Specular';\n    this.parentTypes = [PropertyType.MATERIAL];\n  }\n  getDefaults() {\n    return Object.assign(super.getDefaults(), {\n      specularFactor: 1.0,\n      specularTexture: null,\n      specularTextureInfo: new TextureInfo(this.graph, 'specularTextureInfo'),\n      specularColorFactor: [1.0, 1.0, 1.0],\n      specularColorTexture: null,\n      specularColorTextureInfo: new TextureInfo(this.graph, 'specularColorTextureInfo')\n    });\n  }\n  /**********************************************************************************************\n   * Specular.\n   */\n  /** Specular; linear multiplier. See {@link Specular.getSpecularTexture getSpecularTexture}. */\n  getSpecularFactor() {\n    return this.get('specularFactor');\n  }\n  /** Specular; linear multiplier. See {@link Specular.getSpecularTexture getSpecularTexture}. */\n  setSpecularFactor(factor) {\n    return this.set('specularFactor', factor);\n  }\n  /** Specular color; Linear-sRGB components. See {@link Specular.getSpecularTexture getSpecularTexture}. */\n  getSpecularColorFactor() {\n    return this.get('specularColorFactor');\n  }\n  /** Specular color; Linear-sRGB components. See {@link Specular.getSpecularTexture getSpecularTexture}. */\n  setSpecularColorFactor(factor) {\n    return this.set('specularColorFactor', factor);\n  }\n  /**\n   * Specular texture; linear multiplier. Configures the strength of the specular reflection in\n   * the dielectric BRDF. A value of zero disables the specular reflection, resulting in a pure\n   * diffuse material.\n   *\n   * Only the alpha (A) channel is used for specular strength, but this texture may optionally\n   * be packed with specular color (RGB) into a single texture.\n   */\n  getSpecularTexture() {\n    return this.getRef('specularTexture');\n  }\n  /**\n   * Settings affecting the material's use of its specular texture. If no texture is attached,\n   * {@link TextureInfo} is `null`.\n   */\n  getSpecularTextureInfo() {\n    return this.getRef('specularTexture') ? this.getRef('specularTextureInfo') : null;\n  }\n  /** Sets specular texture. See {@link Specular.getSpecularTexture getSpecularTexture}. */\n  setSpecularTexture(texture) {\n    return this.setRef('specularTexture', texture, {\n      channels: A\n    });\n  }\n  /**\n   * Specular color texture; linear multiplier. Defines the F0 color of the specular reflection\n   * (RGB channels, encoded in sRGB) in the the dielectric BRDF.\n   *\n   * Only RGB channels are used here, but this texture may optionally be packed with a specular\n   * factor (A) into a single texture.\n   */\n  getSpecularColorTexture() {\n    return this.getRef('specularColorTexture');\n  }\n  /**\n   * Settings affecting the material's use of its specular color texture. If no texture is\n   * attached, {@link TextureInfo} is `null`.\n   */\n  getSpecularColorTextureInfo() {\n    return this.getRef('specularColorTexture') ? this.getRef('specularColorTextureInfo') : null;\n  }\n  /** Sets specular color texture. See {@link Specular.getSpecularColorTexture getSpecularColorTexture}. */\n  setSpecularColorTexture(texture) {\n    return this.setRef('specularColorTexture', texture, {\n      channels: R$1 | G$1 | B,\n      isColor: true\n    });\n  }\n}\nSpecular.EXTENSION_NAME = KHR_MATERIALS_SPECULAR;\n\n/**\n * [`KHR_materials_specular`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_specular/)\n * adjusts the strength of the specular reflection in the dielectric BRDF.\n *\n * KHRMaterialsSpecular is a better alternative to the older\n * {@link KHRMaterialsPBRSpecularGlossiness KHR_materials_pbrSpecularGlossiness} extension, and\n * provides specular information while remaining within a metal/rough PBR workflow. A\n * value of zero disables the specular reflection, resulting in a pure diffuse material.\n *\n * Properties:\n * - {@link Specular}\n *\n * ### Example\n *\n * The `KHRMaterialsSpecular` class provides a single {@link ExtensionProperty} type, `Specular`,\n * which may be attached to any {@link Material} instance. For example:\n *\n * ```typescript\n * import { KHRMaterialsSpecular, Specular } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const specularExtension = document.createExtension(KHRMaterialsSpecular);\n *\n * // Create a Specular property.\n * const specular = specularExtension.createSpecular()\n * \t.setSpecularFactor(1.0);\n *\n * // Attach the property to a Material.\n * material.setExtension('KHR_materials_specular', specular);\n * ```\n */\nclass KHRMaterialsSpecular extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_MATERIALS_SPECULAR;\n    this.prereadTypes = [PropertyType.MESH];\n    this.prewriteTypes = [PropertyType.MESH];\n  }\n  /** Creates a new Specular property for use on a {@link Material}. */\n  createSpecular() {\n    return new Specular(this.document.getGraph());\n  }\n  /** @hidden */\n  read(_context) {\n    return this;\n  }\n  /** @hidden */\n  write(_context) {\n    return this;\n  }\n  /** @hidden */\n  preread(context) {\n    const jsonDoc = context.jsonDoc;\n    const materialDefs = jsonDoc.json.materials || [];\n    const textureDefs = jsonDoc.json.textures || [];\n    materialDefs.forEach((materialDef, materialIndex) => {\n      if (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_SPECULAR]) {\n        const specular = this.createSpecular();\n        context.materials[materialIndex].setExtension(KHR_MATERIALS_SPECULAR, specular);\n        const specularDef = materialDef.extensions[KHR_MATERIALS_SPECULAR];\n        // Factors.\n        if (specularDef.specularFactor !== undefined) {\n          specular.setSpecularFactor(specularDef.specularFactor);\n        }\n        if (specularDef.specularColorFactor !== undefined) {\n          specular.setSpecularColorFactor(specularDef.specularColorFactor);\n        }\n        // Textures.\n        if (specularDef.specularTexture !== undefined) {\n          const textureInfoDef = specularDef.specularTexture;\n          const texture = context.textures[textureDefs[textureInfoDef.index].source];\n          specular.setSpecularTexture(texture);\n          context.setTextureInfo(specular.getSpecularTextureInfo(), textureInfoDef);\n        }\n        if (specularDef.specularColorTexture !== undefined) {\n          const textureInfoDef = specularDef.specularColorTexture;\n          const texture = context.textures[textureDefs[textureInfoDef.index].source];\n          specular.setSpecularColorTexture(texture);\n          context.setTextureInfo(specular.getSpecularColorTextureInfo(), textureInfoDef);\n        }\n      }\n    });\n    return this;\n  }\n  /** @hidden */\n  prewrite(context) {\n    const jsonDoc = context.jsonDoc;\n    this.document.getRoot().listMaterials().forEach(material => {\n      const specular = material.getExtension(KHR_MATERIALS_SPECULAR);\n      if (specular) {\n        const materialIndex = context.materialIndexMap.get(material);\n        const materialDef = jsonDoc.json.materials[materialIndex];\n        materialDef.extensions = materialDef.extensions || {};\n        // Factors.\n        const specularDef = materialDef.extensions[KHR_MATERIALS_SPECULAR] = {};\n        if (specular.getSpecularFactor() !== 1) {\n          specularDef.specularFactor = specular.getSpecularFactor();\n        }\n        if (!MathUtils.eq(specular.getSpecularColorFactor(), [1, 1, 1])) {\n          specularDef.specularColorFactor = specular.getSpecularColorFactor();\n        }\n        // Textures.\n        if (specular.getSpecularTexture()) {\n          const texture = specular.getSpecularTexture();\n          const textureInfo = specular.getSpecularTextureInfo();\n          specularDef.specularTexture = context.createTextureInfoDef(texture, textureInfo);\n        }\n        if (specular.getSpecularColorTexture()) {\n          const texture = specular.getSpecularColorTexture();\n          const textureInfo = specular.getSpecularColorTextureInfo();\n          specularDef.specularColorTexture = context.createTextureInfoDef(texture, textureInfo);\n        }\n      }\n    });\n    return this;\n  }\n}\nKHRMaterialsSpecular.EXTENSION_NAME = KHR_MATERIALS_SPECULAR;\n\nconst {\n  R\n} = TextureChannel;\n/**\n * Defines optical transmission on a PBR {@link Material}. See {@link KHRMaterialsTransmission}.\n */\nclass Transmission extends ExtensionProperty {\n  init() {\n    this.extensionName = KHR_MATERIALS_TRANSMISSION;\n    this.propertyType = 'Transmission';\n    this.parentTypes = [PropertyType.MATERIAL];\n  }\n  getDefaults() {\n    return Object.assign(super.getDefaults(), {\n      transmissionFactor: 0.0,\n      transmissionTexture: null,\n      transmissionTextureInfo: new TextureInfo(this.graph, 'transmissionTextureInfo')\n    });\n  }\n  /**********************************************************************************************\n   * Transmission.\n   */\n  /** Transmission; linear multiplier. See {@link Transmission.getTransmissionTexture getTransmissionTexture}. */\n  getTransmissionFactor() {\n    return this.get('transmissionFactor');\n  }\n  /** Transmission; linear multiplier. See {@link Transmission.getTransmissionTexture getTransmissionTexture}. */\n  setTransmissionFactor(factor) {\n    return this.set('transmissionFactor', factor);\n  }\n  /**\n   * Transmission texture; linear multiplier. The `r` channel of this texture specifies\n   * transmission [0-1] of the material's surface. By default this is a thin transparency\n   * effect, but volume effects (refraction, subsurface scattering) may be introduced with the\n   * addition of the `KHR_materials_volume` extension.\n   */\n  getTransmissionTexture() {\n    return this.getRef('transmissionTexture');\n  }\n  /**\n   * Settings affecting the material's use of its transmission texture. If no texture is attached,\n   * {@link TextureInfo} is `null`.\n   */\n  getTransmissionTextureInfo() {\n    return this.getRef('transmissionTexture') ? this.getRef('transmissionTextureInfo') : null;\n  }\n  /** Sets transmission texture. See {@link Transmission.getTransmissionTexture getTransmissionTexture}. */\n  setTransmissionTexture(texture) {\n    return this.setRef('transmissionTexture', texture, {\n      channels: R\n    });\n  }\n}\nTransmission.EXTENSION_NAME = KHR_MATERIALS_TRANSMISSION;\n\n/**\n * [`KHR_materials_transmission`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_transmission/)\n * provides a common type of optical transparency: infinitely-thin materials with no refraction,\n * scattering, or dispersion.\n *\n * ![Illustration](/media/extensions/khr-materials-transmission.png)\n *\n * > _**Figure:** Sphere using `KHR_materials_transmission` with varying roughness (0.0, 0.2, 0.4).\n * > Source: Khronos Group._\n *\n * While default PBR materials using alpha blending become invisible as their opacity approaches\n * zero, a transmissive material continues to reflect light in a glass-like manner, even at low\n * transmission values. When combined with {@link KHRMaterialsVolume}, transmission may be used for\n * thicker materials and refractive effects.\n *\n * Properties:\n * - {@link Transmission}\n *\n * ### Example\n *\n * The `KHRMaterialsTransmission` class provides a single {@link ExtensionProperty} type,\n * `Transmission`, which may be attached to any {@link Material} instance. For example:\n *\n * ```typescript\n * import { KHRMaterialsTransmission, Transmission } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const transmissionExtension = document.createExtension(KHRMaterialsTransmission);\n *\n * // Create a Transmission property.\n * const transmission = transmissionExtension.createTransmission()\n * \t.setTransmissionFactor(1.0);\n *\n * // Attach the property to a Material.\n * material.setExtension('KHR_materials_transmission', transmission);\n * ```\n */\nclass KHRMaterialsTransmission extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_MATERIALS_TRANSMISSION;\n    this.prereadTypes = [PropertyType.MESH];\n    this.prewriteTypes = [PropertyType.MESH];\n  }\n  /** Creates a new Transmission property for use on a {@link Material}. */\n  createTransmission() {\n    return new Transmission(this.document.getGraph());\n  }\n  /** @hidden */\n  read(_context) {\n    return this;\n  }\n  /** @hidden */\n  write(_context) {\n    return this;\n  }\n  /** @hidden */\n  preread(context) {\n    const jsonDoc = context.jsonDoc;\n    const materialDefs = jsonDoc.json.materials || [];\n    const textureDefs = jsonDoc.json.textures || [];\n    materialDefs.forEach((materialDef, materialIndex) => {\n      if (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_TRANSMISSION]) {\n        const transmission = this.createTransmission();\n        context.materials[materialIndex].setExtension(KHR_MATERIALS_TRANSMISSION, transmission);\n        const transmissionDef = materialDef.extensions[KHR_MATERIALS_TRANSMISSION];\n        // Factors.\n        if (transmissionDef.transmissionFactor !== undefined) {\n          transmission.setTransmissionFactor(transmissionDef.transmissionFactor);\n        }\n        // Textures.\n        if (transmissionDef.transmissionTexture !== undefined) {\n          const textureInfoDef = transmissionDef.transmissionTexture;\n          const texture = context.textures[textureDefs[textureInfoDef.index].source];\n          transmission.setTransmissionTexture(texture);\n          context.setTextureInfo(transmission.getTransmissionTextureInfo(), textureInfoDef);\n        }\n      }\n    });\n    return this;\n  }\n  /** @hidden */\n  prewrite(context) {\n    const jsonDoc = context.jsonDoc;\n    this.document.getRoot().listMaterials().forEach(material => {\n      const transmission = material.getExtension(KHR_MATERIALS_TRANSMISSION);\n      if (transmission) {\n        const materialIndex = context.materialIndexMap.get(material);\n        const materialDef = jsonDoc.json.materials[materialIndex];\n        materialDef.extensions = materialDef.extensions || {};\n        // Factors.\n        const transmissionDef = materialDef.extensions[KHR_MATERIALS_TRANSMISSION] = {\n          transmissionFactor: transmission.getTransmissionFactor()\n        };\n        // Textures.\n        if (transmission.getTransmissionTexture()) {\n          const texture = transmission.getTransmissionTexture();\n          const textureInfo = transmission.getTransmissionTextureInfo();\n          transmissionDef.transmissionTexture = context.createTextureInfoDef(texture, textureInfo);\n        }\n      }\n    });\n    return this;\n  }\n}\nKHRMaterialsTransmission.EXTENSION_NAME = KHR_MATERIALS_TRANSMISSION;\n\n/**\n * Converts a PBR {@link Material} to an unlit shading model. See {@link KHRMaterialsUnlit}.\n */\nclass Unlit extends ExtensionProperty {\n  init() {\n    this.extensionName = KHR_MATERIALS_UNLIT;\n    this.propertyType = 'Unlit';\n    this.parentTypes = [PropertyType.MATERIAL];\n  }\n}\nUnlit.EXTENSION_NAME = KHR_MATERIALS_UNLIT;\n\n/**\n * [`KHR_materials_unlit`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_unlit/)\n * defines an unlit shading model for use in glTF 2.0 materials.\n *\n * ![Illustration](/media/extensions/khr-materials-unlit.png)\n *\n * > _**Figure:** Unlit materials are useful for flat shading, stylized effects, and for improving\n * > performance on mobile devices. Source: [Model by Hayden VanEarden](https://sketchfab.com/3d-models/summertime-kirby-c5711316103a4d67a62c34cfe8710938)._\n *\n * Unlit (also \"Shadeless\" or \"Constant\") materials provide a simple alternative to the Physically\n * Based Rendering (PBR) shading models provided by the core specification. Unlit materials are\n * often useful for cheaper rendering on performance-contrained devices, e.g. mobile phones.\n * Additionally, unlit materials can be very useful in achieving stylized, non-photo-realistic\n * effects like hand painted illustrative styles or baked toon shaders.\n *\n * Properties:\n * - {@link Unlit}\n *\n * ### Example\n *\n * The `KHRMaterialsUnlit` class provides a single {@link ExtensionProperty} type, `Unlit`, which may\n * be attached to any {@link Material} instance. For example:\n *\n * ```typescript\n * import { KHRMaterialsUnlit, Unlit } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const unlitExtension = document.createExtension(KHRMaterialsUnlit);\n *\n * // Create an Unlit property.\n * const unlit = unlitExtension.createUnlit();\n *\n * // Attach the property to a Material.\n * material.setExtension('KHR_materials_unlit', unlit);\n * ```\n */\nclass KHRMaterialsUnlit extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_MATERIALS_UNLIT;\n    this.prereadTypes = [PropertyType.MESH];\n    this.prewriteTypes = [PropertyType.MESH];\n  }\n  /** Creates a new Unlit property for use on a {@link Material}. */\n  createUnlit() {\n    return new Unlit(this.document.getGraph());\n  }\n  /** @hidden */\n  read(_context) {\n    return this;\n  }\n  /** @hidden */\n  write(_context) {\n    return this;\n  }\n  /** @hidden */\n  preread(context) {\n    const materialDefs = context.jsonDoc.json.materials || [];\n    materialDefs.forEach((materialDef, materialIndex) => {\n      if (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_UNLIT]) {\n        context.materials[materialIndex].setExtension(KHR_MATERIALS_UNLIT, this.createUnlit());\n      }\n    });\n    return this;\n  }\n  /** @hidden */\n  prewrite(context) {\n    const jsonDoc = context.jsonDoc;\n    this.document.getRoot().listMaterials().forEach(material => {\n      if (material.getExtension(KHR_MATERIALS_UNLIT)) {\n        const materialIndex = context.materialIndexMap.get(material);\n        const materialDef = jsonDoc.json.materials[materialIndex];\n        materialDef.extensions = materialDef.extensions || {};\n        materialDef.extensions[KHR_MATERIALS_UNLIT] = {};\n      }\n    });\n    return this;\n  }\n}\nKHRMaterialsUnlit.EXTENSION_NAME = KHR_MATERIALS_UNLIT;\n\n/**\n * Maps {@link Variant}s to {@link Material}s. See {@link KHRMaterialsVariants}.\n */\nclass Mapping extends ExtensionProperty {\n  init() {\n    this.extensionName = KHR_MATERIALS_VARIANTS;\n    this.propertyType = 'Mapping';\n    this.parentTypes = ['MappingList'];\n  }\n  getDefaults() {\n    return Object.assign(super.getDefaults(), {\n      material: null,\n      variants: new RefSet()\n    });\n  }\n  /** The {@link Material} designated for this {@link Primitive}, under the given variants. */\n  getMaterial() {\n    return this.getRef('material');\n  }\n  /** The {@link Material} designated for this {@link Primitive}, under the given variants. */\n  setMaterial(material) {\n    return this.setRef('material', material);\n  }\n  /** Adds a {@link Variant} to this mapping. */\n  addVariant(variant) {\n    return this.addRef('variants', variant);\n  }\n  /** Removes a {@link Variant} from this mapping. */\n  removeVariant(variant) {\n    return this.removeRef('variants', variant);\n  }\n  /** Lists {@link Variant}s in this mapping. */\n  listVariants() {\n    return this.listRefs('variants');\n  }\n}\nMapping.EXTENSION_NAME = KHR_MATERIALS_VARIANTS;\n\n/**\n * List of material variant {@link Mapping}s. See {@link KHRMaterialsVariants}.\n */\nclass MappingList extends ExtensionProperty {\n  init() {\n    this.extensionName = KHR_MATERIALS_VARIANTS;\n    this.propertyType = 'MappingList';\n    this.parentTypes = [PropertyType.PRIMITIVE];\n  }\n  getDefaults() {\n    return Object.assign(super.getDefaults(), {\n      mappings: new RefSet()\n    });\n  }\n  /** Adds a {@link Mapping} to this mapping. */\n  addMapping(mapping) {\n    return this.addRef('mappings', mapping);\n  }\n  /** Removes a {@link Mapping} from the list for this {@link Primitive}. */\n  removeMapping(mapping) {\n    return this.removeRef('mappings', mapping);\n  }\n  /** Lists {@link Mapping}s in this {@link Primitive}. */\n  listMappings() {\n    return this.listRefs('mappings');\n  }\n}\nMappingList.EXTENSION_NAME = KHR_MATERIALS_VARIANTS;\n\n/**\n * Defines a variant of a {@link Material}. See {@link KHRMaterialsVariants}.\n */\nclass Variant extends ExtensionProperty {\n  init() {\n    this.extensionName = KHR_MATERIALS_VARIANTS;\n    this.propertyType = 'Variant';\n    this.parentTypes = ['MappingList'];\n  }\n}\nVariant.EXTENSION_NAME = KHR_MATERIALS_VARIANTS;\n\n/**\n * [`KHR_materials_variants`](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_variants/)\n * defines alternate {@link Material} states for any {@link Primitive} in the scene.\n *\n * ![Illustration](/media/extensions/khr-materials-variants.jpg)\n *\n * > _**Figure:** A sneaker, in three material variants. Source: Khronos Group._\n *\n * Uses include product configurators, night/day states, healthy/damaged states, etc. The\n * `KHRMaterialsVariants` class provides three {@link ExtensionProperty} types: `Variant`, `Mapping`,\n * and `MappingList`. When attached to {@link Primitive} properties, these offer flexible ways of\n * defining the variants available to an application. Triggering a variant is out of scope of this\n * extension, but could be handled in the application with a UI dropdown, particular game states,\n * and so on.\n *\n * Mesh geometry cannot be changed by this extension, although another extension\n * (tentative: `KHR_mesh_variants`) is under consideration by the Khronos Group, for that purpose.\n *\n * Properties:\n * - {@link Variant}\n * - {@link Mapping}\n * - {@link MappingList}\n *\n * ### Example\n *\n * ```typescript\n * import { KHRMaterialsVariants } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const variantExtension = document.createExtension(KHRMaterialsVariants);\n *\n * // Create some Variant states.\n * const healthyVariant = variantExtension.createVariant('Healthy');\n * const damagedVariant = variantExtension.createVariant('Damaged');\n *\n * // Create mappings from a Variant state to a Material.\n * const healthyMapping = variantExtension.createMapping()\n * \t.addVariant(healthyVariant)\n * \t.setMaterial(healthyMat);\n * const damagedMapping = variantExtension.createMapping()\n * \t.addVariant(damagedVariant)\n * \t.setMaterial(damagedMat);\n *\n * // Attach the mappings to a Primitive.\n * primitive.setExtension(\n * \t'KHR_materials_variants',\n * \tvariantExtension.createMappingList()\n * \t\t.addMapping(healthyMapping)\n * \t\t.addMapping(damagedMapping)\n * );\n * ```\n *\n * A few notes about this extension:\n *\n * 1. Viewers that don't recognized this extension will show the default material for each primitive\n * \t instead, so assign that material accordingly. This material can be — but doesn't have to be —\n * \t associated with one of the available variants.\n * 2. Mappings can list multiple Variants. In that case, the first Mapping containing an active\n * \t Variant will be chosen by the viewer.\n * 3. Variant names are how these states are identified, so choose informative names.\n * 4. When writing the file to an unpacked `.gltf`, instead of an embedded `.glb`, viewers will have\n * \t the option of downloading only textures associated with the default state, and lazy-loading\n * \t any textures for inactive Variants only when they are needed.\n */\nclass KHRMaterialsVariants extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_MATERIALS_VARIANTS;\n  }\n  /** Creates a new MappingList property. */\n  createMappingList() {\n    return new MappingList(this.document.getGraph());\n  }\n  /** Creates a new Variant property. */\n  createVariant(name = '') {\n    return new Variant(this.document.getGraph(), name);\n  }\n  /** Creates a new Mapping property. */\n  createMapping() {\n    return new Mapping(this.document.getGraph());\n  }\n  /** Lists all Variants on the current Document. */\n  listVariants() {\n    return Array.from(this.properties).filter(prop => prop instanceof Variant);\n  }\n  /** @hidden */\n  read(context) {\n    const jsonDoc = context.jsonDoc;\n    if (!jsonDoc.json.extensions || !jsonDoc.json.extensions[KHR_MATERIALS_VARIANTS]) return this;\n    // Read all top-level variant names.\n    const variantsRootDef = jsonDoc.json.extensions[KHR_MATERIALS_VARIANTS];\n    const variantDefs = variantsRootDef.variants || [];\n    const variants = variantDefs.map(variantDef => this.createVariant().setName(variantDef.name || ''));\n    // For each mesh primitive, read its material/variant mappings.\n    const meshDefs = jsonDoc.json.meshes || [];\n    meshDefs.forEach((meshDef, meshIndex) => {\n      const mesh = context.meshes[meshIndex];\n      const primDefs = meshDef.primitives || [];\n      primDefs.forEach((primDef, primIndex) => {\n        if (!primDef.extensions || !primDef.extensions[KHR_MATERIALS_VARIANTS]) {\n          return;\n        }\n        const mappingList = this.createMappingList();\n        const variantPrimDef = primDef.extensions[KHR_MATERIALS_VARIANTS];\n        for (const mappingDef of variantPrimDef.mappings) {\n          const mapping = this.createMapping();\n          if (mappingDef.material !== undefined) {\n            mapping.setMaterial(context.materials[mappingDef.material]);\n          }\n          for (const variantIndex of mappingDef.variants || []) {\n            mapping.addVariant(variants[variantIndex]);\n          }\n          mappingList.addMapping(mapping);\n        }\n        mesh.listPrimitives()[primIndex].setExtension(KHR_MATERIALS_VARIANTS, mappingList);\n      });\n    });\n    return this;\n  }\n  /** @hidden */\n  write(context) {\n    const jsonDoc = context.jsonDoc;\n    const variants = this.listVariants();\n    if (!variants.length) return this;\n    // Write all top-level variant names.\n    const variantDefs = [];\n    const variantIndexMap = new Map();\n    for (const variant of variants) {\n      variantIndexMap.set(variant, variantDefs.length);\n      variantDefs.push(context.createPropertyDef(variant));\n    }\n    // For each mesh primitive, write its material/variant mappings.\n    for (const mesh of this.document.getRoot().listMeshes()) {\n      const meshIndex = context.meshIndexMap.get(mesh);\n      mesh.listPrimitives().forEach((prim, primIndex) => {\n        const mappingList = prim.getExtension(KHR_MATERIALS_VARIANTS);\n        if (!mappingList) return;\n        const primDef = context.jsonDoc.json.meshes[meshIndex].primitives[primIndex];\n        const mappingDefs = mappingList.listMappings().map(mapping => {\n          const mappingDef = context.createPropertyDef(mapping);\n          const material = mapping.getMaterial();\n          if (material) {\n            mappingDef.material = context.materialIndexMap.get(material);\n          }\n          mappingDef.variants = mapping.listVariants().map(variant => variantIndexMap.get(variant));\n          return mappingDef;\n        });\n        primDef.extensions = primDef.extensions || {};\n        primDef.extensions[KHR_MATERIALS_VARIANTS] = {\n          mappings: mappingDefs\n        };\n      });\n    }\n    jsonDoc.json.extensions = jsonDoc.json.extensions || {};\n    jsonDoc.json.extensions[KHR_MATERIALS_VARIANTS] = {\n      variants: variantDefs\n    };\n    return this;\n  }\n}\nKHRMaterialsVariants.EXTENSION_NAME = KHR_MATERIALS_VARIANTS;\n\nconst {\n  G\n} = TextureChannel;\n/**\n * Defines volume on a PBR {@link Material}. See {@link KHRMaterialsVolume}.\n */\nclass Volume extends ExtensionProperty {\n  init() {\n    this.extensionName = KHR_MATERIALS_VOLUME;\n    this.propertyType = 'Volume';\n    this.parentTypes = [PropertyType.MATERIAL];\n  }\n  getDefaults() {\n    return Object.assign(super.getDefaults(), {\n      thicknessFactor: 0.0,\n      thicknessTexture: null,\n      thicknessTextureInfo: new TextureInfo(this.graph, 'thicknessTexture'),\n      attenuationDistance: Infinity,\n      attenuationColor: [1.0, 1.0, 1.0]\n    });\n  }\n  /**********************************************************************************************\n   * Thickness.\n   */\n  /**\n   * Thickness of the volume beneath the surface in meters in the local coordinate system of the\n   * node. If the value is 0 the material is thin-walled. Otherwise the material is a volume\n   * boundary. The doubleSided property has no effect on volume boundaries.\n   */\n  getThicknessFactor() {\n    return this.get('thicknessFactor');\n  }\n  /**\n   * Thickness of the volume beneath the surface in meters in the local coordinate system of the\n   * node. If the value is 0 the material is thin-walled. Otherwise the material is a volume\n   * boundary. The doubleSided property has no effect on volume boundaries.\n   */\n  setThicknessFactor(factor) {\n    return this.set('thicknessFactor', factor);\n  }\n  /**\n   * Texture that defines the thickness, stored in the G channel. This will be multiplied by\n   * thicknessFactor.\n   */\n  getThicknessTexture() {\n    return this.getRef('thicknessTexture');\n  }\n  /**\n   * Settings affecting the material's use of its thickness texture. If no texture is attached,\n   * {@link TextureInfo} is `null`.\n   */\n  getThicknessTextureInfo() {\n    return this.getRef('thicknessTexture') ? this.getRef('thicknessTextureInfo') : null;\n  }\n  /**\n   * Texture that defines the thickness, stored in the G channel. This will be multiplied by\n   * thicknessFactor.\n   */\n  setThicknessTexture(texture) {\n    return this.setRef('thicknessTexture', texture, {\n      channels: G\n    });\n  }\n  /**********************************************************************************************\n   * Attenuation.\n   */\n  /**\n   * Density of the medium given as the average distance in meters that light travels in the\n   * medium before interacting with a particle.\n   */\n  getAttenuationDistance() {\n    return this.get('attenuationDistance');\n  }\n  /**\n   * Density of the medium given as the average distance in meters that light travels in the\n   * medium before interacting with a particle.\n   */\n  setAttenuationDistance(distance) {\n    return this.set('attenuationDistance', distance);\n  }\n  /**\n   * Color (linear) that white light turns into due to absorption when reaching the attenuation\n   * distance.\n   */\n  getAttenuationColor() {\n    return this.get('attenuationColor');\n  }\n  /**\n   * Color (linear) that white light turns into due to absorption when reaching the attenuation\n   * distance.\n   */\n  setAttenuationColor(color) {\n    return this.set('attenuationColor', color);\n  }\n}\nVolume.EXTENSION_NAME = KHR_MATERIALS_VOLUME;\n\n/**\n * [KHR_materials_volume](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_volume/)\n * adds refraction, absorption, or scattering to a glTF PBR material already using transmission or\n * translucency.\n *\n * ![Illustration](/media/extensions/khr-materials-volume.png)\n *\n * > _**Figure:** Base color changes the amount of light passing through the volume boundary\n * > (left). The overall color of the object is the same everywhere, as if the object is covered\n * > with a colored, transparent foil. Absorption changes the amount of light traveling through the\n * > volume (right). The overall color depends on the distance the light traveled through it; at\n * > small distances (tail of the dragon) less light is absorbed and the color is brighter than at\n * > large distances. Source: Khronos Group._\n *\n * By default, a glTF 2.0 material describes the scattering properties of a surface enclosing an\n * infinitely thin volume. The surface defined by the mesh represents a thin wall. The volume\n * extension makes it possible to turn the surface into an interface between volumes. The mesh to\n * which the material is attached defines the boundaries of an homogeneous medium and therefore must\n * be manifold. Volumes provide effects like refraction, absorption and scattering. Scattering\n * effects will require future (TBD) extensions.\n *\n * The volume extension must be combined with {@link KHRMaterialsTransmission} or\n * `KHR_materials_translucency` in order to define entry of light into the volume.\n *\n * Properties:\n * - {@link Volume}\n *\n * ### Example\n *\n * The `KHRMaterialsVolume` class provides a single {@link ExtensionProperty} type, `Volume`, which\n * may be attached to any {@link Material} instance. For example:\n *\n * ```typescript\n * import { KHRMaterialsVolume, Volume } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const volumeExtension = document.createExtension(KHRMaterialsVolume);\n *\n * // Create a Volume property.\n * const volume = volumeExtension.createVolume()\n * \t.setThicknessFactor(1.0)\n * \t.setThicknessTexture(texture)\n * \t.setAttenuationDistance(1.0)\n * \t.setAttenuationColorFactor([1, 0.5, 0.5]);\n *\n * // Attach the property to a Material.\n * material.setExtension('KHR_materials_volume', volume);\n * ```\n *\n * A thickness texture is required in most realtime renderers, and can be baked in software such as\n * Blender or Substance Painter. When `thicknessFactor = 0`, all volumetric effects are disabled.\n */\nclass KHRMaterialsVolume extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_MATERIALS_VOLUME;\n    this.prereadTypes = [PropertyType.MESH];\n    this.prewriteTypes = [PropertyType.MESH];\n  }\n  /** Creates a new Volume property for use on a {@link Material}. */\n  createVolume() {\n    return new Volume(this.document.getGraph());\n  }\n  /** @hidden */\n  read(_context) {\n    return this;\n  }\n  /** @hidden */\n  write(_context) {\n    return this;\n  }\n  /** @hidden */\n  preread(context) {\n    const jsonDoc = context.jsonDoc;\n    const materialDefs = jsonDoc.json.materials || [];\n    const textureDefs = jsonDoc.json.textures || [];\n    materialDefs.forEach((materialDef, materialIndex) => {\n      if (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_VOLUME]) {\n        const volume = this.createVolume();\n        context.materials[materialIndex].setExtension(KHR_MATERIALS_VOLUME, volume);\n        const volumeDef = materialDef.extensions[KHR_MATERIALS_VOLUME];\n        // Factors.\n        if (volumeDef.thicknessFactor !== undefined) {\n          volume.setThicknessFactor(volumeDef.thicknessFactor);\n        }\n        if (volumeDef.attenuationDistance !== undefined) {\n          volume.setAttenuationDistance(volumeDef.attenuationDistance);\n        }\n        if (volumeDef.attenuationColor !== undefined) {\n          volume.setAttenuationColor(volumeDef.attenuationColor);\n        }\n        // Textures.\n        if (volumeDef.thicknessTexture !== undefined) {\n          const textureInfoDef = volumeDef.thicknessTexture;\n          const texture = context.textures[textureDefs[textureInfoDef.index].source];\n          volume.setThicknessTexture(texture);\n          context.setTextureInfo(volume.getThicknessTextureInfo(), textureInfoDef);\n        }\n      }\n    });\n    return this;\n  }\n  /** @hidden */\n  prewrite(context) {\n    const jsonDoc = context.jsonDoc;\n    this.document.getRoot().listMaterials().forEach(material => {\n      const volume = material.getExtension(KHR_MATERIALS_VOLUME);\n      if (volume) {\n        const materialIndex = context.materialIndexMap.get(material);\n        const materialDef = jsonDoc.json.materials[materialIndex];\n        materialDef.extensions = materialDef.extensions || {};\n        // Factors.\n        const volumeDef = materialDef.extensions[KHR_MATERIALS_VOLUME] = {};\n        if (volume.getThicknessFactor() > 0) {\n          volumeDef.thicknessFactor = volume.getThicknessFactor();\n        }\n        if (Number.isFinite(volume.getAttenuationDistance())) {\n          volumeDef.attenuationDistance = volume.getAttenuationDistance();\n        }\n        if (!MathUtils.eq(volume.getAttenuationColor(), [1, 1, 1])) {\n          volumeDef.attenuationColor = volume.getAttenuationColor();\n        }\n        // Textures.\n        if (volume.getThicknessTexture()) {\n          const texture = volume.getThicknessTexture();\n          const textureInfo = volume.getThicknessTextureInfo();\n          volumeDef.thicknessTexture = context.createTextureInfoDef(texture, textureInfo);\n        }\n      }\n    });\n    return this;\n  }\n}\nKHRMaterialsVolume.EXTENSION_NAME = KHR_MATERIALS_VOLUME;\n\n/**\n * [`KHR_mesh_quantization`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_mesh_quantization/)\n * expands allowed component types for vertex attributes to include 16- and 8-bit storage.\n *\n * Quantization provides a memory/precision tradeoff — depending on the application needs, 16-bit or\n * 8-bit storage can be sufficient for mesh geometry, at 1/2 or 1/4 the size. For example, a 10x10\n * mesh might be written to a uint16 {@link Accessor}, with values `0–65536`, normalized to be\n * interpreted as `0–1`. With an additional 10x scale on any node {@link Node} instantiating the\n * quantized {@link Mesh}, the model retains its original scale with a minimal quality loss and\n * up to 50% file size reduction.\n *\n * Defining no {@link ExtensionProperty} types, this {@link Extension} is simply attached to the\n * {@link Document}, and affects the entire Document by allowing more flexible use of\n * {@link Accessor} types for vertex attributes. Without the Extension, the same use of these data\n * types would yield an invalid glTF document, under the stricter core glTF specification.\n *\n * Properties:\n * - N/A\n *\n * ### Example\n *\n * ```typescript\n * import { KHRMeshQuantization } from '@gltf-transform/extensions';\n * import { quantize } from '@gltf-transform/functions';\n *\n * // Create an Extension attached to the Document.\n * const quantizationExtension = document.createExtension(KHRMeshQuantization).setRequired(true);\n *\n * // Use Uint16Array, Uint8Array, Int16Array, and Int8Array in vertex accessors manually,\n * // or apply the provided quantize() function to compute quantized accessors automatically:\n * await document.transform(quantize({\n * \tquantizePosition: 16,\n * \tquantizeNormal: 12,\n * \tquantizeTexcoord: 14\n * }));\n * ```\n *\n * For more documentation about automatic quantization, see the {@link quantize} function.\n */\nclass KHRMeshQuantization extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_MESH_QUANTIZATION;\n  }\n  /** @hidden */\n  read(_) {\n    return this;\n  }\n  /** @hidden */\n  write(_) {\n    return this;\n  }\n}\nKHRMeshQuantization.EXTENSION_NAME = KHR_MESH_QUANTIZATION;\n\nclass KTX2ImageUtils {\n  match(array) {\n    return array[0] === 0xab && array[1] === 0x4b && array[2] === 0x54 && array[3] === 0x58 && array[4] === 0x20 && array[5] === 0x32 && array[6] === 0x30 && array[7] === 0xbb && array[8] === 0x0d && array[9] === 0x0a && array[10] === 0x1a && array[11] === 0x0a;\n  }\n  getSize(array) {\n    const container = read(array);\n    return [container.pixelWidth, container.pixelHeight];\n  }\n  getChannels(array) {\n    const container = read(array);\n    const dfd = container.dataFormatDescriptor[0];\n    if (dfd.colorModel === KHR_DF_MODEL_ETC1S) {\n      return dfd.samples.length === 2 && (dfd.samples[1].channelType & 0xf) === 15 ? 4 : 3;\n    } else if (dfd.colorModel === KHR_DF_MODEL_UASTC) {\n      return (dfd.samples[0].channelType & 0xf) === 3 ? 4 : 3;\n    }\n    throw new Error(`Unexpected KTX2 colorModel, \"${dfd.colorModel}\".`);\n  }\n  getVRAMByteLength(array) {\n    const container = read(array);\n    const hasAlpha = this.getChannels(array) > 3;\n    let uncompressedBytes = 0;\n    for (let i = 0; i < container.levels.length; i++) {\n      const level = container.levels[i];\n      // Use level.uncompressedByteLength for UASTC; for ETC1S it's 0.\n      if (level.uncompressedByteLength) {\n        uncompressedBytes += level.uncompressedByteLength;\n      } else {\n        const levelWidth = Math.max(1, Math.floor(container.pixelWidth / Math.pow(2, i)));\n        const levelHeight = Math.max(1, Math.floor(container.pixelHeight / Math.pow(2, i)));\n        const blockSize = hasAlpha ? 16 : 8;\n        uncompressedBytes += levelWidth / 4 * (levelHeight / 4) * blockSize;\n      }\n    }\n    return uncompressedBytes;\n  }\n}\n/**\n * [`KHR_texture_basisu`](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_basisu)\n * enables KTX2 GPU textures with Basis Universal supercompression for any material texture.\n *\n * GPU texture formats, unlike traditional image formats, remain compressed in GPU memory. As a\n * result, they (1) upload to the GPU much more quickly, and (2) require much less GPU memory. In\n * certain cases they may also have smaller filesizes than PNG or JPEG textures, but this is not\n * guaranteed. GPU textures often require more careful tuning during compression to maintain image\n * quality, but this extra effort is worthwhile for applications that need to maintain a smooth\n * framerate while uploading images, or where GPU memory is limited.\n *\n * Defining no {@link ExtensionProperty} types, this {@link Extension} is simply attached to the\n * {@link Document}, and affects the entire Document by allowing use of the `image/ktx2` MIME type\n * and passing KTX2 image data to the {@link Texture.setImage} method. Without the Extension, the\n * same MIME types and image data would yield an invalid glTF document, under the stricter core glTF\n * specification.\n *\n * Properties:\n * - N/A\n *\n * ### Example\n *\n * ```typescript\n * import { KHRTextureBasisu } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const basisuExtension = document.createExtension(KHRTextureBasisu)\n * \t.setRequired(true);\n * document.createTexture('MyCompressedTexture')\n * \t.setMimeType('image/ktx2')\n * \t.setImage(fs.readFileSync('my-texture.ktx2'));\n * ```\n *\n * Compression is not done automatically when adding the extension as shown above — you must\n * compress the image data first, then pass the `.ktx2` payload to {@link Texture.setImage}. The\n * glTF Transform CLI has functions to help with this, or any similar KTX2-capable\n * utility will work.\n *\n * When the `KHR_texture_basisu` extension is added to a file by glTF Transform, the extension\n * should always be required. This tool does not support writing assets that \"fall back\" to optional\n * PNG or JPEG image data.\n *\n * > _**NOTICE:** Compressing some textures — particularly 3-component (RGB) normal maps, and\n * > occlusion/roughness/metalness maps, may give poor results with the ETC1S compression option.\n * > These issues can often be avoided with the larger UASTC compression option, or by upscaling the\n * > texture before compressing it.\n * >\n * > For best results when authoring new textures, use\n * > [texture dilation](https://docs.substance3d.com/spdoc/padding-134643719.html) and minimize\n * > prominent UV seams._\n */\nclass KHRTextureBasisu extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_TEXTURE_BASISU;\n    /** @hidden */\n    this.prereadTypes = [PropertyType.TEXTURE];\n  }\n  /** @hidden */\n  static register() {\n    ImageUtils.registerFormat('image/ktx2', new KTX2ImageUtils());\n  }\n  /** @hidden */\n  preread(context) {\n    context.jsonDoc.json.textures.forEach(textureDef => {\n      if (textureDef.extensions && textureDef.extensions[KHR_TEXTURE_BASISU]) {\n        const basisuDef = textureDef.extensions[KHR_TEXTURE_BASISU];\n        textureDef.source = basisuDef.source;\n      }\n    });\n    return this;\n  }\n  /** @hidden */\n  read(_context) {\n    return this;\n  }\n  /** @hidden */\n  write(context) {\n    const jsonDoc = context.jsonDoc;\n    this.document.getRoot().listTextures().forEach(texture => {\n      if (texture.getMimeType() === 'image/ktx2') {\n        const imageIndex = context.imageIndexMap.get(texture);\n        jsonDoc.json.textures.forEach(textureDef => {\n          if (textureDef.source === imageIndex) {\n            textureDef.extensions = textureDef.extensions || {};\n            textureDef.extensions[KHR_TEXTURE_BASISU] = {\n              source: textureDef.source\n            };\n            delete textureDef.source;\n          }\n        });\n      }\n    });\n    return this;\n  }\n}\nKHRTextureBasisu.EXTENSION_NAME = KHR_TEXTURE_BASISU;\n\n/**\n * Defines UV transform for a {@link TextureInfo}. See {@link KHRTextureTransform}.\n */\nclass Transform extends ExtensionProperty {\n  init() {\n    this.extensionName = KHR_TEXTURE_TRANSFORM;\n    this.propertyType = 'Transform';\n    this.parentTypes = [PropertyType.TEXTURE_INFO];\n  }\n  getDefaults() {\n    return Object.assign(super.getDefaults(), {\n      offset: [0.0, 0.0],\n      rotation: 0,\n      scale: [1.0, 1.0],\n      texCoord: null\n    });\n  }\n  getOffset() {\n    return this.get('offset');\n  }\n  setOffset(offset) {\n    return this.set('offset', offset);\n  }\n  getRotation() {\n    return this.get('rotation');\n  }\n  setRotation(rotation) {\n    return this.set('rotation', rotation);\n  }\n  getScale() {\n    return this.get('scale');\n  }\n  setScale(scale) {\n    return this.set('scale', scale);\n  }\n  getTexCoord() {\n    return this.get('texCoord');\n  }\n  setTexCoord(texCoord) {\n    return this.set('texCoord', texCoord);\n  }\n}\nTransform.EXTENSION_NAME = KHR_TEXTURE_TRANSFORM;\n\n/**\n * [`KHR_texture_transform`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_texture_transform/)\n * adds offset, rotation, and scale to {@link TextureInfo} properties.\n *\n * Affine UV transforms are useful for reducing the number of textures the GPU must load, improving\n * performance when used in techniques like texture atlases. UV transforms cannot be animated at\n * this time.\n *\n * Properties:\n * - {@link Transform}\n *\n * ### Example\n *\n * The `KHRTextureTransform` class provides a single {@link ExtensionProperty} type, `Transform`, which\n * may be attached to any {@link TextureInfo} instance. For example:\n *\n * ```typescript\n * import { KHRTextureTransform } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const transformExtension = document.createExtension(KHRTextureTransform)\n * \t.setRequired(true);\n *\n * // Create a reusable Transform.\n * const transform = transformExtension.createTransform()\n * \t.setScale([100, 100]);\n *\n * // Apply the Transform to a Material's baseColorTexture.\n * document.createMaterial()\n * \t.setBaseColorTexture(myTexture)\n * \t.getBaseColorTextureInfo()\n * \t.setExtension('KHR_texture_transform', transform);\n * ```\n */\nclass KHRTextureTransform extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_TEXTURE_TRANSFORM;\n  }\n  /** Creates a new Transform property for use on a {@link TextureInfo}. */\n  createTransform() {\n    return new Transform(this.document.getGraph());\n  }\n  /** @hidden */\n  read(context) {\n    for (const [textureInfo, textureInfoDef] of Array.from(context.textureInfos.entries())) {\n      if (!textureInfoDef.extensions || !textureInfoDef.extensions[KHR_TEXTURE_TRANSFORM]) continue;\n      const transform = this.createTransform();\n      const transformDef = textureInfoDef.extensions[KHR_TEXTURE_TRANSFORM];\n      if (transformDef.offset !== undefined) transform.setOffset(transformDef.offset);\n      if (transformDef.rotation !== undefined) transform.setRotation(transformDef.rotation);\n      if (transformDef.scale !== undefined) transform.setScale(transformDef.scale);\n      if (transformDef.texCoord !== undefined) transform.setTexCoord(transformDef.texCoord);\n      textureInfo.setExtension(KHR_TEXTURE_TRANSFORM, transform);\n    }\n    return this;\n  }\n  /** @hidden */\n  write(context) {\n    const textureInfoEntries = Array.from(context.textureInfoDefMap.entries());\n    for (const [textureInfo, textureInfoDef] of textureInfoEntries) {\n      const transform = textureInfo.getExtension(KHR_TEXTURE_TRANSFORM);\n      if (!transform) continue;\n      textureInfoDef.extensions = textureInfoDef.extensions || {};\n      const transformDef = {};\n      const eq = MathUtils.eq;\n      if (!eq(transform.getOffset(), [0, 0])) transformDef.offset = transform.getOffset();\n      if (transform.getRotation() !== 0) transformDef.rotation = transform.getRotation();\n      if (!eq(transform.getScale(), [1, 1])) transformDef.scale = transform.getScale();\n      if (transform.getTexCoord() != null) transformDef.texCoord = transform.getTexCoord();\n      textureInfoDef.extensions[KHR_TEXTURE_TRANSFORM] = transformDef;\n    }\n    return this;\n  }\n}\nKHRTextureTransform.EXTENSION_NAME = KHR_TEXTURE_TRANSFORM;\n\nconst PARENT_TYPES = [PropertyType.ROOT, PropertyType.SCENE, PropertyType.NODE, PropertyType.MESH, PropertyType.MATERIAL, PropertyType.TEXTURE, PropertyType.ANIMATION];\n/**\n * Defines an XMP packet associated with a Document or Property. See {@link KHRXMP}.\n */\nclass Packet extends ExtensionProperty {\n  init() {\n    this.extensionName = KHR_XMP_JSON_LD;\n    this.propertyType = 'Packet';\n    this.parentTypes = PARENT_TYPES;\n  }\n  getDefaults() {\n    return Object.assign(super.getDefaults(), {\n      context: {},\n      properties: {}\n    });\n  }\n  /**********************************************************************************************\n   * Context.\n   */\n  /**\n   * Returns the XMP context definition URL for the given term.\n   * See: https://json-ld.org/spec/latest/json-ld/#the-context\n   * @param term Case-sensitive term. Usually a concise, lowercase, alphanumeric identifier.\n   */\n  getContext() {\n    return this.get('context');\n  }\n  /**\n   * Sets the XMP context definition URL for the given term.\n   * See: https://json-ld.org/spec/latest/json-ld/#the-context\n   *\n   * Example:\n   *\n   * ```typescript\n   * packet.setContext({\n   *   dc: 'http://purl.org/dc/elements/1.1/',\n   *   model3d: 'https://schema.khronos.org/model3d/xsd/1.0/',\n   * });\n   * ```\n   *\n   * @param term Case-sensitive term. Usually a concise, lowercase, alphanumeric identifier.\n   * @param definition URI for XMP namespace.\n   */\n  setContext(context) {\n    return this.set('context', _extends({}, context));\n  }\n  /**********************************************************************************************\n   * Properties.\n   */\n  /**\n   * Lists properties defined in this packet.\n   *\n   * Example:\n   *\n   * ```typescript\n   * packet.listProperties(); // → ['dc:Language', 'dc:Creator', 'xmp:CreateDate']\n   * ```\n   */\n  listProperties() {\n    return Object.keys(this.get('properties'));\n  }\n  /**\n   * Returns the value of a property, as a literal or JSONLD object.\n   *\n   * Example:\n   *\n   * ```typescript\n   * packet.getProperty('dc:Creator'); // → {\"@list\": [\"Acme, Inc.\"]}\n   * packet.getProperty('dc:Title'); // → {\"@type\": \"rdf:Alt\", \"rdf:_1\": {\"@language\": \"en-US\", \"@value\": \"Lamp\"}}\n   * packet.getProperty('xmp:CreateDate'); // → \"2022-01-01\"\n   * ```\n   */\n  getProperty(name) {\n    const properties = this.get('properties');\n    return name in properties ? properties[name] : null;\n  }\n  /**\n   * Sets the value of a property, as a literal or JSONLD object.\n   *\n   * Example:\n   *\n   * ```typescript\n   * packet.setProperty('dc:Creator', {'@list': ['Acme, Inc.']});\n   * packet.setProperty('dc:Title', {\n   * \t'@type': 'rdf:Alt',\n   * \t'rdf:_1': {'@language': 'en-US', '@value': 'Lamp'}\n   * });\n   * packet.setProperty('model3d:preferredSurfaces', {'@list': ['vertical']});\n   * ```\n   */\n  setProperty(name, value) {\n    this._assertContext(name);\n    const properties = _extends({}, this.get('properties'));\n    if (value) {\n      properties[name] = value;\n    } else {\n      delete properties[name];\n    }\n    return this.set('properties', properties);\n  }\n  /**********************************************************************************************\n   * Serialize / Deserialize.\n   */\n  /**\n   * Serializes the packet context and properties to a JSONLD object.\n   */\n  toJSONLD() {\n    const context = copyJSON(this.get('context'));\n    const properties = copyJSON(this.get('properties'));\n    return _extends({\n      '@context': context\n    }, properties);\n  }\n  /**\n   * Deserializes a JSONLD packet, then overwrites existing context and properties with\n   * the new values.\n   */\n  fromJSONLD(jsonld) {\n    jsonld = copyJSON(jsonld);\n    // Context.\n    const context = jsonld['@context'];\n    if (context) this.set('context', context);\n    delete jsonld['@context'];\n    // Properties.\n    return this.set('properties', jsonld);\n  }\n  /**********************************************************************************************\n   * Validation.\n   */\n  /** @hidden */\n  _assertContext(name) {\n    const prefix = name.split(':')[0];\n    if (!(prefix in this.get('context'))) {\n      throw new Error(`${KHR_XMP_JSON_LD}: Missing context for term, \"${name}\".`);\n    }\n  }\n}\nPacket.EXTENSION_NAME = KHR_XMP_JSON_LD;\nfunction copyJSON(object) {\n  return JSON.parse(JSON.stringify(object));\n}\n\n/**\n * [KHR_xmp_json_ld](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_xmp_json_ld/)\n * defines XMP metadata associated with a glTF asset.\n *\n * XMP metadata provides standardized fields describing the content, provenance, usage\n * restrictions, or other attributes of a 3D model. XMP metadata does not generally affect the\n * parsing or runtime behavior of the content — for that, use custom extensions, custom vertex\n * attributes, or extras. Similarly, storage mechanisms other than XMP should be preferred\n * for binary content like mesh data, animations, or textures.\n *\n * Generally XMP metadata is associated with the entire glTF asset by attaching an XMP {@link Packet}\n * to the document {@link Root}. In less common cases where metadata must be associated with\n * specific subsets of a document, XMP Packets may be attached to {@link Scene}, {@link Node},\n * {@link Mesh}, {@link Material}, {@link Texture}, or {@link Animation} properties.\n *\n * Within each packet, XMP properties become available when an\n * [XMP namespace](https://www.adobe.io/xmp/docs/XMPNamespaces/) is registered\n * with {@link Packet.setContext}. Packets cannot use properties whose namespaces are not\n * registered as context. While not all XMP namespaces are relevant to 3D assets, some common\n * namespaces provide useful metadata about authorship and provenance. Additionally, the `model3d`\n * namespace provides certain properties specific to 3D content, such as Augmented Reality (AR)\n * orientation data.\n *\n * Common XMP contexts for 3D models include:\n *\n * | Prefix      | URI                                         | Name                           |\n * |:------------|:--------------------------------------------|:-------------------------------|\n * | `dc`        | http://purl.org/dc/elements/1.1/            | Dublin Core                    |\n * | `model3d`   | https://schema.khronos.org/model3d/xsd/1.0/ | Model 3D                       |\n * | `rdf`       | http://www.w3.org/1999/02/22-rdf-syntax-ns# | Resource Description Framework |\n * | `xmp`       | http://ns.adobe.com/xap/1.0/                | XMP                            |\n * | `xmpRights` | http://ns.adobe.com/xap/1.0/rights/         | XMP Rights Management          |\n *\n * Only the XMP contexts required for a packet should be assigned, and different packets\n * in the same asset may use different contexts. For greater detail on available XMP\n * contexts and how to use them in glTF assets, see the\n * [3DC Metadata Recommendations](https://github.com/KhronosGroup/3DC-Metadata-Recommendations/blob/main/model3d.md).\n *\n * Properties:\n * - {@link Packet}\n *\n * ### Example\n *\n * ```typescript\n * import { KHRXMP, Packet } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const xmpExtension = document.createExtension(KHRXMP);\n *\n * // Create Packet property.\n * const packet = xmpExtension.createPacket()\n * \t.setContext({\n * \t\tdc: 'http://purl.org/dc/elements/1.1/',\n * \t})\n *\t.setProperty('dc:Creator', {\"@list\": [\"Acme, Inc.\"]});\n *\n * // Option 1: Assign to Document Root.\n * document.getRoot().setExtension('KHR_xmp_json_ld', packet);\n *\n * // Option 2: Assign to a specific Property.\n * texture.setExtension('KHR_xmp_json_ld', packet);\n * ```\n */\nclass KHRXMP extends Extension {\n  constructor(...args) {\n    super(...args);\n    this.extensionName = KHR_XMP_JSON_LD;\n  }\n  /** Creates a new XMP packet, to be linked with a {@link Document} or {@link Property Properties}. */\n  createPacket() {\n    return new Packet(this.document.getGraph());\n  }\n  /** Lists XMP packets currently defined in a {@link Document}. */\n  listPackets() {\n    return Array.from(this.properties);\n  }\n  /** @hidden */\n  read(context) {\n    var _context$jsonDoc$json;\n    const extensionDef = (_context$jsonDoc$json = context.jsonDoc.json.extensions) == null ? void 0 : _context$jsonDoc$json[KHR_XMP_JSON_LD];\n    if (!extensionDef || !extensionDef.packets) return this;\n    // Deserialize packets.\n    const json = context.jsonDoc.json;\n    const root = this.document.getRoot();\n    const packets = extensionDef.packets.map(packetDef => this.createPacket().fromJSONLD(packetDef));\n    const defLists = [[json.asset], json.scenes, json.nodes, json.meshes, json.materials, json.images, json.animations];\n    const propertyLists = [[root], root.listScenes(), root.listNodes(), root.listMeshes(), root.listMaterials(), root.listTextures(), root.listAnimations()];\n    // Assign packets.\n    for (let i = 0; i < defLists.length; i++) {\n      const defs = defLists[i] || [];\n      for (let j = 0; j < defs.length; j++) {\n        const def = defs[j];\n        if (def.extensions && def.extensions[KHR_XMP_JSON_LD]) {\n          const xmpDef = def.extensions[KHR_XMP_JSON_LD];\n          propertyLists[i][j].setExtension(KHR_XMP_JSON_LD, packets[xmpDef.packet]);\n        }\n      }\n    }\n    return this;\n  }\n  /** @hidden */\n  write(context) {\n    const {\n      json\n    } = context.jsonDoc;\n    const packetDefs = [];\n    for (const packet of this.properties) {\n      // Serialize packets.\n      packetDefs.push(packet.toJSONLD());\n      // Assign packets.\n      for (const parent of packet.listParents()) {\n        let parentDef;\n        switch (parent.propertyType) {\n          case PropertyType.ROOT:\n            parentDef = json.asset;\n            break;\n          case PropertyType.SCENE:\n            parentDef = json.scenes[context.sceneIndexMap.get(parent)];\n            break;\n          case PropertyType.NODE:\n            parentDef = json.nodes[context.nodeIndexMap.get(parent)];\n            break;\n          case PropertyType.MESH:\n            parentDef = json.meshes[context.meshIndexMap.get(parent)];\n            break;\n          case PropertyType.MATERIAL:\n            parentDef = json.materials[context.materialIndexMap.get(parent)];\n            break;\n          case PropertyType.TEXTURE:\n            parentDef = json.images[context.imageIndexMap.get(parent)];\n            break;\n          case PropertyType.ANIMATION:\n            parentDef = json.animations[context.animationIndexMap.get(parent)];\n            break;\n          default:\n            parentDef = null;\n            this.document.getLogger().warn(`[${KHR_XMP_JSON_LD}]: Unsupported parent property, \"${parent.propertyType}\"`);\n            break;\n        }\n        if (!parentDef) continue;\n        parentDef.extensions = parentDef.extensions || {};\n        parentDef.extensions[KHR_XMP_JSON_LD] = {\n          packet: packetDefs.length - 1\n        };\n      }\n    }\n    if (packetDefs.length > 0) {\n      json.extensions = json.extensions || {};\n      json.extensions[KHR_XMP_JSON_LD] = {\n        packets: packetDefs\n      };\n    }\n    return this;\n  }\n}\nKHRXMP.EXTENSION_NAME = KHR_XMP_JSON_LD;\n\nconst KHRONOS_EXTENSIONS = [KHRDracoMeshCompression, KHRLightsPunctual, KHRMaterialsAnisotropy, KHRMaterialsClearcoat, KHRMaterialsDiffuseTransmission, KHRMaterialsDispersion, KHRMaterialsEmissiveStrength, KHRMaterialsIOR, KHRMaterialsIridescence, KHRMaterialsPBRSpecularGlossiness, KHRMaterialsSpecular, KHRMaterialsSheen, KHRMaterialsTransmission, KHRMaterialsUnlit, KHRMaterialsVariants, KHRMaterialsVolume, KHRMeshQuantization, KHRTextureBasisu, KHRTextureTransform, KHRXMP];\nconst ALL_EXTENSIONS = [EXTMeshGPUInstancing, EXTMeshoptCompression, EXTTextureAVIF, EXTTextureWebP, ...KHRONOS_EXTENSIONS];\n\nexport { ALL_EXTENSIONS, Anisotropy, Clearcoat, DiffuseTransmission, Dispersion, EXTMeshGPUInstancing, EXTMeshoptCompression, EXTTextureAVIF, EXTTextureWebP, EmissiveStrength, INSTANCE_ATTRIBUTE, IOR, InstancedMesh, Iridescence, KHRDracoMeshCompression, KHRLightsPunctual, KHRMaterialsAnisotropy, KHRMaterialsClearcoat, KHRMaterialsDiffuseTransmission, KHRMaterialsDispersion, KHRMaterialsEmissiveStrength, KHRMaterialsIOR, KHRMaterialsIridescence, KHRMaterialsPBRSpecularGlossiness, KHRMaterialsSheen, KHRMaterialsSpecular, KHRMaterialsTransmission, KHRMaterialsUnlit, KHRMaterialsVariants, KHRMaterialsVolume, KHRMeshQuantization, KHRONOS_EXTENSIONS, KHRTextureBasisu, KHRTextureTransform, KHRXMP, Light, Mapping, MappingList, PBRSpecularGlossiness, Packet, Sheen, Specular, Transform, Transmission, Unlit, Variant, Volume };\n//# sourceMappingURL=index.modern.js.map\n"],"names":["KHR_SUPERCOMPRESSION_NONE","KHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT","KHR_DF_VENDORID_KHRONOS","KHR_DF_VERSION","KHR_DF_MODEL_UNSPECIFIED","KHR_DF_MODEL_ETC1S","KHR_DF_MODEL_UASTC","KHR_DF_FLAG_ALPHA_STRAIGHT","KHR_DF_TRANSFER_SRGB","KHR_DF_PRIMARIES_BT709","KHR_DF_SAMPLE_DATATYPE_SIGNED","VK_FORMAT_UNDEFINED","createDefaultContainer","BufferReader","data","byteOffset","byteLength","littleEndian","value","left","right","len","bytes","maxByteLength","term","KTX2_ID","decodeText","buffer","read","id","container","headerByteLength","headerReader","dfdByteOffset","dfdByteLength","kvdByteOffset","kvdByteLength","sgdByteOffset","sgdByteLength","levelByteLength","levelReader","i","il","dfdReader","vendorId","descriptorType","versionNumber","descriptorBlockSize","colorModel","colorPrimaries","transferFunction","flags","texelBlockDimension","bytesPlane","dfd","numSamples","sample","kvdReader","keyValueByteLength","keyData","key","text","kvPadding","sgdReader","endpointCount","selectorCount","endpointsByteLength","selectorsByteLength","tablesByteLength","extendedByteLength","imageDescs","endpointsByteOffset","selectorsByteOffset","tablesByteOffset","extendedByteOffset","endpointsData","selectorsData","tablesData","extendedData","EXT_MESH_GPU_INSTANCING","EXT_MESHOPT_COMPRESSION","EXT_TEXTURE_WEBP","EXT_TEXTURE_AVIF","KHR_DRACO_MESH_COMPRESSION","KHR_LIGHTS_PUNCTUAL","KHR_MATERIALS_ANISOTROPY","KHR_MATERIALS_CLEARCOAT","KHR_MATERIALS_DIFFUSE_TRANSMISSION","KHR_MATERIALS_DISPERSION","KHR_MATERIALS_EMISSIVE_STRENGTH","KHR_MATERIALS_IOR","KHR_MATERIALS_IRIDESCENCE","KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS","KHR_MATERIALS_SHEEN","KHR_MATERIALS_SPECULAR","KHR_MATERIALS_TRANSMISSION","KHR_MATERIALS_UNLIT","KHR_MATERIALS_VOLUME","KHR_MATERIALS_VARIANTS","KHR_MESH_QUANTIZATION","KHR_TEXTURE_BASISU","KHR_TEXTURE_TRANSFORM","KHR_XMP_JSON_LD","INSTANCE_ATTRIBUTE","InstancedMesh","ExtensionProperty","PropertyType","RefMap","semantic","accessor","EXTMeshGPUInstancing","Extension","args","context","nodeDef","nodeIndex","instancedMeshDef","instancedMesh","prop","attribute","jsonDoc","node","_extends","n","t","EncoderMethod$1","EncoderMethod","MeshoptMode","MeshoptFilter","isFallbackBuffer","bufferDef","BYTE","SHORT","FLOAT","Accessor","encodeNormalizedInt","decodeNormalizedInt","MathUtils","prepareAccessor","encoder","mode","filterOptions","filter","bits","result","array","decodeNormalizedIntArray","padNormals","v","padArrayElements","componentType","srcArray","dstArray","elementSize","elementStride","BufferUtils","elementCount","j","getMeshoptMode","usage","WriterContext","parent","Primitive","getMeshoptFilter","doc","refs","edge","Root","ref","refName","refKey","isDelta","targetPath","getTargetPath","sampler","AnimationSampler","channel","AnimationChannel","DEFAULT_ENCODER_OPTIONS$1","EXTMeshoptCompression","dependency","options","propertyType","viewDef","index","meshoptDef","count","stride","resource","GLB_BUFFER","source","fallbackBuffer","fallbackBufferDef","_context","json","graph","fallbackBufferIndex","nextID","parentToID","getParentID","property","parentID","preparedAccessor","byteStride","bufferIndex","bufferView","bufferViewData","bufferViewAccessors","accessorDef","otherBufferViews","compressedData","fallbackBufferByteOffset","bufferViewIndex","finalBufferViewDef","compressedByteOffset","bufferViewExtensionDef","AVIFImageUtils","view","box","unbox","offset","_buffer","EXTTextureAVIF","ImageUtils","textureDef","texture","imageIndex","size","WEBPImageUtils","RIFF","WEBP","chunkId","chunkByteLength","width","height","b0","b1","b2","b3","EXTTextureWebP","decoderModule","COMPONENT_ARRAY","DATA_TYPE","decodeGeometry","decoder","dracoMesh","decodeIndex","mesh","numIndices","ptr","indices","decodeAttribute","dataType","ArrayCtor","numComponents","numValues","initDecoderModule","_decoderModule","encoderModule","AttributeEnum","DEFAULT_QUANTIZATION_BITS","DEFAULT_ENCODER_OPTIONS","initEncoderModule","_encoderModule","encodeGeometry","prim","_options","builder","attributeIDs","dracoBuffer","hasMorphTargets","hasSparseAttributes","attributeEnum","getAttributeEnum","attributeID","addAttribute","quantizationVolume","range","EncodingError","numVertices","itemSize","KHRDracoMeshCompression","logger","dracoMeshes","meshDefs","meshDef","primDef","dracoDef","bufferViewDef","dracoAttribute","attributeArray","_propertyType","primitiveHashMap","listDracoPrimitives","primitiveEncodingMap","getBounds","primHash","accessorDefs","encodedPrim","e","indicesDef","attributeDef","dracoContext","name","included","excluded","nonIndexed","nonTriangles","accessors","accessorIndices","includedAccessors","includedHashKeys","primToHashKey","hashKey","createHashKey","dstIndices","dstAttribute","parentTypes","attr","indexMap","hashElements","Light","color","intensity","type","angle","KHRLightsPunctual","lights","lightDef","_lightDef$spot","_lightDef$spot2","light","lightNodeDef","lightDefs","lightIndexMap","R$7","G$7","B$5","TextureChannel","Anisotropy","TextureInfo","strength","rotation","KHRMaterialsAnisotropy","materialDefs","textureDefs","materialDef","materialIndex","anisotropy","anisotropyDef","textureInfoDef","material","textureInfo","R$6","G$6","B$4","Clearcoat","factor","scale","KHRMaterialsClearcoat","clearcoat","clearcoatDef","R$5","G$5","B$3","A$3","DiffuseTransmission","KHRMaterialsDiffuseTransmission","transmission","transmissionDef","Dispersion","dispersion","KHRMaterialsDispersion","dispersionDef","EmissiveStrength","KHRMaterialsEmissiveStrength","emissiveStrength","emissiveStrengthDef","IOR","ior","KHRMaterialsIOR","iorDef","R$4","G$4","Iridescence","thickness","KHRMaterialsIridescence","iridescence","iridescenceDef","R$3","G$3","B$2","A$2","PBRSpecularGlossiness","KHRMaterialsPBRSpecularGlossiness","specGloss","specGlossDef","R$2","G$2","B$1","A$1","Sheen","KHRMaterialsSheen","sheen","sheenDef","R$1","G$1","B","A","Specular","KHRMaterialsSpecular","specular","specularDef","R","Transmission","KHRMaterialsTransmission","Unlit","KHRMaterialsUnlit","Mapping","RefSet","variant","MappingList","mapping","Variant","KHRMaterialsVariants","variants","variantDef","meshIndex","primIndex","mappingList","variantPrimDef","mappingDef","variantIndex","variantDefs","variantIndexMap","mappingDefs","G","Volume","distance","KHRMaterialsVolume","volume","volumeDef","KHRMeshQuantization","_","KTX2ImageUtils","hasAlpha","uncompressedBytes","level","levelWidth","levelHeight","blockSize","KHRTextureBasisu","basisuDef","Transform","texCoord","KHRTextureTransform","transform","transformDef","textureInfoEntries","eq","PARENT_TYPES","Packet","properties","copyJSON","jsonld","object","KHRXMP","_context$jsonDoc$json","extensionDef","root","packets","packetDef","defLists","propertyLists","defs","def","xmpDef","packetDefs","packet","parentDef"],"mappings":"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","x_google_ignoreList":[0,1]}